/*
Copyright(c) 2012 Company Name
*/
<<<<<<< HEAD
Ext.define("LDA.helper.LDAConstants",{singleton:true,LDA_BASE_URL:"http://ops2.few.vu.nl",LDA_IN_DATASET:"inDataset",LDA_ABOUT:"_about",LDA_LABEL:"label",LDA_COMPOUND_PHARMACOLOGY_COUNT:"compoundPharmacologyTotalResults",LDA_TARGET_PHARMACOLOGY_COUNT:"targetPharmacologyTotalResults",LDA_ENZYME_FAMILY_COUNT:"enzymePharmacologyTotalResults",LDA_PERMITTED_ACTIVITY_TYPES:["IC50","Activity"],LDA_ON_ASSAY:"onAssay",LDA_EXACT_MATCH:"exactMatch",LDA_PRIMARY_TOPIC:"primaryTopic",LDA_RESULT:"result",LDA_ACTIVITY:"activity",LDA_FOR_MOLECULE:"forMolecule",LDA_ASSAY_TARGET:"target",LDA_ITEMS:"items",LDA_PAGINATED_NEXT:"next",LDA_PAGINATED_PREVIOUS:"prev",LDA_PAGINATED_PAGE_SIZE:"itemsPerPage",LDA_PAGINATED_START_INDEX:"startIndex",LDA_TARGET_OF_ASSAY:"targetOfAssay",LDA_ASSAY_OF_ACTIVITY:"assayOfActivity",LDA_SRC_CLS_MAPPINGS:{"http://www.conceptwiki.org":"conceptWikiValue","http://www.conceptwiki.org/":"conceptWikiValue","http://data.kasabi.com/dataset/chembl-rdf":"chemblValue","http://www4.wiwiss.fu-berlin.de/drugbank":"drugbankValue","http://linkedlifedata.com/resource/drugbank":"drugbankValue","http://www.chemspider.com":"chemspiderValue","http://www.chemspider.com/":"chemspiderValue","http://rdf.chemspider.com":"chemspiderValue","http://rdf.chemspider.com/":"chemspiderValue","http://purl.uniprot.org":"uniprotValue","http://purl.uniprot.org/":"uniprotValue"},LDA_PROVENANCE_OFF:"Off",LDA_PROVENANCE_COLOUR:"Colour",LDA_PROVENANCE_ICON:"Icon",LDA_PROVENANCE_TEXT:"Text",LDAProvenanceMode:"Colour",LDADataItems:{compound_smiles:"smiles",activity_standard_value:"std_value",compound_inchikey:"inchiKey",activity_activity_type:"std_type",activity_standard_units:"std_unit",target_pref_label:"target_name",activity_relation:"relation",compound_inchi:"inchi",compound_full_mwt:"molweight",cw_compound_uri:"compound_cw",compound_pref_label:"compound_name",target_organism:"target_organisms",target_title:"target_names",assay_description:"assay_description",assay_organism:"assay_organism",activity_pubmed_id:"pmid",targets:"target_name",target_organisms:"target_organisms"},LDAUnits:{percentage:"%",microgram_per_milliliter:"μg/ml",nanomolar:"nM",micromolar:"μM"}});Ext.define("CW.config.Settings",{singleton:true,searchByTagUrl:cwBaseUrl+"/web-ws/concept/search/byTag",getConceptUrl:cwBaseUrl+"/web-ws/concept/get",base_ops_uri:"http://www.conceptwiki.org/concept/",lang_code:"en"});Ext.define("LSP.model.Unit",{extend:"Ext.data.Model",fields:["unit","name"]});Ext.define("LSP.model.DynamicGrid",{extend:"Ext.data.Model",fields:[]});Ext.define("LSP.view.cmpd_by_name.CmpdByNameSingleDisplayForm",{extend:"Ext.form.Panel",alias:"widget.CmpdByNameSingleDisplayForm",border:false,anchor:"100% 100%",autoScroll:true,bodyPadding:"10px",layout:"anchor",initComponent:function(){this.items=[{xtype:"panel",border:false,layout:"anchor",autoScroll:true,itemId:"displayPanel",bodyPadding:"20px",hidden:true,items:[{xtype:"panel",border:false,anchor:"100%",itemId:"topPanelDetails",layout:"column",items:[{xtype:"panel",itemId:"imageAndFigures",layout:"anchor",border:true,bodyPadding:"8px",items:[{xtype:"image",name:"image",itemId:"compound_form_imagepanel",width:150,height:150,src:"./assets/target_placeholder.png"},{xtype:"displayfield",name:"alogp",itemId:"alogp",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"20px 0 12px 0",fieldLabel:"ALogP",labelAlign:"top",columnWidth:0.1,renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"hba",itemId:"hba",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# H-Bond Acceptors",columnWidth:0.13,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"hbd",itemId:"hbd",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# H-Bond Donors",columnWidth:0.13,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"full_mwt",itemId:"full_mwt",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"Mol Weight",columnWidth:0.1,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"mw_freebase",itemId:"mw_freebase",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"MW Freebase",columnWidth:0.1,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"num_ro5_violations",itemId:"num_ro5_violations",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# Rule of 5 Violations",columnWidth:0.14,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"psa",itemId:"psa",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"Polar Surface Area (Å<sup>2</sup>)",columnWidth:0.12,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"rtb",itemId:"rtb",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# Rotatable Bonds",columnWidth:0.12,labelAlign:"top",renderer:provenanceSummaryRenderer}]},{xtype:"panel",bodyPadding:30,columnWidth:1,border:false,itemId:"dataPanel",layout:"anchor",items:[{xtype:"displayfield",name:"compound_pref_label",itemId:"compound_pref_label",anchor:"100%",fieldCls:"x-cmpTitle",renderer:provenanceSummaryRenderer},{xtype:"displayfield",itemId:"spacer4",renderer:provenanceSummaryRenderer},{xtype:"button",margin:"0 10 0 0",text:"Pharmacology Data",itemId:"pharmCompoundButton",renderer:provenanceSummaryRenderer},{xtype:"button",margin:"0 10 0 0",text:"Structure Search",itemId:"pharmCompoundStructureButton",renderer:provenanceSummaryRenderer},{xtype:"button",margin:"0 0 0 10",text:"View in ChemBioNavigator",itemId:"cbnLinkout",action:"cbn_linkout",hidden:true},{xtype:"button",margin:"0 0 0 10",text:"ChemSpider Info",itemId:"csWindowLaunchButton",chemspiderId:"",action:"openCSWindow",hidden:true},{xtype:"displayfield",value:"<br>",itemId:"spacer1",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"description",itemId:"description",fieldCls:"x-cmpDescriptions",anchor:"90%",maxWidth:600,renderer:provenanceSummaryRenderer},{xtype:"displayfield",itemId:"spacer2"},{xtype:"displayfield",name:"biotransformation",itemId:"biotransformation",fieldCls:"x-cmpDescriptions",anchor:"90%",maxWidth:600,renderer:provenanceSummaryRenderer},{xtype:"displayfield",itemId:"spacer3",value:"<br>"},{xtype:"displayfield",name:"chemspider_id",itemId:"chemspider_id",cls:"x-cmpfield",labelWidth:120,labelAlign:"left",fieldLabel:"ChemSpider ID",anchor:"100%"},{xtype:"displayfield",name:"molform",itemId:"molform",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Molecular Formula",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"compound_smiles",itemId:"compound_smiles",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"SMILES",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"inchi",itemId:"inchi",cls:"x-cmpfield",labelWidth:120,maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Standard InChI",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"inchi_key",itemId:"inchi_key",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Standard InChIKey",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"affectedOrganism",itemId:"affectedOrganism",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Affected Organism",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"indication",itemId:"indication",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Indication",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"proteinBinding",itemId:"proteinBinding",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Protein Binding",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"toxicity",itemId:"toxicity",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Toxicity",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"meltingPoint",itemId:"meltingPoint",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Melting Point",renderer:provenanceSummaryRenderer}]}]},{xtype:"panel",itemId:"bottomPanelDetails",bodyPadding:30,border:false,height:100,layout:"column",hidden:true,fieldDefaults:{labelAlign:"top",labelWidth:120,anchor:"100%"},items:[]},{xtype:"displayfield",border:0,padding:"20px",itemId:"msg",region:"center",hidden:true,fieldCls:"compound-message",value:"message here"}]}];this.callParent(arguments)},showData:function(l,c,k){if(k){if(c.length>0){var f=l.first();var m=this.query("#displayPanel")[0];m.show();var e=this.query("#dataPanel")[0];e.show();var j=this.query("#topPanelDetails")[0];j.show();var a=this.query("#bottomPanelDetails")[0];a.show();var g=this.query("#compound_form_imagepanel")[0];var d;if(f.data.cs_uri){d=f.data.cs_uri.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];g.setSrc("http://www.chemspider.com/ImagesHandler.ashx?id="+d);g.show()}var b=this.down("#msg");b.hide();this.setValues(f)}else{this.showMessage("No records found within OPS for this search")}}else{this.showMessage("Server did not respond")}this.up("CmpdByNameForm").setLoading(false);var h=Ext.ComponentQuery.query("#CmpdByNameSubmit_id")[0].enable()},resetAllFields:function(){var a=this.query("displayfield");Ext.each(a,function(b){b.hide()},this);this.doLayout()},showSpacerFields:function(){var a=this.down("#spacer1");a.show();a=this.down("#spacer2");a.show();a=this.down("#spacer3");a.show();a=this.down("#spacer4");a.show()},setValues:function(q){this.resetAllFields();this.showSpacerFields();var g=q.data;recordData=q;var o=this.down("#pharmCompoundButton");o.hide();o.setHandler(function(){Ext.History.add("!p=PharmByCmpdNameForm&u="+q.store.proxy.extraParams.uri)});o.show();var c=this.down("#pharmCompoundStructureButton");c.hide();c.setHandler(function(){Ext.History.add("!p=SimSearchForm&sm="+q.data.compound_smiles+"&st=exact")});c.show();for(var a in g){if(g.hasOwnProperty(a)){var d;var p=this.down("#"+a);if(p){switch(a){case"alogp":if(g[a]){var k=new Number(g[a]);k=k.toFixed(1);p.setValue(k);p.show()}break;case"molform":if(g[a]){var f=g[a];f=f.replace(/(\d+)?\s*/g,"<sub>$1</sub>");p.setValue(f);p.show()}break;case"psa":if(g[a]){var l=parseFloat(g[a])*10000000000000000000;p.setValue(l.toFixed(1));p.show()}break;case"meltingPoint":if(g[a]){var n=g[a];n=n.replace(/oC/g,"°C");p.setValue(n);p.show()}break;default:if(g[a]){p.setValue(g[a]);p.show()}}}else{}}}if(q.data.cs_uri){var h=q.data.cs_uri.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];var j=this.query("#chemspider_id")[0];j.setValue('<a href="http://www.chemspider.com/'+h+'"  target="_blank">'+h+"</a>");j.show()}var m=this.query("#compound_form_imagepanel")[0];var e;if(q.data.cs_uri){e=q.data.cs_uri.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];m.setSrc("http://www.chemspider.com/ImagesHandler.ashx?id="+e)}m.show();var b=this.query("#csWindowLaunchButton")[0];b.show();b.chemspiderId=e;this.doLayout()},showMessage:function(b){var f=this.query("#displayPanel")[0];f.show();var g=this.query("#dataPanel")[0];g.hide();var e=this.query("#topPanelDetails")[0];e.hide();var a=this.query("#bottomPanelDetails")[0];a.hide();var d=this.query("#compound_form_imagepanel")[0];d.hide();var c=this.query("#msg")[0];c.setValue(b);c.setVisible(true)},toggleProv:function(a){compound_name_provenance=a;console.log(" Show provenance : "+compound_name_provenance)}});var compound_name_provenance=false;var recordData;function provenanceSummaryRenderer(f,e){var b=new Array();b["http://www.chemspider.com"]="ChemSpider";b["http://data.kasabi.com/dataset/chembl-rdf"]="Chembl";b["http://linkedlifedata.com/resource/drugbank"]="DrugBank";b["http://www.conceptwiki.org"]="ConceptWiki";if(compound_name_provenance){var d=e.name;var j=d+"_item";d+="_src";var a=recordData.data[d];var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!h){h="defaultValue"}var g=h+"Icon";g="/assets/"+g+".png";h+=LDAProvenanceMode;h+="Summary";var c;c="<div>"+f+'   <a href="'+recordData.data[j]+'" target="_blank"><img src="'+g+'" title= "'+b[a]+'" height="15" width="15"/></a></div>';return c}else{return f}}Ext.define("LSP.view.Appmoduletree",{extend:"Ext.tree.Panel",alias:"widget.appmoduletree",requires:["Ext.data.TreeStore"],rootVisible:false,useArrows:true,frame:false,height:"100%",store:"NavigationTree",listeners:{itemclick:function(a,b,f,d,g,c){console.log("AppmoduleTree: itemclick()");if(b.raw.application_type=="grid"){Ext.History.add("!p="+b.raw.xtype)}}},initComponent:function(){this.callParent(arguments)}});Ext.define("LSP.view.mol_editor_forms.KetcherForm",{extend:"Ext.window.Window",alias:"widget.KetcherForm",requires:["Ext.form.Panel"],title:"Draw structure",layout:"fit",modal:true,autoShow:true,height:570,width:810,initComponent:function(){this.items=[{xtype:"form",padding:"0 0 0 0",border:false,style:"background-color: #fff;",items:[{xtype:"box",width:800,height:520,id:"ketcher_box_id",autoEl:{tag:"iframe",src:"ketcher/ketcher.html"}}]}];this.buttons=[{text:"Use structure",action:"commit_structure"},{text:"Cancel",scope:this,handler:this.close}];this.callParent(arguments)}});Ext.define("LSP.store.NavigationTree",{extend:"Ext.data.TreeStore",root:{expanded:true,children:[{xtype:"",home:"",leaf:false,text:"Compound",cls:"folder",children:[{xtype:"CmpdByNameForm",home:"Compound by name",leaf:true,text:"Compound by name",cls:"file",application_type:"grid"},{xtype:"SimSearchForm",home:"Compound Structure Search",leaf:true,text:"Compound by structure",cls:"file",application_type:"grid"}]},{xtype:"",home:"",leaf:false,text:"Target",cls:"folder",children:[{xtype:"TargetByNameForm",home:"Target by name",leaf:true,text:"Target by name",cls:"file",application_type:"grid"}]},{xtype:"",leaf:false,text:"Pharmacology",cls:"folder",children:[{xtype:"PharmEnzymeForm",home:"Compounds active against enzyme family",leaf:true,text:"Pharmacology by Enzyme family",cls:"file",application_type:"grid"},{xtype:"PharmByCmpdNameForm",home:"Pharmacology by Compound name",leaf:true,text:"Pharmacology by Compound",cls:"file",application_type:"grid"},{xtype:"PharmByTargetNameForm",home:"Pharmacology by Target Name",leaf:true,text:"Pharmacology by Target",cls:"file",application_type:"grid"}]}]}});Ext.define("LSP.view.Settings",{extend:"Ext.form.Panel",alias:"widget.settingsform",height:"100%",initComponent:function(){this.items=[{xtype:"form",padding:"5 5 0 5",border:false,style:"background-color: #fff;",items:[{xtype:"label",text:"To use a different endpoint than the default Amsterdam VU one insert URL of sparql endpoint below and click save"},{xtype:"textarea",name:"endpoint",heigth:50,fieldLabel:"URL",emptyText:"Insert full URL to the sparql endpoint used, eg: http://10.11.93.218:8183/sparql",labelWidth:30},{name:"utf8",xtype:"hidden",value:"&#x2713;"},{name:"authenticity_token",xtype:"hidden",value:$$("meta[name=csrf-token]")[0].readAttribute("content")},{xtype:"button",text:"Save",action:"save_endpoint"}]}];this.callParent(arguments)}});Ext.define("CW.helper.ConceptWikiJSONReader",{extend:"Ext.data.reader.Json",readRecords:function(c){var a=[];var b=0;Ext.each(c,function(f){var e={};var g="";var h=[];Ext.each(f.labels,function(j){if(j.language.code==CW.config.Settings.lang_code){if(j.type=="PREFERRED"){g=j.text}if(j.type=="ALTERNATIVE"){h.push(j.text)}}});var d=[];pref_url="";Ext.each(f.urls,function(j){if(j.type=="PREFERRED"){pref_url=j.value;return false}});var e=Ext.create("CW.model.ConceptWikiLookup",{match:f.match.replace(/\<\/em\>/g,"</b>").replace(/\<em\>/g,"<b>"),uuid:f.uuid,ops_uri:CW.config.Settings.base_ops_uri+f.uuid,pref_label:g,alt_labels:h.join("; "),concept_type_tags:d.join("; "),pref_url:pref_url});a.push(e);b++});return new Ext.data.ResultSet({total:b,count:b,records:a,success:true,message:"loaded"})}});Ext.define("LSP.controller.CmpdByNameForm",{extend:"Ext.app.Controller",views:["cmpd_by_name.CmpdByNameSingleDisplayForm"],refs:[{ref:"cmpdByNameSingleDisplayForm",selector:"CmpdByNameSingleDisplayForm"},{ref:"compoundImagePanel",selector:"CmpdByNameSingleDisplayForm #compound_form_imagepanel"},{ref:"formView",selector:"CmpdByNameForm"},{ref:"submitButton",selector:"#CmpdByNameSubmit_id"},{ref:"lookup",selector:"CmpdByNameForm #compoundByNameLookup"}],current_uri:null,init:function(){this.control({"CmpdByNameForm button[action=query_cmpd_by_name]":{click:this.submitQuery},"CmpdByNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},CmpdByNameForm:{historyToken:this.handleHistoryToken},"CmpdByNameForm button[action = cbn_linkout]":{click:this.firecbnLink},"CmpdByNameForm button[action=openCSWindow]":{click:this.openChemSpiderWidget},"CmpdByNameForm #provId":{change:this.onProvChange}});this.compoundWnd=Ext.create("CS.view.CompoundWindow")},firecbnLink:function(){window.open("http://cbn.zbh.uni-hamburg.de/?ops_uris="+this.current_uri,"_blank")},openChemSpiderWidget:function(a){if(parseInt(a.chemspiderId)>=1){this.compoundWnd.showCompound(a.chemspiderId)}},handleHistoryToken:function(b){console.log("CmpdByNameForm: handleHistoryToken()");var c=this;var e=c.getFormView().down("CmpdByNameSingleDisplayForm");if(b.u){var a=this.getStore("LDA.store.CompoundStore");if(b.u!=a.proxy.extraParams.uri){var g=this.getController("CW.controller.ConceptWikiLookup");var f=this.getFormView().down("conceptWikiLookup");g.setConcept(b.u,f,a);a.proxy.extraParams.uri=b.u;c.current_uri=b.u;c.getFormView().setLoading(true);a.load(function(j,h,k){console.log("LSP.controller.CmpdByNameForm: store is loaded "+k);if(k){c.getSubmitButton().enable();e.setValues(j[0]);e.recordData=j[0];e.down("#displayPanel").setVisible(true);e.down("#msg").setVisible(false);c.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});c.getSubmitButton().enable();e.down("#displayPanel").setVisible(false);e.down("#msg").setVisible(true);c.getFormView().setLoading(false)}})}}else{if(b.s){var d=this.getLookup();d.setRawValue(b.s);d.doQuery(b.s)}}},enableSubmit:function(c){var b=this.getFormView();var a=this.getSubmitButton();a.enable()},submitQuery:function(c){c.disable();var e=this;var d=this.getFormView();var b=d.getValues().compound_uri;if(this.current_uri==b){var f=e.getFormView().down("CmpdByNameSingleDisplayForm");var a=this.getStore("LDA.store.CompoundStore");a.proxy.extraParams.uri=this.current_uri;e.getFormView().setLoading(true);a.load(function(h,g,j){console.log("LSP.controller.CmpdByNameForm: store is loaded "+j);if(j){e.getSubmitButton().enable();f.setValues(h[0]);f.recordData=h[0];f.down("#displayPanel").setVisible(true);f.down("#msg").setVisible(false);e.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});e.getSubmitButton().enable();f.down("#displayPanel").setVisible(false);f.down("#msg").setVisible(true);e.getFormView().setLoading(false)}})}else{Ext.History.add("!p=CmpdByNameForm&u="+b)}},onProvChange:function(d,b,a){var c=this.getCmpdByNameSingleDisplayForm();c.toggleProv(b.prov);c.setValues(c.recordData)}});Ext.define("LSP.controller.Settings",{extend:"Ext.app.Controller",views:["Settings"],init:function(){this.control({"settingsform button[action=save_endpoint]":{click:this.saveEndpoint}})},saveEndpoint:function(b){var c=b.up("form");var a=c.getValues();c.submit({url:"/sparql_endpoint/settings.json",waitMsg:"Saving end point...",success:function(d,e){Ext.Msg.alert("Success","Endpoint stored")}})}});Ext.define("LSP.view.api_status.Status",{extend:"Ext.form.Panel",alias:"widget.Status",closable:true,header:false,layout:"fit",border:false,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},items:[{xtype:"label",text:"Linked Data API",margin:"0 0 0 10"},{xtype:"image",name:"lda_image",itemId:"status_form_lda_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"label",text:"Concept Wiki",margin:"0 0 0 10"},{xtype:"image",name:"cw_image",itemId:"status_form_cw_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"label",text:"Chemspider",margin:"0 0 0 10"},{xtype:"image",name:"cs_image",itemId:"status_form_cs_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"label",text:"IMS",margin:"0 0 0 10"},{xtype:"image",name:"ims_image",itemId:"status_form_ims_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]}]});Ext.define("CW.model.ConceptWikiLookup",{extend:"Ext.data.Model",fields:[{name:"match",mapping:"match",type:"string"},{name:"uuid",mapping:"uuid",type:"string"},{name:"ops_uri",mapping:"ops_uri",type:"string"},{name:"pref_label",mapping:"pref_labels",type:"string"},{name:"alt_labels",mapping:"alt_labels",type:"string"},{name:"uuid",mapping:"uuid",type:"string"},{name:"concept_type_tags",mapping:"uuid_tags",type:"string"},{name:"pref_url",mapping:"pref_url",type:"string"}],getSomething:function(){if(this.something==null){this.parseSomething()}return this.something},parseSomething:function(){this.something=new Array();for(var b=0;b<this.data.something.length;b++){var a=this.data.tags[b];if(a.length==1){this.something.push(a)}}}});Ext.define("LDA.model.SimModel",{extend:"Ext.data.Model",fields:["cw_uri","cs_uri","chembl_uri","drugbank_uri","inchi","inchi_src","inchi_key","inchi_key_src","smiles","smiles_src","alogp","alogp_src","full_mwt","full_mwt_src","hba","hba_src","hbd","hbd_src","molform","molform_src","mw_freebase","mw_freebase_src","psa","psa_src","rtb","rtb_src","biotransformation","biotransformation_src","description","description_src","proteinBinding","proteinBinding_src","toxicity","toxicity_src","prefLabel","prefLabel_src"]});Ext.define("LDA.store.SimSearchLocalStore",{extend:"Ext.data.Store",model:"LDA.model.SimModel",storeId:"simSearchLocalStore",typeName:undefined,proxy:{type:"memory",reader:{type:"json"}},setTypeName:function(a){this.typeName=a},getTypeName:function(){return this.typeName}});Ext.define("LSP.controller.Status",{extend:"Ext.app.Controller",views:["api_status.Status"],refs:[{ref:"CWImage",selector:"#status_form_cw_image"},{ref:"LDAImage",selector:"#status_form_lda_image"},{ref:"CSImage",selector:"#status_form_cs_image"},{ref:"IMSImage",selector:"#status_form_ims_image"}],init:function(){var c=this;var a=function(){c.testConceptWiki();c.testLDA();c.testChemspider();c.testIMS()};var b=Ext.TaskManager.start({run:a,interval:600000})},testIMS:function(){var a=this;var b=Ext.create("LDA.store.IMSStore",{});b.load(function(d,c,e){if(d[0].data.status=="true"){console.log("IMS fetch success "+d[0]);a.getIMSImage().setSrc("./assets/tick.png");a.getIMSImage().setVisible(true)}else{console.log("IMS fetch boom");a.getIMSImage().setSrc("./assets/cancel.png");a.getIMSImage().setVisible(true)}})},testChemspider:function(){var b=this;var a=Ext.create("CS.engine.search.Structure",{listeners:{finished:function(d,e){a.loadCSIDs(function(f){if(f.length==0){console.log("CS fetch boom");b.getCSImage().setSrc("./assets/cancel.png");b.getCSImage().setVisible(true)}else{b.csFetch(f)}})},failed:function(e,d){console.log("CS fetch boom");b.getCSImage().setSrc("./assets/cancel.png");b.getCSImage().setVisible(true)}}});var c={};c["searchOptions.Molecule"]="CC(=O)Oc1ccccc1C(=O)O";c["scopeOptions.DataSources[0]"]="DrugBank";c["scopeOptions.DataSources[1]"]="ChEMBL";c["scopeOptions.DataSources[2]"]="PDB";a.doSearch("exact",c)},testLDA:function(){var b="http://www.conceptwiki.org/concept/dd758846-1dac-4f0d-a329-06af9a7fa413";var c=Ext.create("LDA.store.CompoundStore",{});var a=this;c.proxy.extraParams.uri=b;c.proxy.reader.uri=b;c.load({callback:function(e,d,f){if(f){console.log("Compound Store Success",e[0]);a.getLDAImage().setSrc("./assets/tick.png");a.getLDAImage().setVisible(true)}else{console.log("LDA boom");a.getLDAImage().setSrc("./assets/cancel.png");a.getLDAImage().setVisible(true)}}},this)},testConceptWiki:function(){var b="07a84994-e464-4bbf-812a-a4b96fa3d197";var a=Ext.create("CW.store.ConceptWikiLookup",{});a.proxy.setExtraParam("uuid",b);a.proxy.setExtraParam("limit",1);var c=this;a.load({params:{q:"aspi",branch:"4"},callback:function(e,d,f){if(f){console.log("Success",e[0]);c.getCWImage().setSrc("./assets/tick.png");c.getCWImage().setVisible(true)}else{console.log("CW boom");c.getCWImage().setSrc("./assets/cancel.png");c.getCWImage().setVisible(true)}}},this)},csFetch:function(c){var d=this;var a=Ext.create("LDA.store.CompoundStore",{});a.proxy.reader=Ext.create("LDA.helper.ChemspiderCompoundReader");for(var b=0;b<c.length;b++){a.proxy.extraParams.uri="http://rdf.chemspider.com/"+c[b];a.load(function(f,e,g){if(g){console.log("CS fetch success "+f[0]);d.getCSImage().setSrc("./assets/tick.png");d.getCSImage().setVisible(true)}else{console.log("CS fetch boom");d.getCSImage().setSrc("./assets/cancel.png");d.getCSImage().setVisible(true)}})}}});Ext.define("CW.store.ConceptWikiLookup",{extend:"Ext.data.Store",requires:["CW.model.ConceptWikiLookup","CW.config.Settings"],queryValue:undefined,comboBox:undefined,model:"CW.model.ConceptWikiLookup",proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader")},constructor:function(){console.log("CW.store.ConceptWikiLookup: constructor()");this.callParent(arguments)},listeners:{load:function(){var a=this;Ext.each(this.data.items,function(c,b){if(c.data.pref_label==this.store.queryValue){a.getComboBox().setValue(c);a.getComboBox().fireEvent("matchingconcept")}})}},setQueryValue:function(a){this.queryValue=a},getQueryValue:function(){return this.queryValue},setComboBox:function(a){this.comboBox=a},getComboBox:function(){return this.comboBox}});Ext.define("CW.view.ConceptWikiLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiLookup",requires:["CW.model.ConceptWikiLookup","CW.helper.ConceptWikiJSONReader","CW.store.ConceptWikiLookup"],cwTagUuid:"pleaseConfigure[cwConceptTagUuid:]",store:undefined,forceSelection:true,allowBlank:false,typeAhead:true,typeAheadDelay:250,queryDelay:250,queryCaching:false,queryParam:"q",queryMode:"remote",valueField:"ops_uri",displayField:"pref_label",name:"ops_uri",minChars:4,hideTrigger:true,forceSelection:true,allowBlank:false,typeAhead:false,emptyText:"Start typing...",margin:"5 5 5 5",width:700,fieldLabel:"Overwrite this in config",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"Nothing found which matches your text, you may need to enter more text or try something different.",getInnerTpl:function(){return'<p><span style="font-family: verdana; color: grey; "><small>Match: {match}</small></span><br/><b>{pref_label}</b> <a href="http://ops.conceptwiki.org/wiki/#/concept/{uuid}/view" target="_blank">(definition)</a></p>'}},autoSelect:false,listeners:{beforequery:function(){this.store.setQueryValue(this.rawValue);this.store.setComboBox(this)}},initComponent:function(){this.addEvents("matchingconcept");this.callParent(arguments)}});Ext.define("CW.controller.ConceptWikiLookup",{extend:"Ext.app.Controller",models:["CW.model.ConceptWikiLookup"],views:["CW.view.ConceptWikiLookup"],stores:["CW.store.ConceptWikiLookup"],init:function(){this.control({conceptWikiLookup:{afterrender:this.prepProxy}})},prepProxy:function(a){a.store.proxy.setExtraParam("uuid",a.cwTagUuid);a.store.proxy.setExtraParam("limit",10)},setConcept:function(d,a,c){console.log("CW.controller.ConceptWikiLookup: setConcept()");var e=d.match(/http:\/\/www.conceptwiki.org\/concept\/([a-f0-9\-]+)/)[1];var b=Ext.create("Ext.data.Store",{model:"CW.model.ConceptWikiLookup",proxy:{type:"jsonp",url:CW.config.Settings.getConceptUrl,reader:Ext.create("CW.helper.ConceptWikiJSONGetReader")}});b.load({params:{uuid:e},callback:function(g,f,h){if(h){a.setValue(g[0]);c.setTypeName(g[0].data.pref_label)}else{}}},this)}});Ext.define("LSP.view.background_tasks.BackgroundTasksForm",{extend:"Ext.form.Panel",alias:"widget.BackgroundTasksForm",itemId:"tasks_container",closable:true,header:false,layout:"fit",border:false,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.addEvents("taskadded");this.callParent(arguments)},items:[]});Ext.define("LDA.helper.FilterUnitsReader",{extend:"Ext.data.reader.Json",requires:["LDA.helper.LDAConstants"],readRecords:function(d){var e=d.result["primaryTopic"];var c=e[LDA.helper.LDAConstants.LDA_LABEL];var b=e.unit;var a=new Array();Ext.each(b,function(k,h){var j=k[LDA.helper.LDAConstants.LDA_ABOUT];var g=k[LDA.helper.LDAConstants.LDA_LABEL];var f=Ext.create("LDA.model.FilterUnitsModel",{activity_type:c,unit:g,about:j});a.push(f)});return new Ext.data.ResultSet({total:a.length,count:a.length,records:a,success:true,message:"loaded"})}});Ext.define("LDA.model.FilterUnitsModel",{extend:"Ext.data.Model",fields:["activity_type","unit","about"]});Ext.define("Ext.ux.grid.FiltersFeature",{extend:"Ext.grid.feature.Feature",alias:"feature.filters",uses:["Ext.ux.grid.menu.ListMenu","Ext.ux.grid.menu.RangeMenu","Ext.ux.grid.filter.BooleanFilter","Ext.ux.grid.filter.DateFilter","Ext.ux.grid.filter.ListFilter","Ext.ux.grid.filter.NumericFilter","Ext.ux.grid.filter.StringFilter"],autoReload:true,filterCls:"ux-filtered-column",local:false,menuFilterText:"Filters",paramPrefix:"filter",showMenu:true,stateId:undefined,updateBuffer:500,hasFeatureEvent:false,constructor:function(a){var b=this;a=a||{};Ext.apply(b,a);b.deferredUpdate=Ext.create("Ext.util.DelayedTask",b.reload,b);b.filters=b.createFiltersCollection();b.filterConfigs=a.filters},attachEvents:function(){var c=this,a=c.view,d=a.headerCt,b=c.getGridPanel();c.bindStore(a.getStore(),true);d.on("menucreate",c.onMenuCreate,c);a.on("refresh",c.onRefresh,c);b.on({scope:c,beforestaterestore:c.applyState,beforestatesave:c.saveState,beforedestroy:c.destroy});b.filters=c;b.addEvents("filterupdate")},createFiltersCollection:function(){return Ext.create("Ext.util.MixedCollection",false,function(a){return a?a.dataIndex:null})},createFilters:function(){var h=this,g=h.filters.getCount(),a=h.getGridPanel(),d=h.createFiltersCollection(),e=a.store.model,f=e.prototype.fields,j,c,b;if(g){b={};h.saveState(null,b)}function k(m,l,n){if(m&&(n||l)){j=f.get(m);c={dataIndex:m,type:(j&&j.type&&j.type.type)||"auto"};if(Ext.isObject(l)){Ext.apply(c,l)}d.replace(c)}}Ext.Array.each(h.filterConfigs,function(l){k(l.dataIndex,l)});Ext.Array.each(a.columns,function(l){if(l.filterable===false){d.removeAtKey(l.dataIndex)}else{k(l.dataIndex,l.filter,l.filterable)}});h.removeAll();if(d.items){h.initializeFilters(d.items)}if(g){h.applyState(null,b)}},initializeFilters:function(e){var d=this,f=e.length,b,c,a;for(b=0;b<f;b++){c=e[b];if(c){a=d.getFilterClass(c.type);c=c.menu?c:new a(c);d.filters.add(c);Ext.util.Observable.capture(c,this.onStateChange,this)}}},onMenuCreate:function(c,b){var a=this;a.createFilters();b.on("beforeshow",a.onMenuBeforeShow,a)},onMenuBeforeShow:function(d){var c=this,b,a;if(c.showMenu){b=c.menuItem;if(!b||b.isDestroyed){c.createMenuItem(d);b=c.menuItem}a=c.getMenuFilter();if(a){b.setMenu(a.menu,false);b.setChecked(a.active);b.setDisabled(a.disabled===true)}b.setVisible(!!a);this.sep.setVisible(!!a)}},createMenuItem:function(b){var a=this;a.sep=b.add("-");a.menuItem=b.add({checked:false,itemId:"filters",text:a.menuFilterText,listeners:{scope:a,checkchange:a.onCheckChange,beforecheckchange:a.onBeforeCheck}})},getGridPanel:function(){return this.view.up("gridpanel")},applyState:function(b,e){var d=this,a,c;d.applyingState=true;d.clearFilters();if(e.filters){for(a in e.filters){if(e.filters.hasOwnProperty(a)){c=d.filters.get(a);if(c){c.setValue(e.filters[a]);c.setActive(true)}}}}d.deferredUpdate.cancel();if(d.local){d.reload()}delete d.applyingState;delete e.filters},saveState:function(a,c){var b={};this.filters.each(function(d){if(d.active){b[d.dataIndex]=d.getValue()}});return(c.filters=b)},destroy:function(){var a=this;Ext.destroyMembers(a,"menuItem","sep");a.removeAll();a.clearListeners()},removeAll:function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear()}},bindStore:function(a){var b=this;if(b.store&&b.storeListeners){b.store.un(b.storeListeners)}if(a){b.storeListeners={scope:b};if(b.local){b.storeListeners.load=b.onLoad}else{b.storeListeners["before"+(a.buffered?"prefetch":"load")]=b.onBeforeLoad}a.on(b.storeListeners)}else{delete b.storeListeners}b.store=a},getMenuFilter:function(){var a=this.view.headerCt.getMenu().activeHeader;return a?this.filters.get(a.dataIndex):null},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable()},onStateChange:function(d,b){if(d!=="serialize"){var c=this,a=c.getGridPanel();if(b==c.getMenuFilter()){c.menuItem.setChecked(b.active,false)}if((c.autoReload||c.local)&&!c.applyingState){c.deferredUpdate.delay(c.updateBuffer)}c.updateColumnHeadings();if(!c.applyingState){a.saveState()}a.fireEvent("filterupdate",c,b)}},onBeforeLoad:function(a,b){b.params=b.params||{};this.cleanParams(b.params);var c=this.buildQuery(this.getFilterData());Ext.apply(b.params,c)},onLoad:function(a){a.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var a=this,b=a.view.headerCt;if(b){b.items.each(function(d){var c=a.getFilter(d.dataIndex);d[c&&c.active?"addCls":"removeCls"](a.filterCls)})}},reload:function(){var b=this,a=b.view.getStore();if(b.local){a.clearFilter(true);a.filterBy(b.getRecordFilter());a.sort()}else{b.deferredUpdate.cancel();if(a.buffered){a.pageMap.clear()}a.loadPage(1)}},getRecordFilter:function(){var c=[],a,b;this.filters.each(function(d){if(d.active){c.push(d)}});a=c.length;return function(d){for(b=0;b<a;b++){if(!c[b].validateRecord(d)){return false}}return true}},addFilter:function(a){var f=this,c=f.getGridPanel().columns,b,h,e,g,d;for(b=0,h=c.length;b<h;b++){e=c[b];if(e.dataIndex===a.dataIndex){e.filter=a}}if(f.view.headerCt.menu){f.createFilters()}else{f.view.headerCt.getMenu()}for(b=0,g=f.filters.items.length;b<g;b++){d=f.filters.items[b];if(d.dataIndex===a.dataIndex){return d}}},addFilters:function(c){if(c){var b=this,a,d;for(a=0,d=c.length;a<d;a++){b.addFilter(c[a])}}},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(false)})},getFilterData:function(){var c=[],b,a;this.filters.each(function(e){if(e.active){var g=[].concat(e.serialize());for(b=0,a=g.length;b<a;b++){c.push({field:e.dataIndex,data:g[b]})}}});return c},buildQuery:function(b){var a={},c,h,j,e,k,d,g=b.length;if(!this.encode){for(c=0;c<g;c++){h=b[c];j=[this.paramPrefix,"[",c,"]"].join("");a[j+"[field]"]=h.field;e=j+"[data]";for(k in h.data){a[[e,"[",k,"]"].join("")]=h.data[k]}}}else{d=[];for(c=0;c<g;c++){h=b[c];d.push(Ext.apply({},{field:h.field},h.data))}if(d.length>0){a[this.paramPrefix]=Ext.JSON.encode(d)}}return a},cleanParams:function(c){if(this.encode){delete c[this.paramPrefix]}else{var b,a;b=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(a in c){if(b.test(a)){delete c[a]}}}},getFilterClass:function(a){switch(a){case"auto":a="string";break;case"int":case"float":a="numeric";break;case"bool":a="boolean";break}return Ext.ClassManager.getByAlias("gridfilter."+a)}});Ext.getHead().insertHtml("beforeEnd",'<style type="text/css">.x-selectable, .x-selectable * {    -khtml-user-select: text !important;    -moz-user-select: text !important;}</style>');Ext.require("Ext.view.Table",function(){Ext.override(Ext.view.Table,{afterrender:function(){var a=this;a.callParent();a.mon(a.el,{scroll:a.fireBodyScroll,scope:a});if(a.getFeature("selectable")===undefined){a.el.unselectable()}a.attachEventsForFeatures()}})});Ext.require("Ext.grid.feature.Feature",function(){Ext.define("LSP.view.dynamicgrid.feature.selectable",{extend:"Ext.grid.feature.Feature",alias:"feature.selectable",mutateMetaRowTpl:function(b){var a,c=b.length;for(a=0;a<c;a++){tpl=b[a];tpl=tpl.replace(/x-grid-row/,"x-grid-row x-selectable");tpl=tpl.replace(/x-grid-cell-inner x-unselectable/g,"x-grid-cell-inner");tpl=tpl.replace(/unselectable="on"/g,"");b[a]=tpl}}})});Ext.define("LSP.view.ux.download.FileDownload",{extend:"Ext.Component",alias:"widget.FileDownload",autoEl:{tag:"iframe",cls:"x-hidden",src:Ext.SSL_SECURE_URL},stateful:true,load:function(a){var b=this.getEl();b.dom.src=a.url+(a.params?"?"+Ext.urlEncode(a.params):"");b.dom.onload=function(){if(b.dom.contentDocument.body.childNodes[0].wholeText=="404"){Ext.Msg.show({title:"Attachment missing",msg:"The document you are after can not be found on the server.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}}}});Ext.define("LSP.view.dropdowns.conceptWikiProteinLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiProteinLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"concept_label"},{type:"string",name:"concept_url"},{type:"string",name:"define_url"},{type:"string",name:"concept_uuid"},{type:"string",name:"concept_alt_labels"},{type:"string",name:"tag_label"},{type:"string",name:"tag_uuid"},{type:"string",name:"match"}],proxy:{type:"ajax",api:{read:"/concept_wiki_api_calls/protein_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"concept_url",displayField:"concept_label",name:"protein_uri",minChars:4,hideTrigger:true,forceSelection:true,allowBlank:false,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,fieldLabel:"Protein name",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching proteins found.",getInnerTpl:function(){return'<p><span style="font-family: verdana; color: grey; "><small>Match: {match}</small></span><br/><b>{concept_label}</b> <a href="{define_url}" target="_blank">(definition)</a></p>'}}});Ext.define("Ext.ux.DataView.Animated",{defaults:{duration:750,idProperty:"id"},constructor:function(a){Ext.apply(this,a||{},this.defaults)},init:function(a){this.dataview=a;var c=this.idProperty,b=a.store;a.blockRefresh=true;a.updateIndexes=Ext.Function.createSequence(a.updateIndexes,function(){this.getTargetEl().select(this.itemSelector).each(function(f,g,e){f.id=f.dom.id=Ext.util.Format.format("{0}-{1}",a.id,b.getAt(e).internalId)},this)},a);this.dataviewID=a.id;this.cachedStoreData={};this.cacheStoreData(b.data||b.snapshot);a.on("resize",function(){var e=a.store;if(e.getCount()>0){}},this);a.store.on("datachanged",d,this);function d(o){var m=a.getTargetEl(),h=o.getAt(0),q=this.getAdded(o),y=this.getRemoved(o),j=this.getRemaining(o),v=Ext.apply({},j,q);Ext.each(y,function(D){var E=this.dataviewID+"-"+D.internalId;Ext.fly(E).animate({remove:false,duration:e,opacity:0,useDisplay:true,callback:function(){Ext.fly(E).setDisplayed(false)}})},this);if(h==undefined){this.cacheStoreData(o);return}this.cacheStoreData(o);var g=Ext.get(this.dataviewID+"-"+h.internalId);if(!g){a.refresh();return true}var A=o.getCount(),l=g.getMargin("lr")+g.getWidth(),w=g.getMargin("bt")+g.getHeight(),s=m.getWidth(),f=Math.floor(s/l),r=Math.ceil(A/f),B=Math.ceil(this.getExistingCount()/f);var k={},C={},t={};Ext.iterate(j,function(F,E){var F=E.internalId,D=t[F]=Ext.get(this.dataviewID+"-"+F);k[F]={top:D.getTop()-m.getTop()-D.getMargin("t")-m.getPadding("t"),left:D.getLeft()-m.getLeft()-D.getMargin("l")-m.getPadding("l")}},this);m.applyStyles({display:"block",position:"relative"});Ext.iterate(j,function(G,F){var D=k[G],E=t[G];if(E.getStyle("position")!="absolute"){t[G].applyStyles({position:"absolute",left:D.left+"px",top:D.top+"px"})}});var p=0;Ext.iterate(o.data.items,function(F){var J=F.internalId,E=t[J];var D=p%f,I=Math.floor(p/f),H=I*w,G=D*l;C[J]={top:H,left:G};p++},this);var u=new Date(),e=this.duration,n=this.dataviewID;var z=function(){var M=new Date()-u,O=M/e,D;if(O>=1){for(D in C){Ext.fly(n+"-"+D).applyStyles({top:C[D].top+"px",left:C[D].left+"px"})}Ext.TaskManager.stop(x)}else{for(D in C){if(!j[D]){continue}var G=k[D],J=C[D],H=G.top,K=J.top,F=G.left,L=J.left,I=O*Math.abs(H-K),N=O*Math.abs(F-L),P=H>K?H-I:H+I,E=F>L?F-N:F+N;Ext.fly(n+"-"+D).applyStyles({top:P+"px",left:E+"px"}).setDisplayed(true)}}};var x={run:z,interval:20,scope:this};Ext.TaskManager.start(x);Ext.iterate(q,function(E,D){Ext.fly(this.dataviewID+"-"+D.internalId).applyStyles({top:C[D.internalId].top+"px",left:C[D.internalId].left+"px"}).setDisplayed(true);Ext.fly(this.dataviewID+"-"+D.internalId).animate({remove:false,duration:e,opacity:1})},this);this.cacheStoreData(o)}},cacheStoreData:function(a){this.cachedStoreData={};a.each(function(b){this.cachedStoreData[b.internalId]=b},this)},getExisting:function(){return this.cachedStoreData},getExistingCount:function(){var c=0,b=this.getExisting();for(var a in b){c++}return c},getAdded:function(a){var b={};a.each(function(c){if(this.cachedStoreData[c.internalId]==undefined){b[c.internalId]=c}},this);return b},getRemoved:function(a){var b=[],c;for(c in this.cachedStoreData){if(a.findBy(function(d){return d.internalId==c})==-1){b.push(this.cachedStoreData[c])}}return b},getRemaining:function(a){var b={};a.each(function(c){if(this.cachedStoreData[c.internalId]!=undefined){b[c.internalId]=c}},this);return b}});Ext.define("LSP.view.target_by_name.TargetPanel",{extend:"Ext.panel.Panel",alias:"widget.TargetPanel",border:false,anchor:"100% 100%",autoScroll:true,bodyPadding:"10px",layout:"anchor",initComponent:function(){this.items=[{xtype:"panel",border:0,layout:"anchor",autoScroll:true,itemId:"dp",bodyPadding:"20px",cls:"target-data-panel",hidden:true,items:[{xtype:"panel",border:0,anchor:"100%",itemId:"topPanel",layout:"column",autoScroll:true,items:[{xtype:"image",itemId:"target_image",width:150,height:150,src:"./assets/target_placeholder.png"},{xtype:"panel",bodyPadding:30,columnWidth:1,border:0,autoScroll:true,itemId:"textDataPanel",layout:"anchor",items:[{xtype:"displayfield",anchor:"100%",itemId:"prefLabel",renderer:provenanceTargetSummaryRenderer,fieldCls:"target-title"},{xtype:"button",text:"Pharmacology Data",margin:"15 0 20 0",itemId:"pharmTargetButton",cls:"target-pharm-button"},{xtype:"displayfield",anchor:"100%",itemId:"target_type",fieldLabel:"Target Type",renderer:provenanceTargetSummaryRenderer,cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",itemId:"organism",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Organism",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",itemId:"description",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Description",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"synonyms",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Synonyms",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"specific_function",fieldLabel:"Specific Function",renderer:provenanceTargetSummaryRenderer,cls:"target-descriptions"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",itemId:"cellular_function",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Cellular Function",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"keywords",fieldLabel:"Keywords",renderer:provenanceTargetSummaryRenderer,cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"pdb_id_page",renderer:provenanceTargetSummaryRenderer,fieldLabel:"PDB Entry",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"cellular_location",fieldLabel:"Cellular Location",renderer:provenanceTargetSummaryRenderer,cls:"target-field-label"},{xtype:"panel",border:0,anchor:"100%",itemId:"numericDataPanel",layout:"column",bodyPadding:30,items:[{xtype:"displayfield",itemId:"molecular_weight",columnWidth:0.33,fieldLabel:"Molecular Weight",renderer:provenanceTargetSummaryRenderer,cls:"target-field-bottom",fieldCls:"target-field-bottom-field",labelAlign:"top"},{xtype:"displayfield",itemId:"number_of_residues",columnWidth:0.33,fieldLabel:"Number of Residues",renderer:provenanceTargetSummaryRenderer,cls:"target-field-bottom",fieldCls:"target-field-bottom-field",labelAlign:"top"},{xtype:"displayfield",itemId:"theoretical_pi",columnWidth:0.33,fieldLabel:"Theoretical Pi",renderer:provenanceTargetSummaryRenderer,cls:"target-field-bottom",fieldCls:"target-field-bottom-field",labelAlign:"top"},]}]}]}]},{xtype:"displayfield",border:0,padding:"20px",itemId:"msg",region:"center",hidden:true,fieldCls:"target-message",value:"message here"}];this.callParent(arguments)},resetAllFields:function(){var b=this.query("displayfield");Ext.each(b,function(c){c.hide()},this);var a=this.down("#target_image");a.setSrc("./assets/target_placeholder.png");this.doLayout()},showMessage:function(a){var c=this.down("#dp");var b=this.down("#msg");c.setVisible(false);b.setValue(a);b.setVisible(true)},showData:function(c,b,g){console.log("LSP.view.target_by_name.TargetPanel: showData()");if(g){var f=c.first().data;if(b.length>0&&f.hasOwnProperty("prefLabel")){var e=this.down("#dp");var d=this.down("#msg");d.setVisible(false);this.setValues(c.first());e.setVisible(true)}else{this.showMessage("No records found within OPS for this search")}}else{this.showMessage("Server did not respond")}this.up("TargetByNameForm").setLoading(false);var a=Ext.ComponentQuery.query("#TargetByNameSubmit_id")[0].enable()},clearDomBelow:function(a){if(a.hasChildNodes()){while(a.childNodes.length>0){a.removeChild(a.firstChild)}}},addKeywords:function(d){var g=d.split(",");var e=this.down("#keywords");var j=e.bodyEl;var c=j.dom;this.clearDomBelow(c);var b;if(target_name_provenance){var a=recordData.data.keywords_src;var k=recordData.data.keywords_item;var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];h+="Icon";h="/assets/"+h+".png";b='{kw} <a href="'+k+'"><img src="'+h+'" title='+a+' height="15" width="15"/></a>'}else{b="{kw}"}var f=Ext.DomHelper.createTemplate({tag:"div",cls:"keyword",html:b});Ext.each(g,function(l){f.append(j,{kw:l.trim()})},this);e.show()},addOrganism:function(d){var f=this.down("#organism");var g=f.bodyEl;var c=g.dom;this.clearDomBelow(c);var b;if(target_name_provenance){var j=recordData.data.organism_item;var a=recordData.data.organism_src;var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];h+="Icon";h="/assets/"+h+".png";b='{org} <a href="'+j+'" target="_blank"><img src="'+h+'" title='+a+' height="15" width="15"/></a>'}else{b="{org}"}var e=Ext.DomHelper.createTemplate({tag:"div",cls:"organism",html:"output"});e.append(g,{org:d});f.show()},addSynonyms:function(f){var g=f.split(" , ");var e=this.down("#synonyms");var j=e.bodyEl;var c=j.dom;this.clearDomBelow(c);var b;if(target_name_provenance){var a=recordData.data.synonyms_src;var k=recordData.data.synonyms_item;var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];h+="Icon";h="/assets/"+h+".png";b='{syn} <a href="'+k+'" target="_blank"><img src="'+h+'" title='+a+' height="15" width="15"/></a>'}else{b="{syn}"}var d=Ext.DomHelper.createTemplate({tag:"div",cls:"synonym",html:b});Ext.each(g,function(l){d.append(j,{syn:l})},this);e.show()},addPDBImage:function(c){var g=new String(c);var e=new String();var b,f;g=g.split(",");Ext.each(g,function(j,h){b=j.split("/").pop();if(h==0){f=b}e+="<a target='_blank' href='"+j+"'>"+b+"</a>   "},this);var a=this.down("#target_image");var d=this.down("#pdb_id_page");d.setRawValue(e);d.show();a.setSrc("http://www.rcsb.org/pdb/images/"+f+"_asr_r_250.jpg");a.show()},setFieldValue:function(c,g){if(c=="synonyms"){if(g!=null){var h=this.down("#"+c);var b=new String(g);var d=b.replace(new RegExp(" ,","g"),",");h.setValue(d);h.show()}}else{if(c=="keywords"){if(g!=null){var j=this.down("#"+c);var e=g.join(", ");j.setValue(e);j.show()}}else{if(c=="organism"){if(g!=null){this.addOrganism(g)}}else{if(c=="pdb_id_page"){if(g!=""&&g!=null){this.addPDBImage(g)}}else{if(c=="cellular_location"){if(g!=null){var a=this.down("#"+c);var k=g.replace(new RegExp(" ,","g"),",");a.setValue(k);a.show()}}else{var f=this.down("#"+c);if(f!=null){f.setValue(g);f.show()}}}}}}},setValues:function(a){this.resetAllFields();var d=a.data;recordData=a;var b=this.down("#pharmTargetButton");b.hide();b.setHandler(function(){Ext.History.add("!p=PharmByTargetNameForm&u="+a.store.proxy.extraParams.uri)});b.show();for(var c in d){if(d.hasOwnProperty(c)){if(d[c]){this.setFieldValue(c,d[c])}}}this.doLayout()},toggleProv:function(a){target_name_provenance=a;console.log(" Show provenance : "+target_name_provenance)}});var target_name_provenance=false;var recordData;function provenanceTargetSummaryRenderer(f,e){var b=new Array();b["http://www.chemspider.com"]="ChemSpider";b["http://data.kasabi.com/dataset/chembl-rdf"]="Chembl";b["http://linkedlifedata.com/resource/drugbank"]="DrugBank";b["http://www.conceptwiki.org"]="ConceptWiki";b["http://purl.uniprot.org"]="UniProt";if(target_name_provenance){var d=e.itemId;var j=d+"_item";d+="_src";var a=recordData.data[d];var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!h){h="defaultValue"}var g=h+"Icon";g="/assets/"+g+".png";h+=LDAProvenanceMode;h+="Summary";var c;c="<div>"+f+'   <a href="'+recordData.data[j]+'" target="_blank"><img src="'+g+'" title='+b[a]+' height="15" width="15"/></a></div>';return c}else{return f}}Ext.define("LSP.model.GuiComponent",{extend:"Ext.data.Model",fields:["xtype","url","id","text","home"]});Ext.define("LDA.helper.JamesQueryStringEncoder",{extend:"Ext.Base",toQueryString:function(c){var b=[],h=[],d,a,e,g,f;for(d in c){if(c.hasOwnProperty(d)){b=b.concat(Ext.Object.toQueryObjects(d,c[d],false))}}for(a=0,e=b.length;a<e;a++){g=b[a];f=g.value;if(Ext.isEmpty(f)){continue}else{if(Ext.isDate(f)){f=Ext.Date.toString(f)}}h.push(encodeURIComponent(g.name)+"="+encodeURIComponent(String(f)))}return h.join("&")}});Ext.define("LSP.controller.BackgroundTasks",{extend:"Ext.app.Controller",views:["background_tasks.BackgroundTasksForm"],refs:[{ref:"tasksContainer",selector:"#tasks_container"}],task_list:new Array(),init:function(){this.control({"#background_tasks_form":{taskadded:this.addNewTask}})},removeTask:function(){runner=this.getTaskRunner();if(runner){runner.destroy()}this.close()},addNewTask:function(a,f){console.log("adding task with uuid : "+a);var e=this;this.task_list.push(a);var d=f;var b=Ext.create("LSP.view.background_tasks.BackgroundTask",{});b.down("#type").setText(f+"....creating");b.down("#type").setHeight("auto");b.down("#cancel_button").on({click:{fn:e.removeTask,scope:b}});this.getTasksContainer().add(b);var j=Ext.create("LDA.store.TSVStatusStore",{});j.setUUID(a);j.setTask(b);j.setTasksContainer(this.getTasksContainer());var c=function(){this.load({params:{uuid:this.getUUID()},callback:function(n,m,o){if(o){console.log("success tsv status");var l=n[0].data.status;var k=n[0].data.percentage;if(k!="0"){this.getTask().down("#progress").updateProgress(k/100,"",true);this.getTask().down("#type").setText(d+"....creating("+k+"%)")}if(l=="finished"){this.getTask().down("#progress").hide();this.getTask().down("#type").setText(f+"...ready for download");this.getTaskRunner().destroy();tsv_download_button=Ext.create("Ext.Button",{text:"Download tsv file",tooltip:"Download results as a tab separated file",itemId:"tsvDownloadProxy_"+this.getUUID(),iconCls:"icon-csv",hidden:false,disabled:false,margin:"2",href:tsv_download_url,renderTo:Ext.getBody()});tsv_download_button.href=tsv_download_url+"uuid="+this.getUUID();tsv_download_button.setParams();this.getTask().add(tsv_download_button)}else{if(l=="failed"){this.getTask().down("#progress").hide();this.getTask().down("#type").setText(f+"...FAILED");this.getTaskRunner().destroy()}}}else{console.log("fail tsv status")}}})};var h=new Ext.util.TaskRunner();j.setTaskRunner(h);var g=h.start({run:c,interval:5000,scope:j});b.setTaskRunner(h)}});Ext.define("LSP.view.target_by_name.TargetByNameForm",{extend:"Ext.form.Panel",alias:"widget.TargetByNameForm",closable:true,header:false,requires:["LSP.view.dropdowns.conceptWikiProteinLookup","LSP.view.target_by_name.TargetPanel"],layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Start typing in protein name and species. E.g. "Adenosine receptor A2a (Homo sapiens)"</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[Ext.create("CW.view.ConceptWikiLookup",{fieldLabel:"Target name",itemId:"targetByNameLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),extraParams:{branch:3}}}),name:"protein_uri",cwTagUuid:"eeaec894-d856-4106-9fa1-662b1dc6c6f1"}),{xtype:"button",padding:"5 5 5 5",text:"Search",itemId:"TargetByNameSubmit_id",disabled:true,action:"query_target_by_name"},{xtype:"radiogroup",width:160,labelWidth:65,fieldLabel:"Provenance",itemId:"provId",margin:"5 0 0 90",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]}]},{xtype:"TargetPanel",flex:1}];this.callParent(arguments)}});Ext.define("LSP.controller.TargetByNameForm",{extend:"Ext.app.Controller",views:["target_by_name.TargetByNameForm"],current_uri:null,refs:[{ref:"targetPanel",selector:"TargetPanel"},{ref:"formView",selector:"TargetByNameForm"},{ref:"submitButton",selector:"#TargetByNameSubmit_id"},{ref:"lookup",selector:"#targetByNameLookup"}],init:function(){this.control({"TargetByNameForm button[action=query_target_by_name]":{click:this.submitQuery},"TargetByNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},TargetByNameForm:{historyToken:this.handleHistoryToken},"TargetByNameForm #provId":{change:this.onProvChange}})},handleHistoryToken:function(b){console.log("LSP.controller.TargetByNameForm: handleHistoryToken()");var c=this;var e=c.getFormView().down("TargetPanel");if(b.u){this.current_uri=b.u;var a=this.getStore("LDA.store.TargetStore");if(b.u!=a.proxy.extraParams.uri){var g=this.getController("CW.controller.ConceptWikiLookup");var f=this.getFormView().down("conceptWikiLookup");g.setConcept(b.u,f,a);a.proxy.extraParams.uri=b.u;c.getFormView().setLoading(true);a.load(function(j,h,k){if(k){console.log("LSP.controller.TargetByNameForm: store is loaded "+k);c.getSubmitButton().enable();e.setValues(j[0]);e.recordData=j[0];e.down("#dp").setVisible(true);e.down("#msg").setVisible(false);c.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});c.getSubmitButton().enable();e.down("#dp").setVisible(false);c.getFormView().setLoading(false)}})}}else{if(b.s){var d=this.getLookup();d.setRawValue(b.s);d.doQuery(b.s)}}},enableSubmit:function(){var b=this.getFormView();var a=this.getSubmitButton();a.enable()},submitQuery:function(c){c.disable();var e=this;var d=this.getFormView();var f=e.getFormView().down("TargetPanel");var a=d.getValues().protein_uri;if(this.current_uri==a){var b=this.getStore("LDA.store.TargetStore");b.proxy.extraParams.uri=this.current_uri;e.getFormView().setLoading(true);b.load(function(h,g,j){if(j){console.log("LSP.controller.TargetByNameForm: store is loaded "+j);e.getSubmitButton().enable();f.setValues(h[0]);f.recordData=h[0];f.down("#dp").setVisible(true);f.down("#msg").setVisible(false);e.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});e.getSubmitButton().enable();f.down("#dp").setVisible(false);e.getFormView().setLoading(false)}})}else{Ext.History.add("!p=TargetByNameForm&u="+a)}},onProvChange:function(d,b,a){var c=this.getTargetPanel();c.toggleProv(b.prov);c.setValues(c.recordData)}});Ext.define("LSP.store.GuiComponents",{extend:"Ext.data.Store",id:"GuiComponents",model:"LSP.model.GuiComponent",autoLoad:true,data:[{url:"users.json",text:"Users",id:3,xtype:"dynamicgrid",home:"Users grid"},{url:"rdf.json",text:"SPARQL",id:5,xtype:"queryform",home:"SPARQL form"},{url:"",text:"Compound by name",id:18,xtype:"CmpdByNameForm",home:"Compound by name"},{url:"",text:"Compound by structure",id:23,xtype:"SimSearchForm",home:"Compound Structure Search"},{url:"",text:"Target by name",id:24,xtype:"TargetByNameForm",home:"Target by name"},{url:"",text:"X-Target by sequence",id:25,xtype:"temp",home:""},{url:"",text:"Pharmacology by Target",id:26,xtype:"PharmByTargetNameForm",home:"Pharmacology by Target Name"},{url:"",text:"Pharmacology by Compound",id:27,xtype:"PharmByCmpdNameForm",home:"Pharmacology by Compound name"},{url:"",text:"Pharmacology by Enzyme family",id:28,xtype:"PharmEnzymeForm",home:"Compounds active against enzyme family"},{url:"",text:"X-Polypharmacology Browser",id:34,xtype:"temp",home:""},{url:"",text:"X-Target Dossier",id:35,xtype:"temp",home:""},{url:"",text:"X-Chem-Bio Navigator",id:36,xtype:"temp",home:""}]});Ext.define("LSP.controller.NavigationTree",{extend:"Ext.app.Controller",stores:["NavigationTree","GuiComponents"],views:["Appmoduletree"],init:function(){}});Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux.DataView","/ext/examples/ux/DataView/");Ext.define("LSP.view.dataview.StructureViewer",{extend:"Ext.window.Window",alias:"widget.StructureViewer",requires:["Ext.form.Panel","Ext.util.*","Ext.ux.DataView.Animated"],title:"Structures",layout:"fit",modal:true,autoShow:true,height:570,width:810,initComponent:function(){var b=structureViewStore;var a=Ext.create("Ext.view.View",{deferInitialRefresh:false,store:b,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="structure_data_view-wrap">','<p height="180">','<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>','<br /><strong>Chemspider id : <a href ="http://inchi.chemspider.com/Chemical-Structure.{csid}.html" target="_blank">{csid}</a></strong>',"</p>","</div>","</tpl>"),plugins:[Ext.create("Ext.ux.DataView.Animated",{duration:550,idProperty:"csid"})],itemSelector:"div.structure_data_view-wrap",overItemCls:"x-view-over_structure_dv",singleSelect:true,autoScroll:true});this.items=[{xtype:"form",padding:"0 0 0 0",border:false,autoScroll:true,style:"background-color: #fff;",items:a}];this.buttons=[{text:"Use structure",action:"commit_structure"},{text:"Cancel",scope:this,handler:this.close}];this.callParent(arguments)}});Ext.define("LDA.store.basestores.BaseStore",{extend:"Ext.data.Store",requires:["LDA.helper.LDAConstants"],_format:"json",uri:"",BASE_URL:"",remoteSort:true,typeName:"",stringEncoder:Ext.create("LDA.helper.JamesQueryStringEncoder"),proxy:{type:"jsonp",noCache:false,startParam:undefined,limitParam:undefined,pageParam:undefined,callbackKey:"_callback",listeners:{exception:function(c,a,b){}}},prefetchPage:function(e,b){var d=this,a=d.pageSize||d.defaultPageSize,f=(e-1)*d.pageSize,c=d.totalCount;if(c!==undefined&&d.getCount()===c&&d.getCount()>a){return}d.prefetch(Ext.applyIf({page:e,start:f,limit:a},b))},listeners:{beforeprefetch:{fn:function(){var a=this;a.updateProxyURL()}},beforeload:{fn:function(){var a=this;a.updateProxyURL()}}},sort:function(){var b=this,a=b.pageMap;if(b.buffered){if(b.remoteSort){a.clear();this.sortColumn(arguments);this.currentPage=1;this.guaranteeRange(0,49)}else{b.callParent(arguments)}}else{b.callParent(arguments)}},setURI:function(a){this.uri=a},updateProxyURL:function(){this.proxy.url=this.BASE_URL+this.stringEncoder.toQueryString({_format:this._format,uri:this.uri})},setTypeName:function(a){this.typeName=a},getTypeName:function(){return this.typeName}});Ext.define("LDA.store.FilterUnitsStore",{extend:"LDA.store.basestores.BaseStore",model:"LDA.model.FilterUnitsModel",storeId:"FilterUnitsStore",BASE_URL:ldaBaseUrl+"/pharmacology/filters/units/",activity_type:undefined,constructor:function(a,b){console.log("LDA.store.FilterUnitsStore: constructor()");this.proxy.reader=Ext.create("LDA.helper.FilterUnitsReader");this.BASE_URL+=a.activity_type+"?";this.callParent(b)}});Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux.grid","ext/examples/ux/grid");Ext.define("LSP.view.dynamicgrid.DynamicGrid",{extend:"Ext.grid.Panel",alias:"widget.dynamicgrid",requires:["LDA.helper.FilterUnitsReader","LDA.store.FilterUnitsStore","LDA.model.FilterUnitsModel","Ext.grid.RowNumberer","Ext.form.*","Ext.ux.grid.FiltersFeature","Ext.selection.CellModel","LSP.view.dynamicgrid.feature.selectable","LSP.view.ux.download.FileDownload"],viewConfig:{enableTextSelection:true},exportStore:null,exportCSVReady:false,exportSDFReady:false,rowNumberer:true,defaultWidth:200,showMenu:function(k,j,e){var l=e.data.compound_pref_label;var q=e.data.targets;var p;if(q){p=e.data.targets[0]}var h=e.data.target_pref_label_item;var m=e.data.compound_smiles;var g=e.data.cw_compound_uri;var f=e.data.cs_compound_uri;var a;if(f!=null){a=Ext.create("Ext.menu.Item",{text:"View chemspider info",iconCls:"menu-search-compound",handler:function(){var t=f.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];if(parseInt(t)>=1){Ext.create("CS.view.CompoundWindow").showCompound(t)}}})}var o;var r=new Array();if(q){if(e.data.targets.length>1){target_text_items=new Array();Ext.each(e.data.targets,function(u,t){if(u.title!=""){r.push({text:u.title,iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&s="+u.title)}});target_text_items.push({xtype:"textfield",value:u.title})}});var b=Ext.create("Ext.menu.Menu",{text:"View target info",items:r});var n=Ext.create("Ext.menu.Menu",{text:"View target info",items:target_text_items});o=Ext.create("Ext.menu.Item",{text:"View target info",iconCls:"menu-search-target",menu:b});text_menu_item=Ext.create("Ext.menu.Item",{text:"Copy target data",menu:target_text_items})}else{var d=e.data.targets[0].cw_uri;if(d!=null&&d!=""){o=Ext.create("Ext.menu.Item",{text:"View target info",iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&u="+d)}})}else{o=Ext.create("Ext.menu.Item",{text:"View target info",iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&s="+e.data.targets[0].title)}})}text_menu_item={xtype:"textfield",value:e.data.targets[0].title}}}if(p){var c=new Ext.menu.Menu({items:[{xtype:"textfield",value:l},{xtype:"textfield",value:m}]});if(text_menu_item!=null){c.insert(1,text_menu_item)}var s=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+g)}},{text:"Search for compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+m+"&st=exact")}},{text:"Copy Data",menu:c}]});if(q.length>0){s.insert(s.items.length-2,o)}if(a!=null){s.insert(s.items.length-1,a)}s.showAt(k,j)}else{var c=new Ext.menu.Menu({items:[{xtype:"textfield",value:l},{xtype:"textfield",value:m}]});var s=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+g)}},{text:"Search for compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+m+"&st=exact")}},{text:"Copy Data",menu:c}]});if(a!=null){s.insert(s.items.length-1,a)}s.showAt(k,j)}},initComponent:function(){console.log("DynamicGrid: initComponent()");var c={ftype:"filters",encode:true,local:true};var d={ftype:"selectable",id:"selectable"};var a=this.getExportStore();var b={tbar:[{xtype:"button",text:"Prepare tsv file",tooltip:"Prepare results as a tab separated file",itemId:"tsvDownloadProxy_id",iconCls:"icon-csv",hidden:false,disabled:true,},{xtype:"tbseparator"},{xtype:"button",text:"Download SD file ",tooltip:"Download results in SD file format",itemId:"sdfDownloadProxy_id",iconCls:"icon-sdf",hidden:true,disabled:true},],features:[c,d]};Ext.apply(this,b);Ext.apply(this.initialConfig,b);this.callParent(arguments)}});CSV_EXPORT_LIMIT=10000;Ext.define("LSP.controller.grids.DynamicGrid",{extend:"Ext.app.Controller",views:["dynamicgrid.DynamicGrid"],models:["DynamicGrid","Unit"],refs:[{ref:"gridView",selector:"dynamicgrid"}],current_jobs:new Array(),init:function(){console.log("DynamicGrid: init()");this.control({dynamicgrid:{itemcontextmenu:function(d,c,b,e,a,f){a.preventDefault();this.getGridView().showMenu(a.getX(),a.getY(),c)}},"dynamicgrid toolbar #sdfDownloadProxy_id":{click:this.prepSDFile}})},onLaunch:function(){},testThis:function(a){},prepareTSVDownload:function(){var g=this;var h=this.getGridView();var e,a,l,b,f,j,d,c,k;var m=Ext.create("LDA.store.TSVCreateStore",{});Ext.ComponentQuery.query("#background_tasks_form")[0].expand();Ext.each(this.getFilters(),function(o,n){if(o.filterType=="activity"){e=h.store.getActivityConditionParam();a=h.store.activity_type;l=h.store.activity_value;b=h.store.activity_unit}else{if(o.filterType=="organism"){f=h.store.assay_organism}else{if(o.filterType=="target"){j=h.store.target_organism}}}});d=h.store.proxy.extraParams.uri;c=h.store.getTotalCount();k=h.store.REQUEST_TYPE;m.load({params:{activity_value_type:e,activity_type:a,activity_value:l,activity_unit:b,assay_organism:f,target_organism:j,uri:d,total_count:c,request_type:k},callback:function(o,n,p){if(p){console.log("success tsv create");uuid=o[0].data.uuid;g.current_jobs.push(uuid);background_tasks_form=Ext.ComponentQuery.query("#background_tasks_form")[0];background_tasks_form.fireEvent("taskadded",uuid,g.getGridView().getStore().getTypeName())}else{console.log("fail tsv create")}}})},setTSVDownloadParams:function(){var c=this.getTsvDownloadButton();var a=this.getGridView();var b=new Array();Ext.each(this.getFilters(),function(e,d){if(e.filterType=="activity"){b.push("activity_value_type="+a.store.getActivityConditionParam()+"&activity_type="+a.store.activity_type+"&activity_value="+a.store.activity_value+"&activity_unit="+a.store.activity_unit)}else{if(e.filterType=="organism"){b.push("assay_organism="+a.store.assay_organism)}}});b.push("uri="+a.store.proxy.extraParams.uri+"&total_count="+a.store.getTotalCount()+"&request_type="+a.store.REQUEST_TYPE);total_params=b.join("&");c.href=tsv_download_url+"?"+total_params;c.setParams()},addCompletedActivityFilter:function(b){console.log("DynamicGrid: addCompletedActivityFilter()");activity_value=this.getFilterContainer().down("#activity_combobox_id").getValue();conditions_value=this.getFilterContainer().down("#conditions_combobox_id").getValue();value_value=this.getFilterContainer().down("#value_textfield_id").getValue();unit_value=this.getFilterContainer().down("#unit_combobox_id").getValue();unit_text=this.getFilterContainer().down("#unit_combobox_id").getRawValue();if(activity_value!=null&&conditions_value!=null&&value_value!=""&unit_value!=null){filter=Ext.create("LSP.model.Filter",{activity:activity_value,condition:conditions_value,value:value_value,unit:unit_value,unit_text:unit_text});filter.filterType="activity";this.getFilters().push(filter);filter.controller=this;filter_view=Ext.create("LSP.view.filter.CompletedActivityFilter",{});filter_view.down("#activityLabel_id").setText(activity_value);filter_view.down("#conditionsLabel_id").setText(conditions_value);filter_view.down("#valueLabel_id").setText(value_value);filter_view.down("#unitLabel_id").setText(unit_text);filter.filterView=filter_view;this.getFormView().down("#completedFilterContainer_id").add(filter_view);this.getFormView().down("#completedFilterContainer_id").setVisible(true);filter_view.filterModel=filter;filter_view.on({close:this.removeFilter});var c=this.getGridView();var a=c.store;a.filters=this.getFilters();a.setActivityType(activity_value);a.setActivityValue(value_value);a.setActivityCondition(conditions_value);a.setActivityUnit(unit_value);this.getFormView().down("#addCompletedActivityFilter_id").disable()}else{Ext.MessageBox.show({title:"Error",msg:"Filter options cannot be empty.<br>Please select a value for each of the filter options.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},addCompletedOrganismFilter:function(b){console.log("DynamicGrid: addCompletedOrganismFilter()");organism_value=this.getFilterContainer().down("#organism_combobox_id").getValue();if(organism_value!=null){filter=Ext.create("LSP.model.Filter",{value:organism_value});filter.filterType="organism";this.getFilters().push(filter);filter.controller=this;filter_view=Ext.create("LSP.view.filter.CompletedOrganismFilter",{});filter_view.down("#valueLabel_id").setText("Assay Organism");filter_view.down("#conditionsLabel_id").setText("=");filter_view.down("#organismType_id").setText(organism_value);filter.filterView=filter_view;this.getFormView().down("#completedFilterContainer_id").add(filter_view);this.getFormView().down("#completedFilterContainer_id").setVisible(true);filter_view.filterModel=filter;filter_view.on({close:this.removeFilter});var c=this.getGridView();var a=c.store;a.filters=this.getFilters();a.setAssayOrganism(organism_value);this.getFormView().down("#addCompletedOrganismFilter_id").disable()}else{Ext.MessageBox.show({title:"Error",msg:"Filter options cannot be empty.<br>Please select a value for each of the filter options.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},addCompletedTargetOrganismFilter:function(b){console.log("DynamicGrid: addCompletedTargetOrganismFilter()");organism_value=this.getFilterContainer().down("#target_organism_combobox_id").getValue();if(organism_value!=null){filter=Ext.create("LSP.model.Filter",{value:organism_value});filter.filterType="target";this.getFilters().push(filter);filter.controller=this;filter_view=Ext.create("LSP.view.filter.CompletedTargetOrganismFilter",{});filter_view.down("#valueLabel_id").setText("Target Organism");filter_view.down("#conditionsLabel_id").setText("=");filter_view.down("#organismType_id").setText(organism_value);filter.filterView=filter_view;this.getFormView().down("#completedFilterContainer_id").add(filter_view);this.getFormView().down("#completedFilterContainer_id").setVisible(true);filter_view.filterModel=filter;filter_view.on({close:this.removeFilter});var c=this.getGridView();var a=c.store;a.filters=this.getFilters();a.setTargetOrganism(organism_value);this.getFormView().down("#addCompletedTargetOrganismFilter_id").disable()}else{Ext.MessageBox.show({title:"Error",msg:"Filter options cannot be empty.<br>Please select a value for each of the filter options.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},removeFilter:function(c){console.log("DynamicGrid: filterClosed()");controller=c.filterModel.controller;var d=controller.getGridView();var a=d.store;if(c.filterModel.filterType=="activity"){var b=controller.getFilters().indexOf(c.filterModel);controller.getFilters().splice(b,1);a.filters=controller.getFilters();a.setActivityType("");a.setActivityValue("");a.setActivityCondition("");a.setActivityUnit("");controller.getFormView().down("#addCompletedActivityFilter_id").enable()}else{if(c.filterModel.filterType=="organism"){var b=controller.getFilters().indexOf(c.filterModel);controller.getFilters().splice(b,1);a.filters=controller.getFilters();a.setAssayOrganism(null);controller.getFormView().down("#addCompletedOrganismFilter_id").enable()}else{if(c.filterModel.filterType=="target"){var b=controller.getFilters().indexOf(c.filterModel);controller.getFilters().splice(b,1);a.filters=controller.getFilters();a.setTargetOrganism(null);controller.getFormView().down("#addCompletedTargetOrganismFilter_id").enable()}}}},addFilterForm:function(a){console.log("DynamicGrid: addFilterForm()");hide=this.getFilterContainer().hidden;if(hide){this.getFilterContainer().setVisible(true)}else{this.getFilterContainer().setVisible(false)}},prepSDFile:function(a){Ext.MessageBox.show({title:"Info",msg:"SD file export is not available in this release. The functionality will be available in the next release.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},updateSDFStatus:function(e,c,a){var b=c.data.items;var d=b.length;var f=0;var g=0;Ext.each(b,function(h){if(h.molfile!==undefined){g++}});e.setText("SD-File "+(100*g/a).toFixed(0)+"% ready");if(g>=0.98*a){e.setText("SD-File ready! Click ->");e.up("grid").down("#sdfDownload_id").enable();e.up("grid").exportSDFReady=true;e.up("form").setLoading(false)}},getMolfile:function(b,c,d,a){var f=this;var g=Ext.create("CS.store.Compound");var e=c.length;g.load({params:{"csids[0]":b},callback:function(k,h,m){if(m){var j=g.first().raw.Mol;for(i=0;i<e;i++){var l=d.getAt(c[i]);l.molfile=j}f.updateSDFStatus(a,d)}else{}}},this)},prepGrid:function(){console.log(this.$className+": prepGrid()");this.filters=new Array();var b=this.getGridView();var a=b.getStore();a.on("prefetch",this.storeLoadComplete,this)},storeLoadComplete:function(b,a,c){console.log(this.$className+": storeLoadComplete()");grid_view=this.getGridView();grid_store=grid_view.getStore();if(c){this.setTSVDownloadParams();grid_view.down("#sdfDownloadProxy_id").enable();grid_view.down("#tsvDownloadProxy_id").enable();this.getSubmitButton().enable();grid_view.setLoading(false);grid_view.setTitle(grid_view.gridBaseTitle+" - Total Records: "+grid_store.getTotalCount())}else{console.log(this.$className+": possible timeout for with uri "+grid_store.proxy.url);this.getSubmitButton().enable();grid_view.setLoading(false);grid_view.setTitle(grid_view.gridBaseTitle+" ---- There was an error retrieving some of the records ----")}},fetchTotalResults:function(){console.log("DynamicGrid: fetchTotalResults() for "+this.$className);try{var e=this.getGridView();var c=e.getStore();var d=this.getFormView();var b=this.getSubmitButton();this.resetDownload();countStore=this.getCountStore();countStore.uri=c.proxy.reader.uri;Ext.each(this.getFilters(),function(g,f){if(g.filterType=="activity"){countStore.setActivityType(g.data.activity);countStore.setActivityValue(g.data.value);countStore.setActivityCondition(g.data.condition);countStore.setActivityUnit(g.data.unit)}else{if(g.filterType=="organism"){countStore.setAssayOrganism(g.data.value)}else{if(g.filterType=="target"){countStore.setTargetOrganism(g.data.value)}}}});countStore.load(function(g,f,h){if(h){total=f.response.result.primaryTopic[this.countNode];c.proxy.reader.total_count=total;if(total==0){e.setTitle(e.gridBaseTitle+" - No records found within OPS for this search!");e.down("#sdfDownloadProxy_id").disable();e.down("#tsvDownloadProxy_id").disable();b.enable();e.setLoading(false);Ext.MessageBox.show({title:"Info",msg:"The OPS system does not contain any data that match this search.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{e.setLoading(false);c.guaranteeRange(0,49)}}else{e.setTitle(e.gridBaseTitle+" - We are sorry but the OPS system returned an error!");e.down("#sdfDownloadProxy_id").disable();e.down("#tsvDownloadProxy_id").disable();b.enable();e.setLoading(false);Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}})}catch(a){console.log("DynamicGrid: exception fetching results for "+this.$className+"with uri "+c.proxy.uri);Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}},enableSubmit:function(a){this.getGridView().getStore().setTypeName(a.rawValue);this.getSubmitButton().enable()},resetDownload:function(){var a=this.getGridView();a.exportCSVReady=false;a.exportSDFReady=false;a.getExportStore().removeAll(true)},onProvChange:function(d,b,a){var c=this.getGridView();c.toggleProv(b.prov);c.getView().refresh()},getFilters:function(){if(this.filters==null){this.filters=new Array()}return this.filters},getRequestType:function(){return this.request_type}});Ext.define("LSP.view.larkc_sim_search.SimSearchScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.SimSearchScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:["LDA.model.SimModel"],refs:[],store:Ext.create("LDA.store.SimSearchLocalStore",{}),exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.SimSearchStore",{})}return this.exportStore},columns:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_uri",xtype:"templatecolumn",tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',width:135,sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",renderer:structureProvenanceRenderer,width:180,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Molecular Formula",dataIndex:"molform",renderer:structureProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"ALogP",dataIndex:"alogp",renderer:structureProvenanceRenderer,width:60,align:"center",tdCls:"gridRowPadding"},{header:"# HBA",dataIndex:"hba",renderer:structureProvenanceRenderer,tooltip:"Number of Hydrogen Bond Acceptors",width:60,align:"center",tdCls:"gridRowPadding"},{header:"# HBD",dataIndex:"hbd",renderer:structureProvenanceRenderer,tooltip:"Number of Hydrogen Bond Donors",width:60,align:"center",tdCls:"gridRowPadding"},{header:"Mol Weight",dataIndex:"full_mwt",renderer:structureProvenanceRenderer,tooltip:"Molecular Weight",width:70,align:"center",tdCls:"gridRowPadding"},{header:"MW Freebase",dataIndex:"mw_freebase",renderer:structureProvenanceRenderer,tooltip:"Molecular Weight (Free Base)",align:"center",tdCls:"gridRowPadding"},{header:"# RTB",dataIndex:"rtb",renderer:structureProvenanceRenderer,tooltip:"Number of Rotatable Bonds",width:60,align:"center",tdCls:"gridRowPadding"},{header:"Melting Point",dataIndex:"meltingPoint",renderer:structureProvenanceRenderer,width:140,tdCls:"wrap gridDescriptiveRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:structureProvenanceRenderer,width:135,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"inchi",renderer:structureProvenanceRenderer,width:135,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"inchi_key",renderer:structureProvenanceRenderer,width:135,align:"center",tdCls:"gridRowPadding"}],simSearchProv:false,toggleProv:function(a){this.simSearchProv=a;console.log(" Show provenance : "+this.simSearchProv);this.doLayout()},showMenu:function(l,j,f){var k=f.data.compound_pref_label;var h=f.data.target_title;var g=f.data.compound_smiles;var e=f.data.cw_uri;var b=f.data.cs_uri;var c;if(b!=null){c=Ext.create("Ext.menu.Item",{text:"View chemspider info",iconCls:"menu-search-compound",handler:function(){var m=b.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];if(parseInt(m)>=1){Ext.create("CS.view.CompoundWindow").showCompound(m)}}})}if(h){var a=new Ext.menu.Menu({items:[{xtype:"textfield",value:k},{xtype:"textfield",value:h},{xtype:"textfield",value:g}]});var d=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+e)}},{text:"View target info",itemId:"searchForTarget",iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&s="+h)}},{text:"Search for a compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+g+"&st=exact")}},{text:"Copy Data",menu:a}]});if(c!=null){d.insert(d.items.length-1,c)}d.showAt(l,j)}else{var a=new Ext.menu.Menu({items:[{xtype:"textfield",value:k},{xtype:"textfield",value:g}]});var d=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+e)}},{text:"Search for a compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+g+"&st=exact")}},{text:"View compound pharmacology info",itemId:"searchForPharmacologyByCompound",iconCls:"menu-search-compound",handler:function(){if(e){Ext.History.add("!p=PharmByCmpdNameForm&u="+e)}else{Ext.History.add("!p=PharmByCmpdNameForm&s="+k)}}},{text:"Copy Data",menu:a}]});if(c!=null){d.insert(d.items.length-1,c)}d.showAt(l,j)}}});function structureProvenanceRenderer(b,h,c,f,d,g){if(this.simSearchProv){var e=this.columns[d].dataIndex;var l=e+"_item";e+="_src";var a=c.data[e];var k=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!k){k="defaultValue"}var j=k+"Icon";j="/assets/"+j+".png";k+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(c.data[e]&&b){return'<div class="'+k+'">'+b+'</div><br><a href="'+c.data[l]+'" target="_blank"><img src="'+j+'" height="15" width="15"/></a>'}else{b==null?b="":"";return'<div class="'+k+'">'+b+"</div>"}}}else{return b}return b}var sim_search_type=Ext.create("Ext.data.Store",{fields:["sim_type","name"],data:[{sim_type:"Tanimoto",name:"Tanimoto"},{sim_type:"Tversky",name:"Tversky"},{sim_type:"Euclidian",name:"Euclidian"}]});Ext.define("LSP.view.larkc_sim_search.SimSearchForm",{extend:"Ext.form.Panel",alias:"widget.SimSearchForm",header:false,requires:["LSP.view.mol_editor_forms.KetcherForm","LSP.view.larkc_sim_search.SimSearchScrollingGrid"],closable:true,layout:{type:"vbox",align:"stretch"},initComponent:function(){console.log("LSP.view.larkc_sim_search.SimSearchForm: initComponent()");this.items=[{xtype:"form",padding:"5 5 5 5",border:false,style:"background-color: #fff;",items:[{name:"molfile",xtype:"hidden",value:""},{xtype:"fieldcontainer",layout:"column",collapsible:false,defaults:{anchor:"100%"},items:[{xtype:"textfield",name:"smiles",itemId:"smilesField",emptyText:"Enter SMILES here or use the molecular editor to draw structure - click button ->",fieldLabel:"Search for compounds similar to SMILES",labelWidth:230,width:650},{xtype:"button",action:"ketcher_editor",text:"Draw structure"},{xtype:"radiogroup",width:160,labelWidth:65,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 80",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"radiogroup",fieldLabel:"Search type",itemId:"searchTypeRadio",items:[{boxLabel:"Exact structure search",name:"search_type",inputValue:1,checked:true},{boxLabel:"Substructure search",name:"search_type",inputValue:2},{boxLabel:"Structural similarity search",name:"search_type",inputValue:3}]},{xtype:"container",layout:"column",items:[{xtype:"combobox",itemId:"sim_search_type_id",fieldLabel:"Similarity Threshold Type",labelWidth:150,store:sim_search_type,queryMode:"local",displayField:"sim_type",valueField:"sim_type",labelPad:2,padding:"0 2 0 0",value:"Tanimoto"},{xtype:"numberfield",itemId:"tanimoto_threshold_id",anchor:"100%",name:"tanimoto_threshold",fieldLabel:"Similarity threshold",labelWidth:115,value:90,width:175,allowDecimals:false,maxValue:100,minValue:1,padding:"0 2 0 25"},{xtype:"numberfield",itemId:"max_records_id",anchor:"100%",name:"max_records",fieldLabel:"Maximum records to retrieve",labelWidth:160,width:260,step:20,value:100,allowDecimals:false,minValue:20,padding:"0 2 0 25"}]},{xtype:"button",action:"query",itemId:"sim_sss_start_search_button_id",text:"Start search..."}]},{xtype:"SimSearchScrollingGrid",itemId:"simSearchGrid",title:"Structure search results",gridBaseTitle:"Structure search results",flex:1}];this.callParent(arguments)},setFormData:function(b){if(b.sm){var c=this.down("#smilesField");c.setValue(b.sm);var a=this.down("#searchTypeRadio");if(b.st){if(b.st=="exact"){a.setValue({search_type:1})}else{if(b.st=="sub"){a.setValue({search_type:2})}else{if(b.st=="sim"){a.setValue({search_type:3})}}}}else{a.setValue({search_type:1})}this.fireEvent("historyToken",b)}}});Ext.define("LSP.controller.SimSearchForm",{extend:"Ext.app.Controller",views:["larkc_sim_search.SimSearchForm","mol_editor_forms.KetcherForm","dataview.StructureViewer"],refs:[{ref:"ssform",selector:"SimSearchForm"},{ref:"strucGrid",selector:"#simSearchGrid"},{ref:"submitButton",selector:"SimSearchForm #sim_sss_start_search_button_id"},{ref:"tsvDownloadButton",selector:"SimSearchForm #tsvDownloadProxy_id"},{ref:"tanimotoThresholdSpinner",selector:"SimSearchForm #tanimoto_threshold_id"},{ref:"maxRecordsSpinner",selector:"SimSearchForm #max_records_id"},{ref:"SimSearchType",selector:"SimSearchForm #sim_search_type_id"}],all_records:undefined,total_count:0,current_count:0,missing_count:0,failed_to_load:0,current_smiles:undefined,current_mode:undefined,success_count:0,csids:undefined,current_jobs:new Array(),init:function(){console.log("LSP.controller.SimSearchForm: init()");this.control({"SimSearchForm button[action=ketcher_editor]":{click:this.launchKetcher},"KetcherForm button[action=commit_structure]":{click:this.getSmiles},"SimSearchForm button[action=query]":{click:this.submitQuery},SimSearchForm:{historyToken:this.handleHistoryToken,afterrender:this.prepGrid},"SimSearchForm #provId":{change:this.onProvChange},"#simSearchGrid":{itemcontextmenu:function(d,c,b,e,a,f){a.preventDefault();this.getStrucGrid().showMenu(a.getX(),a.getY(),c)}},"SimSearchForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},prepareTSVDownload:function(){console.log("Sim Search TSV download");var g=this;var h=this.getStrucGrid();var e,a,k,b,f,d,c,j;var l=Ext.create("LDA.store.TSVCreateStore",{});l.proxy.url=cs_download_url;c=h.store.getTotalCount();j=h.store.REQUEST_TYPE;l.load({params:{csids:Ext.encode(g.csids),total_count:c,request_type:j},callback:function(n,m,o){if(o){console.log("success tsv create");uuid=n[0].data.uuid;g.current_jobs.push(uuid);background_tasks_form=Ext.ComponentQuery.query("#background_tasks_form")[0];background_tasks_form.fireEvent("taskadded",uuid,g.getStrucGrid().getStore().getTypeName())}else{console.log("fail tsv create")}}})},setTSVDownloadParams:function(){var d=this.getTsvDownloadButton();var b=new Array();var c=this.getStrucGrid().getStore();var a=c.data.items;var e=new Array();Ext.each(a,function(g,f){b.push("csids[]="+g.data.csid);e.push(g.data.csid)});total_params=b.join("&");d.href=cs_download_url+"?"+total_params;d.setParams();this.csids=e},prepGrid:function(){console.log("LSP.controller.SimSearchForm: prepGrid()");var b=this.getStrucGrid();var a=b.getStore();a.removeAll();a.on("prefetch",this.storeLoadComplete,this)},storeLoadComplete:function(b,a,c){console.log("SimSearchForm: storeLoadComplete() "+this.current_count);if(this.current_count==this.total_count){b=Ext.create("Ext.data.store",{model:"LDA.model.SimModel"});b.add(this.all_records);this.getStrucGrid().store=b;this.getSubmitButton().enable();this.getSsform().doLayout();this.getSsform().setLoading(false);this.getStrucGrid().down("#tsvDownloadProxy_id").enable()}},hitCoreAPI:function(d){console.log("SimSearchForm: hitCoreAPI()");var e=this;this.failed_to_load=0;e.getStrucGrid().getStore().sorters.clear();var c=this.getStrucGrid();this.all_records=new Array();var a=Ext.create("LDA.store.CompoundStore",{});a.proxy.reader=Ext.create("LDA.helper.ChemspiderCompoundReader");this.current_count=0;this.missing_count=0;this.success_count=0;this.total_count=d.length;for(var b=0;b<d.length;b++){a.proxy.extraParams.uri="http://rdf.chemspider.com/"+d[b];a.load(function(g,f,h){if(h){e.getSsform().setLoading("Fetching compounds...."+e.current_count+" of "+e.total_count);g[0].index=e.success_count;e.success_count++;e.current_count++;e.getStrucGrid().getStore().add(g[0]);if(e.current_count==e.total_count){e.setTitleAfterLoading()}}else{e.getSsform().setLoading("Fetching compounds...."+e.current_count+" of "+e.total_count);e.current_count++;e.failed_to_load++;if(e.current_count==e.total_count){e.setTitleAfterLoading()}}})}},setTitleAfterLoading:function(){this.getSubmitButton().enable();this.getSsform().setLoading(false);this.getStrucGrid().down("#tsvDownloadProxy_id").enable();if(this.failed_to_load>0){if(this.current_mode=="exact"){this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle+": There are no records in OPS for this compound")}else{this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle+" (No information on "+this.failed_to_load+" records out of "+this.total_count+")");if(this.missing_count>0){this.getStrucGrid().setTitle(this.getStrucGrid().getTitle+". The OPS API has no data on "+this.missing_records+" compounds.")}}}else{if(this.current_mode=="exact"){this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle)}else{this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle+" ("+this.total_count+" records)");if(this.missing_count>0){this.getStrucGrid().setTitle(this.getStrucGrid().getTitle+"OPS has no data on "+this.missing_records+" compounds.")}}}this.setTSVDownloadParams()},handleHistoryToken:function(c){console.log("SimSearchForm: handleHistoryToken() "+c);var e=this;e.current_smiles=c.sm;e.current_mode=c.st;var h=e.getStrucGrid();var a=h.store.getRange();h.store.removeAll();h.getStore().setTypeName(e.current_smiles+" : "+e.current_mode);var j=Ext.create("CS.engine.search.Structure",{listeners:{finished:function(l,m){j.loadCSIDs(function(n){if(n.length==0){Ext.MessageBox.show({title:"Error",msg:"No compounds were found for this search, please try again with a different structure.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});e.getSubmitButton().enable();e.getSsform().setLoading(false)}else{e.hitCoreAPI(n)}})},failed:function(m,l){Ext.MessageBox.show({title:"Error",msg:"There was an error retrieving the compounds for this structure search.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});e.getSubmitButton().enable();e.getSsform().setLoading(false);e.getStrucGrid().down("#tsvDownloadProxy_id").disable()}}});var k="";var g="";var b={};var f=this.getSsform().getValues();b["searchOptions.Molecule"]=f.smiles;if(f.search_type=="1"){k="Exact structure match";g="exact"}else{if(f.search_type=="2"){k="Substructure structure";g="substructure"}else{if(f.search_type=="3"){k="Similarity search";g="similarity";var d=this.getTanimotoThresholdSpinner().value;b["searchOptions.Threshold"]=d/100;b["searchOptions.SimilarityType"]=this.getSimSearchType().value}else{}}}b["scopeOptions.DataSources[0]"]="DrugBank";b["scopeOptions.DataSources[1]"]="ChEMBL";b["scopeOptions.DataSources[2]"]="PDB";this.getStrucGrid().setTitle(k);this.getSsform().setLoading("Fetching compounds....");j.setLimit(this.getMaxRecordsSpinner().value);j.doSearch(g,b)},launchKetcher:function(c){var a=Ext.widget("KetcherForm");fields=this.getSsform().form.getFields().items;var b="";fields.forEach(function(e){if(e.name=="molfile"){b=e.getValue();var d=12}});if(b!=""){document.getElementById("ketcher_box_id").contentWindow.ketcher.setMolecule(b)}},getSmiles:function(b){var a=document.getElementById("ketcher_box_id");smiles=a.contentWindow.ketcher.getSmiles();molfile=a.contentWindow.ketcher.getMolfile();fields=this.getSsform().form.getFields().items;fields.forEach(function(c){if(c.name=="smiles"){c.setValue(smiles)}else{if(c.name=="molfile"){c.setValue(molfile)}}});b.up("KetcherForm").close()},submitQuery:function(e){console.log(" SimSearchForm: submitQuery()");var f=this;e.disable();var a=e.up("form");var h=a.getValues();if(h.smiles.length<4){e.enable();return}var g="exact";if(h.search_type==2){g="sub"}else{if(h.search_type==3){g="sim"}}if(f.current_smiles==h.smiles&&f.current_mode==g){var k=f.getStrucGrid();var b=k.store.getRange();k.store.removeAll();var l=Ext.create("CS.engine.search.Structure",{listeners:{finished:function(m,n){l.loadCSIDs(function(o){if(o.length==0){Ext.MessageBox.show({title:"Error",msg:"Chemspider returned no compounds for this search, please try again with a different structure.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});f.getSubmitButton().enable();f.getSsform().setLoading(false)}else{f.hitCoreAPI(o)}})},failed:function(n,m){Ext.MessageBox.show({title:"Error",msg:"There was an error retrieving the list of compounds from Chemspider",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});f.getSubmitButton().enable();f.getSsform().setLoading(false);f.getStrucGrid().down("#tsvDownloadProxy_id").disable()}}});var j="";var c={};var h=this.getSsform().getValues();c["searchOptions.Molecule"]=h.smiles;if(h.search_type=="1"){j="Exact structure match";search_type="exact"}else{if(h.search_type=="2"){j="Substructure structure";search_type="substructure"}else{if(h.search_type=="3"){j="Similarity search";search_type="similarity";var d=this.getTanimotoThresholdSpinner().value;c["searchOptions.Threshold"]=d/100;c["searchOptions.SimilarityType"]=this.getSimSearchType().value}else{}}}c["scopeOptions.DataSources[0]"]="DrugBank";c["scopeOptions.DataSources[1]"]="ChEMBL";c["scopeOptions.DataSources[2]"]="PDB";f.getStrucGrid().setTitle(j);f.getSsform().setLoading("Fetching compounds....");l.setLimit(this.getMaxRecordsSpinner().value);l.doSearch(search_type,c)}else{Ext.History.add("!p=SimSearchForm&sm="+h.smiles+"&st="+g)}},onProvChange:function(d,b,a){var c=this.getStrucGrid();c.toggleProv(b.prov);c.getView().refresh()}});Ext.define("LSP.view.pharm_by_enzyme_family.PharmByEnzymeFamilyScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.PharmByEnzymeFamilyScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:[],listeners:{sortchange:function(b,c,d,a){console.log("PharmByEnzymeFamilyScrollingGrid: sortchange()");this.setLoading(true)}},store:"EnzymeFamilyPaginatedStore",exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.EnzymeFamilyPaginatedStore",{})}return this.exportStore},columns:{defaults:{},items:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_compound_uri",xtype:"templatecolumn",tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',width:135,sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",width:180,renderer:enzymeProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Name",dataIndex:"target_title",width:180,renderer:enzymeProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Organism",dataIndex:"target_organism",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Organism",dataIndex:"assay_organism",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Description",dataIndex:"assay_description",width:200,renderer:enzymeProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Activity Type",dataIndex:"activity_activity_type",renderer:enzymeProvenanceRenderer,width:72,align:"center",tdCls:"gridRowPadding"},{header:"Relation",dataIndex:"activity_relation",renderer:enzymeProvenanceRenderer,width:52,align:"center",tdCls:"gridRowPadding"},{header:"Value",dataIndex:"activity_standard_value",renderer:enzymeProvenanceRenderer,width:60,align:"center",tdCls:"gridRowPadding"},{header:"Units",dataIndex:"activity_standard_units",renderer:enzymeProvenanceRenderer,width:60,align:"center",tdCls:"gridRowPadding"},{header:"Mol Weight",dataIndex:"compound_full_mwt",renderer:enzymeProvenanceRenderer,align:"center",width:80,tdCls:"gridRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"compound_inchi",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"compound_inchikey",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"}]},enzyme_prov:false,toggleProv:function(a){this.enzyme_prov=a;console.log(" Show provenance : "+this.enzyme_prov);this.doLayout()}});function enzymeProvenanceRenderer(f,m,g,k,h,l){if(this.enzyme_prov){var j=this.columns[h].dataIndex;var p=j+"_item";j+="_src";var a=g.data[j];var o=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!o){o="defaultValue"}var n=o+"Icon";n="/assets/"+n+".png";o+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(g.data[j]&&f){if(this.columns[h].dataIndex=="target_title"){var b=new String();var e=f.split(",");var c=g.data.target_concatenated_uris.split(",");var d="https://www.ebi.ac.uk/chembl/target/inspect/";Ext.each(e,function(v,s){var r=c[s];if(r){var q=d+r.split("/").pop();b+='<div class="'+o+'">'+v+'</div><br><a href="'+q+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}else{var t=c[0].split("/").pop();var u=d+t;b+='<div class="'+o+'">'+v+'</div><br><a href="'+u+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}});return b}return'<div class="'+o+'">'+f+'</div><br><a href="'+g.data[p]+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}else{return'<div class="'+o+'">'+f+"</div>"}}}else{return f}return f}var target_condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});Ext.define("LSP.view.pharm_by_target_name2.PharmByTargetNameForm",{extend:"Ext.form.Panel",alias:"widget.PharmByTargetNameForm",closable:true,header:false,layout:{type:"vbox",align:"stretch"},verticalScrollerType:"paginggridscroller",invalidateScrollerOnRefresh:false,disableSelection:true,initComponent:function(){console.log("PharmByTargetNameForm: constructor()");this.items=[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Type in protein name and species. E.g. "ADA protein human" and select a result</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[Ext.create("CW.view.ConceptWikiLookup",{xtype:"conceptWikiLookup",fieldLabel:"Protein name",itemId:"pharmByProteinCWLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),extraParams:{branch:3}}}),name:"protein_uri",cwTagUuid:"eeaec894-d856-4106-9fa1-662b1dc6c6f1"}),{xtype:"button",itemId:"pharmByTargetSubmit_id",padding:"5 5 5 5",text:"Search...",disabled:true,name:"query_summit_button",action:"query_pharm_by_target_name"}]},{xtype:"container",margin:"0 5 5 5",name:"filter_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{xtype:"button",itemId:"addFilterButton_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Show or hide filter selector",action:"add_filter_form"},{xtype:"label",forId:"addFilterButton_id",text:"Filter",margin:"5 5 5 5"},{xtype:"radiogroup",width:200,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 65",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"container",margin:"0 5 5 5",name:"filter_selector_container",itemId:"filterSelectorContainer_id",hidden:true,layout:{type:"vbox"},style:"background-color: #fff;",items:[{xtype:"container",margin:"0 5 5 5",name:"activity_selector_container",itemId:"activitySelectorContainer_id",hidden:false,layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:Ext.create("LDA.store.FilterActivityStore",{}),queryMode:"remote",queryParam:false,displayField:"activity_type",valueField:"about",labelWidth:100,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:target_condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0",emptyText:"Enter a value..."},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0",emptyText:"Use drop down...",editable:false},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]},{xtype:"OrganismFilterForm",itemId:"organismFilterContainer_id",margin:"0 5 5 5",name:"organism_filter_fields",hidden:false},{xtype:"TargetOrganismFilterForm",itemId:"targetOrganismFilterContainer_id",margin:"0 5 5 5",name:"target_organism_filter_fields",hidden:false}]},{xtype:"container",itemId:"completedFilterContainer_id",margin:"0 5 5 5",name:"completed_filter_container",hidden:true},{xtype:"PharmByTargetNameScrollingGrid",itemId:"pharmByTargetNameGrid",title:"Pharmacology by Target name search results",gridBaseTitle:"Pharmacology by Target name search results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.view.pharm_by_target_name2.PharmByTargetNameScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.PharmByTargetNameScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:[],listeners:{sortchange:function(b,c,d,a){console.log("PharmByTargetNameGrid: sortchange()");this.setLoading(true)}},store:"TargetPharmacologyPaginatedStore",exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.TargetPharmacologyPaginatedStore",{})}return this.exportStore},columns:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_compound_uri",xtype:"templatecolumn",width:135,tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",width:180,renderer:targetProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Name",dataIndex:"target_pref_label",width:180,renderer:targetProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Organism",dataIndex:"target_organism",width:130,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Organism",dataIndex:"assay_organism",tooltip:"Name of the organism for the assay system (e.g., the organism, tissue or cell line in which an assay was performed). May differ from the target organism (e.g., for a human protein expressed in non-human cells, or pathogen-infected human cells)",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Description",dataIndex:"assay_description",width:150,tdCls:"wrap gridDescriptiveRowPadding",renderer:targetProvenanceRenderer},{header:"Activity Type",dataIndex:"activity_activity_type",width:72,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Relation",dataIndex:"activity_relation",width:52,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Value",dataIndex:"activity_standard_value",width:60,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Units",dataIndex:"activity_standard_units",width:60,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"PubMed ID",dataIndex:"activity_pubmed_id",xtype:"templatecolumn",tpl:'<a href="http://www.ncbi.nlm.nih.gov/pubmed?term={activity_pubmed_id}" target="_blank">{activity_pubmed_id}</a>',align:"center",tdCls:"gridRowPadding"},{header:"Mol Weight",dataIndex:"compound_full_mwt",width:80,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"compound_inchi",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"compound_inchikey",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"}],target_prov:false,toggleProv:function(a){this.target_prov=a;console.log(" Show target provenance : "+this.target_prov);this.doLayout()}});function targetProvenanceRenderer(b,h,c,f,d,g){if(this.target_prov){var e=this.columns[d].dataIndex;var l=e+"_item";e+="_src";var a=c.data[e];var k=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!k){k="defaultValue"}var j=k+"Icon";j="/assets/"+j+".png";k+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(c.data[e]&&b){return'<div class="'+k+'">'+b+'</div><br><a href="'+c.data[l]+'" target="_blank"><img src="'+j+'" height="15" width="15"/></a>'}else{return'<div class="'+k+'">'+b+"</div>"}}}else{return b}return b}Ext.define("LSP.view.pharm_by_cmpd_name2.PharmByCmpdNameScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.PharmByCmpdNameScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:[],listeners:{sortchange:function(b,c,d,a){console.log("PharmByCmpdNameScrollingGrid: sortchange()");this.setLoading(true)}},refs:[],store:"CompoundPharmacologyPaginatedStore",exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.CompoundPharmacologyPaginatedStore",{})}return this.exportStore},columns:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_compound_uri",xtype:"templatecolumn",width:135,tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Target Names",width:180,dataIndex:"targets",renderer:compoundProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Organisms",dataIndex:"target_organisms",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Organism",dataIndex:"assay_organism",renderer:compoundProvenanceRenderer,tooltip:"Name of the organism for the assay system (e.g., the organism, tissue or cell line in which an assay was performed). May differ from the target organism (e.g., for a human protein expressed in non-human cells, or pathogen-infected human cells)",align:"center",tdCls:"gridRowPadding"},{header:"Assay Description",dataIndex:"assay_description",width:200,renderer:compoundProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Activity Type",dataIndex:"activity_activity_type",width:72,renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Relation",width:52,dataIndex:"activity_relation",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Value",dataIndex:"activity_standard_value",width:60,renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Units",dataIndex:"activity_standard_units",width:60,renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"PubMed ID",dataIndex:"activity_pubmed_id",xtype:"templatecolumn",tpl:'<a href="http://www.ncbi.nlm.nih.gov/pubmed?term={activity_pubmed_id}" target="_blank">{activity_pubmed_id}</a>',align:"center",tdCls:"gridRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"compound_inchi",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"compound_inchikey",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"}],compound_prov:false,toggleProv:function(a){this.compound_prov=a;console.log(" Show provenance : "+this.compound_prov);this.doLayout()}});function compoundProvenanceRenderer(d,m,e,k,g,l){if(this.compound_prov){var j=this.columns[g].dataIndex;var p=j+"_item";j+="_src";var a=e.data[j];var o=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!o){o="defaultValue"}var n=o+"Icon";n="/assets/"+n+".png";o+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(e.data[j]&&d||this.columns[g].dataIndex=="targets"||this.columns[g].dataIndex=="target_organisms"){if(this.columns[g].dataIndex=="targets"){var c=new String();Ext.each(d,function(t,s){var q=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[t.src];var r=q+"Icon";r="/assets/"+r+".png";q+=LDAProvenanceMode;c+='<div class="'+q+'">'+t.title+'</div><br><a href="'+t.item+'" target="_blank"><img src="'+r+'" height="15" width="15"/></a>'});return c}if(this.columns[g].dataIndex=="target_organisms"){var f=new String();Ext.each(d,function(t,q){var s=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[t.src];var r=s+"Icon";r="/assets/"+r+".png";s+=LDAProvenanceMode;f+='<div class="'+s+'">'+t.organism+'</div><br><a href="'+t.item+'" target="_blank"><img src="'+r+'" height="15" width="15"/></a>'});return f}return'<div class="'+o+'">'+d+'</div><br><a href="'+e.data[p]+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}else{return'<div class="'+o+'">'+d+"</div>"}}}else{if(this.columns[g].dataIndex=="targets"){var b="";Ext.each(d,function(r,q){b+=r.title;b+="<br><br>"});return"<div>"+b+"</div>"}else{if(this.columns[g].dataIndex=="target_organisms"){var h="";Ext.each(d,function(r,q){h+=r.organism;h+="<br><br>"});return"<div>"+h+"</div>"}}return d}return d}Ext.define("LDA.model.FilterActivityModel",{extend:"Ext.data.Model",fields:["activity_type","about"]});Ext.define("LDA.store.FilterActivityStore",{extend:"LDA.store.basestores.BaseStore",model:"LDA.model.FilterActivityModel",storeId:"FilterActivityStore",BASE_URL:ldaBaseUrl+"/pharmacology/filters/activities?",constructor:function(a,b){console.log("LDA.store.FilterActivityStore: constructor()");this.proxy.reader=Ext.create("LDA.helper.FilterActivityReader");this.callParent(b)}});Ext.define("LSP.controller.PharmByTargetNameForm",{extend:"LSP.controller.grids.DynamicGrid",views:["pharm_by_target_name2.PharmByTargetNameForm","pharm_by_target_name2.PharmByTargetNameScrollingGrid"],refs:[{ref:"gridView",selector:"#pharmByTargetNameGrid"},{ref:"formView",selector:"PharmByTargetNameForm"},{ref:"lookup",selector:"conceptWikiProteinLookup"},{ref:"submitButton",selector:"#pharmByTargetSubmit_id"},{ref:"filterContainer",selector:"PharmByTargetNameForm #filterSelectorContainer_id"},{ref:"unitsCombo",selector:"PharmByTargetNameForm #unit_combobox_id"},{ref:"tsvDownloadButton",selector:"PharmByTargetNameForm #tsvDownloadProxy_id"}],filters:undefined,current_uri:undefined,init:function(){console.log("PharmByTargetNameForm: init()");this.control({"PharmByTargetNameForm button[action=query_pharm_by_target_name]":{click:this.submitQuery},"PharmByTargetNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},PharmByTargetNameForm:{afterrender:this.prepGrid,historyToken:this.handleHistoryToken},"PharmByTargetNameForm button[action=add_filter_form]":{click:this.addFilterForm},"PharmByTargetNameForm button[action=add_completed_organism_filter]":{click:this.addCompletedOrganismFilter},"PharmByTargetNameForm button[action=add_completed_activity_filter]":{click:this.addCompletedActivityFilter},"PharmByTargetNameForm button[action=add_completed_target_organism_filter]":{click:this.addCompletedTargetOrganismFilter},"PharmByTargetNameForm #provId":{change:this.onProvChange},"PharmByTargetNameForm #activity_combobox_id":{select:this.comboSelect,scope:this},"PharmByTargetNameForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},comboSelect:function(g,b,d){var f=b[0].get("about");var e=this;if(this.current_activity_combo_select!=f){var c=this.getUnitsCombo().getStore();this.getUnitsCombo().clearValue();c.removeAll();this.current_activity_combo_select=f;this.getUnitsCombo().setLoading("Fetching units...");var a=Ext.create("LDA.store.FilterUnitsStore",{activity_type:f});a.load(function(j,h,k){store_records=j;store_operation=h;store_success=h.success;if(store_success){Ext.each(j,function(l,m){unit_abbr=LDA.helper.LDAConstants.LDAUnits[l.data.unit];unit_abbr==null?unit_abbr="unknown abbreviation":"";unit=Ext.create("LSP.model.Unit",{unit:l.data.unit+" ("+unit_abbr+")",name:l.data.unit});c.add(unit)})}e.getUnitsCombo().setLoading(false)})}},handleHistoryToken:function(b){if(b.u){var d=this.getGridView();var a=d.store;if(b.u!=a.proxy.extraParams.uri){var f=this.getController("CW.controller.ConceptWikiLookup");var e=this.getFormView().down("conceptWikiLookup");f.setConcept(b.u,e,a);this.current_uri=b.u;a.proxy.extraParams.uri=b.u;a.proxy.reader.uri=b.u;d.setLoading(true);this.fetchTotalResults()}}else{if(b.s){var c=this.getLookup();c.setRawValue(b.s);c.doQuery(b.s)}}},getCountStore:function(){return Ext.create("LDA.store.TargetPharmacologyCountStore")},submitQuery:function(c){var e=this.getGridView();var b=e.store;b.sort_column=undefined;var d=c.up("form");c.disable();var a=d.getValues();if(this.current_uri==a.protein_uri){b.proxy.extraParams.uri=this.current_uri;b.proxy.reader.uri=this.current_uri;e.setLoading(true);this.fetchTotalResults()}else{Ext.History.add("!p=PharmByTargetNameForm&u="+a.protein_uri)}}});Ext.define("LDA.helper.FilterActivityReader",{extend:"Ext.data.reader.Json",requires:["LDA.helper.LDAConstants"],readRecords:function(b){var d=b.result["primaryTopic"];var c=d.normalised_activity_type;var a=new Array();Ext.each(c,function(h,g){var k=h[LDA.helper.LDAConstants.LDA_ABOUT];var j=k.split("/");var l=j[j.length-1].substr(1);var f=h[LDA.helper.LDAConstants.LDA_LABEL];var e=Ext.create("LDA.model.FilterActivityModel",{activity_type:f,about:l});a.push(e)});return new Ext.data.ResultSet({total:a.length,count:a.length,records:a,success:true,message:"loaded"})}});var activity_type=Ext.create("LDA.store.FilterActivityStore",{});var condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});var unit=Ext.create("Ext.data.Store",{fields:["unit","name"]});Ext.define("LSP.view.filter.ActivityFilterForm",{extend:"Ext.container.Container",alias:"widget.ActivityFilterForm",closable:true,layout:{type:"hbox"},refs:[{ref:"activity_combobox",selector:"#activity_combobox_id"},{ref:"conditions_combobox",selector:"#conditions_combobox_id"},{ref:"value_textfield",selector:"#value_textfield_id"},],headerPosition:"right",frame:true,padding:"0 0 5 0",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:activity_type,queryMode:"remote",displayField:"activity_type",valueField:"activity_type",labelWidth:100,labelPad:2,padding:"0 2 0 0"},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0"},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0"},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0"},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]});Ext.define("LSP.model.Organism",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"abbr",type:"string"}]});var assay_organism=Ext.create("Ext.data.Store",{model:"LSP.model.Organism",proxy:{type:"ajax",url:"/core_api_calls/organisms.json",model:"LSP.model.Organism",reader:{type:"json"}}});Ext.define("LSP.view.filter.OrganismFilterForm",{extend:"Ext.container.Container",alias:"widget.OrganismFilterForm",closable:true,layout:{type:"hbox"},refs:[{ref:"organism_combobox",selector:"#organism_combobox_id"},{ref:"organism_textfield",selector:"#organism_textfield_id"}],headerPosition:"right",frame:true,padding:"0 0 5 0",items:[{xtype:"combobox",itemId:"organism_combobox_id",fieldLabel:"Assay Organism",store:assay_organism,queryMode:"remote",displayField:"abbr",valueField:"name",labelWidth:100,width:400,labelPad:2,padding:"0 2 0 0",emptyText:"Enter the name of an assay organism...",minChars:3,hideTrigger:true,listConfig:{emptyText:"No organisms found which match your text, try entering some different text."}},{xtype:"button",itemId:"addCompletedOrganismFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this organism filter",action:"add_completed_organism_filter"}]});Ext.define("LSP.view.Enzymetree",{extend:"Ext.tree.Panel",alias:"widget.enzymeTree",requires:["Ext.data.*","Ext.grid.*","Ext.tree.*"],singleExpand:true,multiSelect:false,rootVisible:false,useArrows:true,frame:true,height:550,autoScroll:true,columns:[{xtype:"treecolumn",text:"EC number",sortable:true,dataIndex:"ec_number",width:160},{text:"Enzyme family name",dataIndex:"name",width:290}],initComponent:function(){console.log("EnzymeTree: initComponent()");var a={store:{fields:[{name:"ec_number",type:"string",sortDir:"ASC"},{name:"name",type:"string"}],proxy:{type:"ajax",api:{read:"enzymes.json"},reader:{type:"json",root:"objects",totalProperty:"totalCount"}},sorters:[{property:"ec_number",direction:"ASC"}],sortOnLoad:true}};Ext.apply(this,a);Ext.apply(this.initialConfig,a);this.callParent(arguments)}});var compound_condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});Ext.define("LSP.view.pharm_by_cmpd_name2.PharmByCmpdNameForm",{extend:"Ext.form.Panel",alias:"widget.PharmByCmpdNameForm",closable:true,requires:["LSP.view.filter.ActivityFilterForm","LSP.view.filter.OrganismFilterForm","LSP.view.filter.TargetOrganismFilterForm"],header:false,layout:{type:"vbox",align:"stretch"},invalidateScrollerOnRefresh:false,disableSelection:true,initComponent:function(){console.log("PharmByCmpdNameForm: initComponent()");this.items=[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Type in compound name. E.g. "Aspirin" and select a result</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{name:"cmpd_uuid",xtype:"hidden",value:""},Ext.create("CW.view.ConceptWikiLookup",{xtype:"conceptWikiLookup",fieldLabel:"Compound name",itemId:"pharmByCompoundCWLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),extraParams:{branch:4}}}),name:"compound_uri",cwTagUuid:"07a84994-e464-4bbf-812a-a4b96fa3d197"}),{xtype:"button",itemId:"pharmByCmpdSubmit_id",padding:"5 5 5 5",text:"Search...",disabled:true,action:"query_pharm_by_cmpd_name"}]},{xtype:"container",margin:"0 5 5 5",name:"filter_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{xtype:"button",itemId:"addFilterButton_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Show or hide filter selector",action:"add_filter_form"},{xtype:"label",forId:"addFilterButton_id",text:"Filter",margin:"5 5 5 5"},{xtype:"radiogroup",width:200,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 65",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"container",margin:"0 5 5 5",name:"filter_selector_container",itemId:"filterSelectorContainer_id",hidden:true,layout:{type:"vbox"},style:"background-color: #fff;",items:[{xtype:"container",margin:"0 5 5 5",name:"activity_selector_container",itemId:"activitySelectorContainer_id",hidden:false,layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:Ext.create("LDA.store.FilterActivityStore",{}),queryMode:"remote",queryParam:false,displayField:"activity_type",valueField:"about",labelWidth:100,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:compound_condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0",emptyText:"Enter a value..."},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0",emptyText:"Use drop down...",editable:false},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]},{xtype:"OrganismFilterForm",itemId:"organismFilterContainer_id",margin:"0 5 5 5",name:"organism_filter_fields",hidden:false},{xtype:"TargetOrganismFilterForm",itemId:"targetOrganismFilterContainer_id",margin:"0 5 5 5",name:"target_organism_filter_fields",hidden:false}]},{xtype:"container",itemId:"completedFilterContainer_id",margin:"0 5 5 5",name:"completed_filter_container",hidden:true},{xtype:"PharmByCmpdNameScrollingGrid",itemId:"pharmByCmpdNameGrid",title:"Pharmacology by Compound name search results",gridBaseTitle:"Pharmacology by Compound name search results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.controller.PharmByCmpdNameForm",{extend:"LSP.controller.grids.DynamicGrid",views:["pharm_by_cmpd_name2.PharmByCmpdNameForm","pharm_by_cmpd_name2.PharmByCmpdNameScrollingGrid"],refs:[{ref:"gridView",selector:"#pharmByCmpdNameGrid"},{ref:"formView",selector:"PharmByCmpdNameForm"},{ref:"submitButton",selector:"#pharmByCmpdSubmit_id"},{ref:"nextRecordsButton",selector:"PharmByCmpdNameForm dynamicgrid3 #nextRecords"},{ref:"lookup",selector:"PharmByCmpdNameForm #pharmByCompoundCWLookup"},{ref:"filterContainer",selector:"PharmByCmpdNameForm #filterSelectorContainer_id"},{ref:"unitsCombo",selector:"PharmByCmpdNameForm #unit_combobox_id"},{ref:"tsvDownloadButton",selector:"PharmByCmpdNameForm #tsvDownloadProxy_id"}],filters:undefined,current_uri:undefined,current_activity_combo_select:undefined,init:function(){console.log("PharmByCmpdNameForm: init()");this.control({"PharmByCmpdNameForm button[action=query_pharm_by_cmpd_name]":{click:this.submitQuery},"PharmByCmpdNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},PharmByCmpdNameForm:{historyToken:this.handleHistoryToken,afterrender:this.prepGrid},"PharmByCmpdNameForm button[action=add_filter_form]":{click:this.addFilterForm},"PharmByCmpdNameForm button[action=add_completed_organism_filter]":{click:this.addCompletedOrganismFilter},"PharmByCmpdNameForm button[action=add_completed_activity_filter]":{click:this.addCompletedActivityFilter},"PharmByCmpdNameForm button[action=add_completed_target_organism_filter]":{click:this.addCompletedTargetOrganismFilter},"PharmByCmpdNameForm #provId":{change:this.onProvChange},"PharmByCmpdNameForm #activity_combobox_id":{select:this.comboSelect,scope:this},"PharmByCmpdNameForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},comboSelect:function(g,b,d){var f=b[0].get("about");var e=this;if(this.current_activity_combo_select!=f){var c=this.getUnitsCombo().getStore();this.getUnitsCombo().clearValue();c.removeAll();this.current_activity_combo_select=f;var a=Ext.create("LDA.store.FilterUnitsStore",{activity_type:f});this.getUnitsCombo().setLoading("Fetching units...");a.load(function(j,h,k){store_records=j;store_operation=h;store_success=h.success;if(store_success){Ext.each(j,function(l,m){unit_abbr=LDA.helper.LDAConstants.LDAUnits[l.data.unit];unit_abbr==null?unit_abbr="unknown abbreviation":"";unit=Ext.create("LSP.model.Unit",{unit:l.data.unit+" ("+unit_abbr+")",name:l.data.unit});c.add(unit)})}e.getUnitsCombo().setLoading(false)})}},prepCSVFile:function(a){console.log("PharmByCmpdNameForm: prepCSVFile()");this.callParent(a)},handleHistoryToken:function(b){console.log("PharmByCmpdNameForm: handleHistoryToken()");if(b.u){var d=this.getGridView();var a=d.store;if(b.u!=a.proxy.extraParams.uri){var f=this.getController("CW.controller.ConceptWikiLookup");var e=this.getFormView().down("conceptWikiLookup");f.setConcept(b.u,e,a);console.log("blah "+f);console.log("blah 2 "+e);this.current_uri=b.u;a.proxy.extraParams.uri=b.u;a.proxy.reader.uri=b.u;d.setLoading(true);this.fetchTotalResults()}}else{if(b.s){var c=this.getLookup();c.setRawValue(b.s);c.doQuery(b.s)}}},getCountStore:function(){return Ext.create("LDA.store.CompoundPharmacologyCountStore")},submitQuery:function(c){console.log("PharmByCmpdNameForm: submitQuery()");var e=this.getGridView();var b=e.store;b.sort_column=undefined;var d=c.up("form");c.disable();var a=d.getValues();if(this.current_uri==a.compound_uri){b.proxy.extraParams.uri=this.current_uri;b.proxy.reader.uri=this.current_uri;e.setLoading(true);this.fetchTotalResults()}else{Ext.History.add("!p=PharmByCmpdNameForm&u="+a.compound_uri)}}});Ext.define("LSP.view.tree_selector_forms.EnzymeTreeForm",{extend:"Ext.window.Window",alias:"widget.EnzymeTreeForm",requires:["Ext.form.Panel","LSP.view.Enzymetree"],title:"Select an enzyme family",layout:"fit",modal:true,autoShow:true,height:600,width:500,items:[{xtype:"form",padding:"0 0 0 0",border:false,style:"background-color: #fff;",items:[{xtype:"enzymeTree"}]}],buttons:[{text:"Use selection",action:"get_enzyme"},{text:"Cancel",action:"hide_enzyme_form"}],initComponent:function(){console.log("EnzymeTreeForm: initComponent()");this.callParent(arguments)}});var enzyme_condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});Ext.define("LSP.view.pharm_by_enzyme_family.PharmEnzymeForm",{extend:"Ext.form.Panel",alias:"widget.PharmEnzymeForm",closable:true,header:false,requires:["LSP.view.tree_selector_forms.EnzymeTreeForm","LSP.view.dynamicgrid.DynamicGrid"],layout:{type:"vbox",align:"stretch"},initComponent:function(){console.log("PharmEnzymeForm: initComponent()");this.items=[{xtype:"container",height:34,name:"form_fields",layout:{type:"column"},items:[{xtype:"displayfield",name:"enzyme_family",margin:"5 5 5 5",width:400,value:"No enzyme class selected - press button ->",fieldLabel:"Enzyme family class",labelWidth:130},{xtype:"button",padding:"5 5 5 5",margin:"5 5 5 5",text:"Browse EC codes",action:"enz_tree"},{name:"enz_name",xtype:"hidden",value:""},{name:"ec_number",xtype:"hidden",value:""}]},{xtype:"button",action:"query",margin:"5 0 0 320",maxWidth:300,itemId:"submitEnzymePharm_id",text:"Start search...",disabled:true},{xtype:"container",margin:"0 5 5 5",name:"filter_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{xtype:"button",itemId:"addFilterButton_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Show or hide filter selector",action:"add_filter_form"},{xtype:"label",forId:"addFilterButton_id",text:"Filter",margin:"5 5 5 5"},{xtype:"radiogroup",width:200,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 65",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"container",margin:"0 5 5 5",name:"filter_selector_container",itemId:"filterSelectorContainer_id",hidden:true,layout:{type:"vbox"},style:"background-color: #fff;",items:[{xtype:"container",margin:"0 5 5 5",name:"activity_selector_container",itemId:"activitySelectorContainer_id",hidden:false,layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:Ext.create("LDA.store.FilterActivityStore",{}),queryMode:"remote",displayField:"activity_type",valueField:"about",labelWidth:100,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:enzyme_condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0",emptyText:"Enter a value..."},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0",emptyText:"Use drop down...",editable:false},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]},{xtype:"OrganismFilterForm",itemId:"organismFilterContainer_id",margin:"0 5 5 5",name:"organism_filter_fields",hidden:false},{xtype:"TargetOrganismFilterForm",itemId:"targetOrganismFilterContainer_id",margin:"0 5 5 5",name:"target_organism_filter_fields",hidden:false}]},{xtype:"container",itemId:"completedFilterContainer_id",margin:"0 5 5 5",name:"completed_filter_container",hidden:true},{xtype:"PharmByEnzymeFamilyScrollingGrid",itemId:"pharmByEnzymeFamilyGrid",title:"Pharmacology by Enzyme Family search results",gridBaseTitle:"Pharmacology by Enzyme Family search results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.controller.PharmByEnzymeFamily",{extend:"LSP.controller.grids.DynamicGrid",views:["pharm_by_enzyme_family.PharmEnzymeForm","pharm_by_enzyme_family.PharmByEnzymeFamilyScrollingGrid"],refs:[{ref:"gridView",selector:"#pharmByEnzymeFamilyGrid"},{ref:"formView",selector:"PharmEnzymeForm"},{ref:"submitButton",selector:"#submitEnzymePharm_id"},{ref:"filterContainer",selector:"PharmEnzymeForm #filterSelectorContainer_id"},{ref:"unitsCombo",selector:"PharmEnzymeForm #unit_combobox_id"},{ref:"tsvDownloadButton",selector:"PharmEnzymeForm #tsvDownloadProxy_id"}],filters:undefined,current_uri:undefined,init:function(){console.log("PharmByEnzymeFamily: init()");this.control({"PharmEnzymeForm button[action=enz_tree]":{click:this.launchEnzyme},"EnzymeTreeForm button[action=get_enzyme]":{click:this.getEnzyme},"EnzymeTreeForm button[action=hide_enzyme_form]":{click:this.hideEnzyme},"PharmEnzymeForm #submitEnzymePharm_id":{click:this.submitQuery},PharmEnzymeForm:{afterrender:this.prepGrid,historyToken:this.handleHistoryToken},"PharmEnzymeForm button[action=add_filter_form]":{click:this.addFilterForm},"PharmEnzymeForm button[action=add_completed_organism_filter]":{click:this.addCompletedOrganismFilter},"PharmEnzymeForm button[action=add_completed_target_organism_filter]":{click:this.addCompletedTargetOrganismFilter},"PharmEnzymeForm button[action=add_completed_activity_filter]":{click:this.addCompletedActivityFilter},"PharmEnzymeForm #provId":{change:this.onProvChange},"PharmEnzymeForm #activity_combobox_id":{select:this.comboSelect,scope:this},"PharmEnzymeForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},comboSelect:function(g,b,d){var f=b[0].get("about");var e=this;if(this.current_activity_combo_select!=f){var c=this.getUnitsCombo().getStore();this.getUnitsCombo().clearValue();c.removeAll();this.current_activity_combo_select=f;this.getUnitsCombo().setLoading("Fetching units...");var a=Ext.create("LDA.store.FilterUnitsStore",{activity_type:f});a.load(function(j,h,k){store_records=j;store_operation=h;store_success=h.success;if(store_success){Ext.each(j,function(l,m){unit_abbr=LDA.helper.LDAConstants.LDAUnits[l.data.unit];unit_abbr==null?unit_abbr="unknown abbreviation":"";unit=Ext.create("LSP.model.Unit",{unit:l.data.unit+" ("+unit_abbr+")",name:l.data.unit});c.add(unit)})}e.getUnitsCombo().setLoading(false)})}},handleHistoryToken:function(b){console.log("PharmByEnzymeFamily: handleHistoryToken()");if(b.ec){this.current_uri="http://purl.uniprot.org/enzyme/"+b.ec;var c=this.getGridView();var a=c.getStore();c.setLoading(true);a.proxy.extraParams.uri="http://purl.uniprot.org/enzyme/"+b.ec;a.proxy.reader.uri="http://purl.uniprot.org/enzyme/"+b.ec;this.fetchTotalResults()}},getCountStore:function(){return Ext.create("LDA.store.EnzymeFamilyCountStore")},launchEnzyme:function(b){console.log("PharmByEnzymeFamily: launchEnzyme()");var a=Ext.ComponentQuery.query("EnzymeTreeForm")[0];if(a){console.log("enzyme show");a.show()}else{console.log("enzyme create");a=Ext.widget("EnzymeTreeForm");a.show()}},hideEnzyme:function(b){console.log("PharmByEnzymeFamily: hideEnzyme()");var a=Ext.ComponentQuery.query("EnzymeTreeForm")[0];if(a){console.log("enzyme hide");a.hide()}},getEnzyme:function(d){console.log("PharmByEnzymeFamily: getEnzyme()");var b=d.up().up().down("enzymeTree");var e=b.getView().getSelectionModel().getSelection();var f=e[0].data;var a=this.getFormView().getForm().findField("enzyme_family");a.setValue("<b>"+f.ec_number+" : "+f.name+"</b>");var c=this.getFormView().getForm().findField("ec_number");c.setValue(f.ec_number);var g=this.getFormView().getForm().findField("enz_name");g.setValue(f.name);this.hideEnzyme("");this.getSubmitButton().enable();this.getGridView().getStore().setTypeName(f.name)},submitQuery:function(c){console.log("PharmByEnzymeFamily: submitQuery()");var e=this.getGridView();var b=e.store;b.sort_column=undefined;var d=c.up("form");c.disable();var a=d.getValues();if(this.current_uri=="http://purl.uniprot.org/enzyme/"+a.ec_number){b.proxy.extraParams.uri=this.current_uri;b.proxy.reader.uri=this.current_uri;e.setLoading(true);this.fetchTotalResults()}else{Ext.History.add("!p=PharmEnzymeForm&ec="+a.ec_number)}}});(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function b(e){e=e.replace(/\r\n/g,"\n");var d="";for(var g=0;g<e.length;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f)}else{if((f>127)&&(f<2048)){d+=String.fromCharCode((f>>6)|192);d+=String.fromCharCode((f&63)|128)}else{d+=String.fromCharCode((f>>12)|224);d+=String.fromCharCode(((f>>6)&63)|128);d+=String.fromCharCode((f&63)|128)}}}return d}Ext.define("Ext.ux.exporter.Base64",{statics:{encode:function(e){var c="";var m,k,h,l,j,g,f;var d=0;e=b(e);while(d<e.length){m=e.charCodeAt(d++);k=e.charCodeAt(d++);h=e.charCodeAt(d++);l=m>>2;j=((m&3)<<4)|(k>>4);g=((k&15)<<2)|(h>>6);f=h&63;if(isNaN(k)){g=f=64}else{if(isNaN(h)){f=64}}c=c+a.charAt(l)+a.charAt(j)+a.charAt(g)+a.charAt(f)}return c}}})})();Ext.define("Ext.ux.exporter.Button",{extend:"Ext.Component",alias:"widget.exporterbutton",html:"<p></p>",config:{swfPath:"/flash/downloadify.swf",downloadImage:"/images/ext_reports/download.png",width:62,height:22,downloadName:"download"},constructor:function(b){b=b||{};this.initConfig();Ext.ux.exporter.Button.superclass.constructor.call(this,b);var a=this;this.on("afterrender",function(){a.setComponent(a.store||a.component||a.up("gridpanel")||a.up("treepanel"),b)})},setComponent:function(b,a){this.component=b;this.store=!b.is?b:b.getStore();this.setDownloadify(a)},setDownloadify:function(b){var a=this;Downloadify.create(this.el.down("p").id,{filename:function(){return a.getDownloadName()+"."+Ext.ux.exporter.Exporter.getFormatterByName(a.formatter).extension},data:function(){return Ext.ux.exporter.Exporter.exportAny(a.component,a.formatter,b)},onComplete:function(){alert("Your File Has Been Saved!")},onCancel:function(){alert("You have cancelled the saving of this file.")},onError:function(){alert("You must put something in the File Contents or there will be nothing to save!")},transparent:false,swf:this.getSwfPath(),downloadImage:this.getDownloadImage(),width:this.getWidth(),height:this.getHeight(),transparent:true,append:true})}});Ext.define("Ext.ux.grid.menu.RangeMenu",{extend:"Ext.menu.Menu",fieldCls:"Ext.form.field.Number",itemIconCls:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq"},fieldLabels:{gt:"Greater Than",lt:"Less Than",eq:"Equal To"},menuItemCfgs:{emptyText:"Enter Number...",selectOnFocus:false,width:155},menuItems:["lt","gt","-","eq"],constructor:function(a){var f=this,c,g,b,e,h,d,j;f.callParent(arguments);c=f.fields=f.fields||{};g=f.fieldCfg=f.fieldCfg||{};f.addEvents("update");f.updateTask=Ext.create("Ext.util.DelayedTask",f.fireUpdate,f);for(b=0,e=f.menuItems.length;b<e;b++){h=f.menuItems[b];if(h!=="-"){d={itemId:"range-"+h,enableKeyEvents:true,hideLabel:false,fieldLabel:f.iconTpl.apply({cls:f.itemIconCls[h]||"no-icon",text:f.fieldLabels[h]||"",src:Ext.BLANK_IMAGE_URL}),labelSeparator:"",labelWidth:29,labelStyle:"position: relative;",listeners:{scope:f,change:f.onInputChange,keyup:f.onInputKeyUp,el:{click:function(k){k.stopPropagation()}}},activate:Ext.emptyFn,deactivate:Ext.emptyFn};Ext.apply(d,Ext.applyIf(c[h]||{},g[h]),f.menuItemCfgs);j=d.fieldCls||f.fieldCls;h=c[h]=Ext.create(j,d)}f.add(h)}},fireUpdate:function(){this.fireEvent("update",this)},getValue:function(){var a={},b,c;for(b in this.fields){c=this.fields[b];if(c.isValid()&&c.getValue()!==null){a[b]=c.getValue()}}return a},setValue:function(c){var b=this,a,d;for(a in b.fields){d=b.fields[a];d.suspendEvents();d.setValue(a in c?c[a]:"");d.resumeEvents()}b.fireEvent("update",b)},onInputKeyUp:function(b,a){if(a.getKey()===a.RETURN&&b.isValid()){a.stopEvent();this.hide()}},onInputChange:function(f){var e=this,c=e.fields,b=c.eq,d=c.gt,a=c.lt;if(f==b){if(d){d.setValue(null)}if(a){a.setValue(null)}}else{b.setValue(null)}this.updateTask.delay(this.updateBuffer)}},function(){this.prototype.iconTpl=Ext.create("Ext.XTemplate",'<img src="{src}" alt="{text}" class="'+Ext.baseCSSPrefix+'menu-item-icon ux-rangemenu-icon {cls}" />')});Ext.define("Ext.ux.grid.menu.ListMenu",{extend:"Ext.menu.Menu",labelField:"text",loadingText:"Loading...",loadOnShow:true,single:false,constructor:function(b){var e=this,c,d,a,f;e.selected=[];e.addEvents("checkchange");e.callParent([b=b||{}]);if(!b.store&&b.options){c=[];for(d=0,a=b.options.length;d<a;d++){f=b.options[d];switch(Ext.type(f)){case"array":c.push(f);break;case"object":c.push([f.id,f[e.labelField]]);break;case"string":c.push([f,f]);break}}e.store=Ext.create("Ext.data.ArrayStore",{fields:["id",e.labelField],data:c,listeners:{load:e.onLoad,scope:e}});e.loaded=true;e.autoStore=true}else{e.add({text:e.loadingText,iconCls:"loading-indicator"});e.store.on("load",e.onLoad,e)}},destroy:function(){var b=this,a=b.store;if(a){if(b.autoStore){a.destroyStore()}else{a.un("unload",b.onLoad,b)}}b.callParent()},show:function(){if(this.loadOnShow&&!this.loaded&&!this.store.loading){this.store.load()}this.callParent()},onLoad:function(c,b){var g=this,f,h,d,a,e={checkchange:g.checkChange,scope:g};Ext.suspendLayouts();g.removeAll(true);f=g.single?Ext.id():null;for(d=0,a=b.length;d<a;d++){h=b[d].get("id");g.add(Ext.create("Ext.menu.CheckItem",{text:b[d].get(g.labelField),group:f,checked:Ext.Array.contains(g.selected,h),hideOnClick:false,value:h,listeners:e}))}g.loaded=true;Ext.resumeLayouts(true);g.fireEvent("load",g,b)},getSelected:function(){return this.selected},setSelected:function(a){a=this.selected=[].concat(a);if(this.loaded){this.items.each(function(d){d.setChecked(false,true);for(var c=0,b=a.length;c<b;c++){if(d.value==a[c]){d.setChecked(true,true)}}},this)}},checkChange:function(b,a){var c=[];this.items.each(function(d){if(d.checked){c.push(d.value)}},this);this.selected=c;this.fireEvent("checkchange",b,a)}});Ext.define("Ext.ux.exporter.Formatter",{format:Ext.emptyFn,constructor:function(a){a=a||{};Ext.applyIf(a,{})}});Ext.define("Ext.ux.grid.filter.Filter",{extend:"Ext.util.Observable",active:false,dataIndex:null,menu:null,updateBuffer:500,constructor:function(a){Ext.apply(this,a);this.addEvents("activate","deactivate","serialize","update");Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=this.createMenu(a);this.init(a);if(a&&a.value){this.setValue(a.value);this.setActive(a.active!==false,true);delete a.value}},destroy:function(){if(this.menu){this.menu.destroy()}this.clearListeners()},init:Ext.emptyFn,createMenu:function(a){return Ext.create("Ext.menu.Menu",a)},getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return true},getSerialArgs:Ext.emptyFn,validateRecord:function(){return true},serialize:function(){var a=this.getSerialArgs();this.fireEvent("serialize",a,this);return a},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?"activate":"deactivate",this)}}}});Ext.define("Ext.ux.exporter.sdfFormatter.SdfFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/plain;base64,",extension:"sdf",format:function(b,c){var d=this;var a=[];b.each(function(e,f){if(e.molfile!==undefined){a.push(this.buildRecord(c.columns,e,e.molfile))}},this);return a.join("\n")+"\n"},buildRecord:function(c,e,b){var d=[];var a=e.data.csid;Ext.each(c,function(g){var f=">  <";if(!g.hidden&&g.text!="&#160"){var j=e.data[g.dataIndex];if(j.text!==undefined){j=j.text}var k=this.stripTags(j);var h=this.escapeTextSeperator(k);f=f+this.stripTags(g.text)+"> ("+a+")\n";f=f+h+"\n";if(h!==""){d.push(f)}}},this);return b+d.join("\n")+"\n$$$$"},stripTags:function(b){if(typeof(b)==="string"){b=b.replace(/<(.|\n)*?>/gi,"")}var a=document.createElement("textarea");a.innerHTML=b;return a.value},escapeTextSeperator:function(b){if(typeof(b)==="string"){b=b.replace(/"/gi,'""')}var a=document.createElement("textarea");a.innerHTML=b;return a.value}});Ext.define("Ext.ux.exporter.excelFormatter.ExcelFormatter",{extend:"Ext.ux.exporter.Formatter",uses:["Ext.ux.exporter.excelFormatter.Cell","Ext.ux.exporter.excelFormatter.Style","Ext.ux.exporter.excelFormatter.Worksheet","Ext.ux.exporter.excelFormatter.Workbook"],contentType:"data:application/vnd.ms-excel;base64,",extension:"xls",format:function(b,c){var a=new Ext.ux.exporter.excelFormatter.Workbook(c);a.addWorksheet(b,c||{});return a.render()}});Ext.define("Ext.ux.exporter.csvFormatter.CsvFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/csv;base64,",separator:"\t",extension:"csv",format:function(a,b){this.columns=b.columns||(a.fields?a.fields.items:a.model.prototype.fields.items);return this.getHeaders()+"\n"+this.getRows(a)},getHeaders:function(a){var b=[],c;Ext.each(this.columns,function(d){var e;if(d.text!=undefined){e=d.text}else{if(d.name){e=d.name.replace(/_/g," ");e=Ext.String.capitalize(e)}}if(d.text!="&#160"){b.push(e)}},this);return b.join(this.separator)},getRows:function(a){var b=[];a.each(function(c,d){b.push(this.geCell(c,d))},this);return b.join("\n")},geCell:function(a,c){var b=[];Ext.each(this.columns,function(e){var d=e.name||e.dataIndex;if(d){if(Ext.isFunction(e.renderer)){var f=e.renderer(a.get(d),null,a)}else{var f=a.get(d)}b.push(f)}});return b.join(this.separator)}});Ext.define("Ext.ux.grid.filter.BooleanFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.boolean",defaultValue:false,yesText:"Yes",noText:"No",init:function(a){var c=Ext.id();this.options=[Ext.create("Ext.menu.CheckItem",{text:this.yesText,group:c,checked:this.defaultValue===true}),Ext.create("Ext.menu.CheckItem",{text:this.noText,group:c,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var b=0;b<this.options.length;b++){this.options[b].on("click",this.fireUpdate,this);this.options[b].on("checkchange",this.fireUpdate,this)}},getValue:function(){return this.options[0].checked},setValue:function(a){this.options[a?0:1].setChecked(true)},getSerialArgs:function(){var a={type:"boolean",value:this.getValue()};return a},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue()}});Ext.define("Ext.ux.grid.filter.DateFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.date",uses:["Ext.picker.Date","Ext.menu.Menu"],afterText:"After",beforeText:"Before",compareMap:{before:"lt",after:"gt",on:"eq"},dateFormat:"m/d/Y",menuItems:["before","after","-","on"],menuItemCfgs:{selectOnFocus:true,width:125},onText:"On",pickerOpts:{},init:function(d){var g=this,c,e,a,f,b;c=Ext.apply(g.pickerOpts,{xtype:"datepicker",minDate:g.minDate,maxDate:g.maxDate,format:g.dateFormat,listeners:{scope:g,select:g.onMenuSelect}});g.fields={};for(e=0,a=g.menuItems.length;e<a;e++){f=g.menuItems[e];if(f!=="-"){b={itemId:"range-"+f,text:g[f+"Text"],menu:Ext.create("Ext.menu.Menu",{items:[Ext.apply(c,{itemId:f,listeners:{select:g.onPickerSelect,scope:g}}),]}),listeners:{scope:g,checkchange:g.onCheckChange}};f=g.fields[f]=Ext.create("Ext.menu.CheckItem",b)}g.menu.add(f)}g.values={}},onCheckChange:function(e,d){var c=this,b=e.menu.items.first(),f=b.itemId,a=c.values;if(d){a[f]=b.getValue()}else{delete a[f]}c.setActive(c.isActivatable());c.fireEvent("update",c)},onInputKeyUp:function(c,b){var a=b.getKey();if(a==b.RETURN&&c.isValid()){b.stopEvent();this.menu.hide()}},onMenuSelect:function(c,b){var a=this.fields,d=this.fields[c.itemId];d.setChecked(true);if(d==a.on){a.before.setChecked(false,true);a.after.setChecked(false,true)}else{a.on.setChecked(false,true);if(d==a.after&&this.getFieldValue("before")<b){a.before.setChecked(false,true)}else{if(d==a.before&&this.getFieldValue("after")>b){a.after.setChecked(false,true)}}}this.fireEvent("update",this);c.up("menu").hide()},getValue:function(){var b,a={};for(b in this.fields){if(this.fields[b].checked){a[b]=this.getFieldValue(b)}}return a},setValue:function(c,b){var a;for(a in this.fields){if(c[a]){this.getPicker(a).setValue(c[a]);this.fields[a].setChecked(true)}else{if(!b){this.fields[a].setChecked(false)}}}this.fireEvent("update",this)},isActivatable:function(){var a;for(a in this.fields){if(this.fields[a].checked){return true}}return false},getSerialArgs:function(){var a=[];for(var b in this.fields){if(this.fields[b].checked){a.push({type:"date",comparison:this.compareMap[b],value:Ext.Date.format(this.getFieldValue(b),this.dateFormat)})}}return a},getFieldValue:function(a){return this.values[a]},getPicker:function(a){return this.fields[a].menu.items.first()},validateRecord:function(b){var c,e,d=b.get(this.dataIndex),a=Ext.Date.clearTime;if(!Ext.isDate(d)){return false}d=a(d,true).getTime();for(c in this.fields){if(this.fields[c].checked){e=a(this.getFieldValue(c),true).getTime();if(c=="before"&&e<=d){return false}if(c=="after"&&e>=d){return false}if(c=="on"&&e!=d){return false}}}return true},onPickerSelect:function(b,a){this.values[b.itemId]=a;this.fireEvent("update",this)}});Ext.define("Ext.ux.grid.filter.ListFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.list",phpMode:false,init:function(a){this.dt=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},createMenu:function(a){var b=Ext.create("Ext.ux.grid.menu.ListMenu",a);b.on("checkchange",this.onCheckChange,this);return b},getValue:function(){return this.menu.getSelected()},setValue:function(a){this.menu.setSelected(a);this.fireEvent("update",this)},isActivatable:function(){return this.getValue().length>0},getSerialArgs:function(){return{type:"list",value:this.phpMode?this.getValue().join(","):this.getValue()}},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(a){var b=this.getValue();return Ext.Array.indexOf(b,a.get(this.dataIndex))>-1}});Ext.define("Ext.ux.grid.filter.NumericFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.numeric",uses:["Ext.form.field.Number"],createMenu:function(a){var b=this,c;c=Ext.create("Ext.ux.grid.menu.RangeMenu",a);c.on("update",b.fireUpdate,b);return c},getValue:function(){return this.menu.getValue()},setValue:function(a){this.menu.setValue(a)},isActivatable:function(){var a=this.getValue(),b;for(b in a){if(a[b]!==undefined){return true}}return false},getSerialArgs:function(){var c,b=[],a=this.menu.getValue();for(c in a){b.push({type:"numeric",comparison:c,value:a[c]})}return b},validateRecord:function(a){var d=a.get(this.dataIndex),b=this.getValue(),c=Ext.isNumber;if(c(b.eq)&&d!=b.eq){return false}if(c(b.lt)&&d>=b.lt){return false}if(c(b.gt)&&d<=b.gt){return false}return true}});Ext.define("Ext.ux.grid.filter.StringFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.string",iconCls:"ux-gridfilter-text-icon",emptyText:"Enter Filter Text...",selectOnFocus:true,width:125,init:function(a){Ext.applyIf(a,{enableKeyEvents:true,iconCls:this.iconCls,hideLabel:true,listeners:{scope:this,keyup:this.onInputKeyUp,el:{click:function(b){b.stopPropagation()}}}});this.inputItem=Ext.create("Ext.form.field.Text",a);this.menu.add(this.inputItem);this.updateTask=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(a){this.inputItem.setValue(a);this.fireEvent("update",this)},isActivatable:function(){return this.inputItem.getValue().length>0},getSerialArgs:function(){return{type:"string",value:this.getValue()}},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!="string"){return(this.getValue().length===0)}return b.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},onInputKeyUp:function(c,b){var a=b.getKey();if(a==b.RETURN&&c.isValid()){b.stopEvent();this.menu.hide();return}this.updateTask.delay(this.updateBuffer)}});Ext.define("Ext.ux.exporter.excelFormatter.Cell",{constructor:function(a){Ext.applyIf(a,{type:"String"});Ext.apply(this,a);Ext.ux.exporter.excelFormatter.Cell.superclass.constructor.apply(this,arguments)},render:function(){return this.tpl.apply(this)},tpl:new Ext.XTemplate('<ss:Cell ss:StyleID="{style}">','<ss:Data ss:Type="{type}"><![CDATA[{value}]]></ss:Data>',"</ss:Cell>")});Ext.define("Ext.ux.exporter.excelFormatter.Worksheet",{constructor:function(a,b){b=b||{};this.store=a;Ext.applyIf(b,{hasTitle:true,hasHeadings:true,stripeRows:true,title:"Workbook",columns:a.fields==undefined?{}:a.fields.items});Ext.apply(this,b);Ext.ux.exporter.excelFormatter.Worksheet.superclass.constructor.apply(this,arguments)},dateFormatString:"Y-m-d",worksheetTpl:new Ext.XTemplate('<ss:Worksheet ss:Name="{title}">',"<ss:Names>",'<ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\'{title}\'!R1:R2" />',"</ss:Names>",'<ss:Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="{colCount}" ss:ExpandedRowCount="{rowCount}">',"{columns}",'<ss:Row ss:Height="38">','<ss:Cell ss:StyleID="title" ss:MergeAcross="{colCount - 1}">','<ss:Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String">','<html:B><html:U><html:Font html:Size="15">{title}','</html:Font></html:U></html:B></ss:Data><ss:NamedCell ss:Name="Print_Titles" />',"</ss:Cell>","</ss:Row>",'<ss:Row ss:AutoFitHeight="1">',"{header}","</ss:Row>","{rows}","</ss:Table>","<x:WorksheetOptions>","<x:PageSetup>",'<x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" />','<x:Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" />','<x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" />',"</x:PageSetup>","<x:FitToPage />","<x:Print>","<x:PrintErrors>Blank</x:PrintErrors>","<x:FitWidth>1</x:FitWidth>","<x:FitHeight>32767</x:FitHeight>","<x:ValidPrinterInfo />","<x:VerticalResolution>600</x:VerticalResolution>","</x:Print>","<x:Selected />","<x:DoNotDisplayGridlines />","<x:ProtectObjects>False</x:ProtectObjects>","<x:ProtectScenarios>False</x:ProtectScenarios>","</x:WorksheetOptions>","</ss:Worksheet>"),render:function(a){return this.worksheetTpl.apply({header:this.buildHeader(),columns:this.buildColumns().join(""),rows:this.buildRows().join(""),colCount:this.columns.length,rowCount:this.store.getCount()+2,title:this.title})},buildColumns:function(){var a=[];Ext.each(this.columns,function(b){a.push(this.buildColumn())},this);return a},buildColumn:function(a){return Ext.String.format('<ss:Column ss:AutoFitWidth="1" ss:Width="{0}" />',a||164)},buildRows:function(){var a=[];this.store.each(function(b,c){a.push(this.buildRow(b,c))},this);return a},buildHeader:function(){var a=[];Ext.each(this.columns,function(b){var c;if(b.text!=undefined){c=b.text}else{if(b.name){c=b.name.replace(/_/g," ");c=Ext.String.capitalize(c)}}a.push(Ext.String.format('<ss:Cell ss:StyleID="headercell"><ss:Data ss:Type="String">{0}</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>',c))},this);return a.join("")},buildRow:function(a,c){var d,b=[];if(this.stripeRows===true){d=c%2==0?"even":"odd"}Ext.each(this.columns,function(f){var e=f.name||f.dataIndex;if(e){if(Ext.isFunction(f.renderer)){var h=f.renderer(a.get(e),null,a),g="String"}else{var h=a.get(e),g=this.typeMappings[f.type||a.fields.get(e).type.type]}b.push(this.buildCell(h,g,d).render())}},this);return Ext.String.format("<ss:Row>{0}</ss:Row>",b.join(""))},buildCell:function(c,b,a){if(b=="DateTime"&&Ext.isFunction(c.format)){c=c.format(this.dateFormatString)}return new Ext.ux.exporter.excelFormatter.Cell({value:c,type:b,style:a})},typeMappings:{"int":"Number",string:"String","float":"Number",date:"DateTime"}});Ext.define("Ext.ux.exporter.excelFormatter.Style",{constructor:function(a){a=a||{};Ext.apply(this,a,{parentStyle:"",attributes:[]});Ext.ux.exporter.excelFormatter.Style.superclass.constructor.apply(this,arguments);if(this.id==undefined){throw new Error("An ID must be provided to Style")}this.preparePropertyStrings()},preparePropertyStrings:function(){Ext.each(this.attributes,function(a,b){this.attributes[b].propertiesString=this.buildPropertyString(a);this.attributes[b].children=a.children||[];Ext.each(a.children,function(d,c){this.attributes[b].children[c].propertiesString=this.buildPropertyString(d)},this)},this)},buildPropertyString:function(b){var a="";Ext.each(b.properties||[],function(c){a+=Ext.String.format('ss:{0}="{1}" ',c.name,c.value)},this);return a},render:function(){return this.tpl.apply(this)},tpl:new Ext.XTemplate('<tpl if="parentStyle.length == 0">','<ss:Style ss:ID="{id}">',"</tpl>",'<tpl if="parentStyle.length != 0">','<ss:Style ss:ID="{id}" ss:Parent="{parentStyle}">',"</tpl>",'<tpl for="attributes">','<tpl if="children.length == 0">',"<ss:{name} {propertiesString} />","</tpl>",'<tpl if="children.length > 0">',"<ss:{name} {propertiesString}>",'<tpl for="children">',"<ss:{name} {propertiesString} />","</tpl>","</ss:{name}>","</tpl>","</tpl>","</ss:Style>")});Ext.define("Ext.ux.exporter.excelFormatter.Workbook",{constructor:function(a){a=a||{};Ext.apply(this,a,{title:"Workbook",worksheets:[],compiledWorksheets:[],cellBorderColor:"#e4e4e4",styles:[],compiledStyles:[],hasDefaultStyle:true,hasStripeStyles:true,windowHeight:9000,windowWidth:50000,protectStructure:false,protectWindows:false});if(this.hasDefaultStyle){this.addDefaultStyle()}if(this.hasStripeStyles){this.addStripedStyles()}this.addTitleStyle();this.addHeaderStyle()},render:function(){this.compileStyles();this.joinedCompiledStyles=this.compiledStyles.join("");this.compileWorksheets();this.joinedWorksheets=this.compiledWorksheets.join("");return this.tpl.apply(this)},addWorksheet:function(a,b){var c=new Ext.ux.exporter.excelFormatter.Worksheet(a,b);this.worksheets.push(c);return c},addStyle:function(a){var b=new Ext.ux.exporter.excelFormatter.Style(a||{});this.styles.push(b);return b},compileStyles:function(){this.compiledStyles=[];Ext.each(this.styles,function(a){this.compiledStyles.push(a.render())},this);return this.compiledStyles},compileWorksheets:function(){this.compiledWorksheets=[];Ext.each(this.worksheets,function(a){this.compiledWorksheets.push(a.render())},this);return this.compiledWorksheets},tpl:new Ext.XTemplate('<?xml version="1.0" encoding="utf-8"?>','<ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office">',"<o:DocumentProperties>","<o:Title>{title}</o:Title>","</o:DocumentProperties>","<ss:ExcelWorkbook>","<ss:WindowHeight>{windowHeight}</ss:WindowHeight>","<ss:WindowWidth>{windowWidth}</ss:WindowWidth>","<ss:ProtectStructure>{protectStructure}</ss:ProtectStructure>","<ss:ProtectWindows>{protectWindows}</ss:ProtectWindows>","</ss:ExcelWorkbook>","<ss:Styles>","{joinedCompiledStyles}","</ss:Styles>","{joinedWorksheets}","</ss:Workbook>"),addDefaultStyle:function(){var a=[{name:"Color",value:this.cellBorderColor},{name:"Weight",value:"1"},{name:"LineStyle",value:"Continuous"}];this.addStyle({id:"Default",attributes:[{name:"Alignment",properties:[{name:"Vertical",value:"Top"},{name:"WrapText",value:"1"}]},{name:"Font",properties:[{name:"FontName",value:"arial"},{name:"Size",value:"10"}]},{name:"Interior"},{name:"NumberFormat"},{name:"Protection"},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Top"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Bottom"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Left"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Right"}].concat(a)}]}]})},addTitleStyle:function(){this.addStyle({id:"title",attributes:[{name:"Borders"},{name:"Font"},{name:"NumberFormat",properties:[{name:"Format",value:"@"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"},{name:"Vertical",value:"Center"}]}]})},addHeaderStyle:function(){this.addStyle({id:"headercell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"10"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#A3C9F1"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"}]}]})},addStripedStyles:function(){this.addStyle({id:"even",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCFFFF"}]}]});this.addStyle({id:"odd",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCCCFF"}]}]});Ext.each(["even","odd"],function(a){this.addChildNumberFormatStyle(a,a+"date","[ENG][$-409]dd-mmm-yyyy;@");this.addChildNumberFormatStyle(a,a+"int","0");this.addChildNumberFormatStyle(a,a+"float","0.00")},this)},addChildNumberFormatStyle:function(a,c,b){this.addStyle({id:c,parentStyle:"even",attributes:[{name:"NumberFormat",properties:[{name:"Format",value:b}]}]})}});Ext.define("CS.view.CompoundWindow",{extend:"Ext.window.Window",alias:"widget.cs.compound.window",title:"ChemSpider compound details...",layout:{type:"table",columns:2},defaults:{frame:true,margin:"5 5 5 5"},autoScroll:true,modal:false,resizable:true,autoShow:false,closeAction:"hide",height:550,width:700,initComponent:function(){this.compoundInfo=Ext.create("CS.view.Compound",{title:"Properties",height:270,frame:true,colspan:2});this.synonyms=Ext.create("CS.view.Synonyms",{id:"csWindowSynonyms",title:"Synonyms",height:300,width:385,frame:true});this.datasources=Ext.create("CS.view.DataSources",{id:"csWindowDataSources",title:"Data Sources",height:300,width:385,frame:true});this.compoundStore=Ext.create("CS.store.Compound");this.loadingMask=new Ext.LoadMask(this,{msg:"Loading..."});this.items=[this.compoundInfo,this.synonyms,this.datasources];this.buttons=[{text:"Close",scope:this,handler:this.close}];this.callParent(arguments)},showCompound:function(a){var b=this;this.compoundStore.load({params:{"csids[0]":a,serfilter:"Compound[CSID|Name|MF|Mol|MM|Synonyms|References|Blobs|Identifiers]"},callback:function(d,c,f){if(f){var e=b.compoundStore.first();b.compoundInfo.loadData(e);b.synonyms.loadData(e);b.datasources.loadData(e)}else{Ext.MessageBox.show({title:"Error",msg:"Cannot get compoun details for CSID - "+a+": "+c.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}b.loadingMask.hide()}});this.show();this.loadingMask.show()}});Ext.define("CS.config.Settings",{singleton:true,baseUrl:chemspiderURL});Ext.define("CS.view.BaseProperties",{extend:"Ext.panel.Panel",alias:"widget.cs.baseproperties",requires:["CS.config.Settings"],autoScroll:true,layout:"fit",border:0,constructor:function(){this.callParent(arguments);this.tpl=new Ext.XTemplate('<tpl for=".">','<div class="base_props">','<div class="name">{Name}</div>','<div class="mf">{MF:this.formatFormula}</div>','<div class="prop"><span class="name">ChemSpider ID:</span> <a href="'+CS.config.Settings.baseUrl+'/{CSID}" target="chemspider">{CSID}</a></div>','<div class="prop"><span class="name">Monoisotopic mass:</span> {MM}</div>','<tpl for="Identifiers">','<tpl if="this.isSMILES(values)">','<div class="prop"><span class="name">SMILES:</span> {Value}</div>',"</tpl>",'<tpl if="this.isStdInChi(values)">','<div class="prop"><span class="name">Std. InChI:</span> {Value}</div>',"</tpl>",'<tpl if="this.isStdInChiKey(values)">','<div class="prop"><span class="name">Std. InChIKey:</span> {Value}</div>',"</tpl>","</tpl>","</div>","</tpl>",{formatFormula:function(a){return a.replace(/_{/g,"<sub>").replace(/}/g,"</sub>")},isSMILES:function(a){return a.IdentifierType==1},isStdInChi:function(a){return a.IdentifierType==0&&a.Version=="v1.02s"},isStdInChiKey:function(a){return a.IdentifierType==2&&a.Version=="v1.02s"}})},loadData:function(a){this.update(a)}});Ext.define("CS.view.Molecule2D",{extend:"Ext.Component",alias:"widget.cs.molecule2D",autoEl:{tag:"img",src:Ext.BLANK_IMAGE_URL},width:200,height:200,csid:0,onRender:function(){this.autoEl=Ext.apply({},this.initialConfig,this.autoEl);this.callParent(arguments)},setSrc:function(a){if(this.rendered){this.el.dom.src=a}else{this.src=a}},getSrc:function(a){return this.el.dom.src||this.src},load:function(a){this.setSrc(CS.config.Settings.baseUrl+"/ImagesHandler.ashx?id="+a+"&w="+this.width+"&h="+this.height)}});Ext.define("CS.view.Molecule3D",{extend:"Ext.Component",alias:"widget.cs.molecule3D",width:200,height:200,mol:"",autoEl:{tag:"applet",code:"JmolApplet",codebase:"lib/third/jmol",archive:"JmolApplet0.jar",mayscript:"true",hspace:0,vspace:0,align:"middle",children:[{tag:"param",name:"progressbar",value:"true"},{tag:"param",name:"bgcolor",value:"white"}]},onRender:function(){this.autoEl=Ext.apply({name:this.id},this.initialConfig,this.autoEl);this.callParent(arguments);if(this.mol!=""){Ext.defer(function(a){this.setMol(a)},200,this,[this.mol])}},setMol:function(a){this.getEl().dom.loadInlineString(a,"",false)}});Ext.define("CS.view.Compound",{extend:"Ext.panel.Panel",alias:"widget.cs.compound",requires:["CS.view.BaseProperties","CS.view.Molecule2D","CS.view.Molecule3D"],autoScroll:true,border:0,layout:"hbox",bodyStyle:"background-color: #fff;",constructor:function(){this.callParent(arguments);this.add({items:{xtype:"cs.molecule2D",id:this.getMol2DId(),height:223}});this.add({flex:1,items:{xtype:"cs.baseproperties",id:this.getBasePropsId(),height:223}})},is3DTabActive:function(){return this.molTabs.getActiveTab().id=="tab-mol-3D"},getMol2DId:function(){return this.id+"_Mol2D"},getMol3DId:function(){return this.id+"_Mol3D"},getBasePropsId:function(){return this.id+"_BaseProps"},loadData:function(a){Ext.getCmp(this.getMol2DId()).load(a.data.CSID);Ext.getCmp(this.getBasePropsId()).loadData(a.data);this.mol=a.data.Mol}});Ext.define("CS.view.Synonyms",{extend:"Ext.tab.Panel",alias:"widget.cs.synonyms",height:250,cls:"text-class",frame:false,border:"0 0 0 0",autoScroll:false,collapsible:false,closable:false,bodyStyle:"background-color: #fff; padding-left: .5em;",tpl:new Ext.XTemplate('<tpl if="this.hasSynonyms(values)">',"<ul>",'<tpl for="Synonyms">',"<li>{Name}</li>","</tpl>","</ul>","</tpl>",'<tpl if="!this.hasSynonyms(values)">',"<i>No synonyms</i>","</tpl>",{hasSynonyms:function(a){return a.Synonyms.length>0}}),loadData:function(a){this.update("<i>Loading...</i>");this.removeAll();if(a.hasApprovedSynonyms()){this.addTab("Approved",a.getApprovedSynonyms())}if(a.hasConfirmedSynonyms()){this.addTab("Confirmed",a.getConfirmedSynonyms())}if(a.hasDeletedSynonyms()){this.addTab("Deleted",a.getDeletedSynonyms())}if(a.hasRejectedSynonyms()){this.addTab("Rejected",a.getRejectedSynonyms())}if(a.hasUncertaintSynonyms()){this.addTab("Uncertain",a.getUncertaintSynonyms())}this.update("")},addTab:function(a,b){this.add({title:a,items:{xtype:"panel",id:this.id+"_panel"+this.items.getCount(),border:0,padding:0,tpl:new Ext.XTemplate('<ul class="zebra" style="overflow:auto; height:100%;">','<tpl for=".">',"<li>{Name}</li>","</tpl>","</ul>"),data:b}})}});Ext.define("CS.view.DataSources",{extend:"Ext.tab.Panel",alias:"widget.cs.datasources",height:250,border:"0 0 0 0",loadData:function(d){var c=this;this.removeAll();var b=new Ext.util.HashMap();for(var a=0;a<d.data.References.length;a++){var e=d.data.References[a];if(e.Text!=null&&e.Text!=""){if(!b.containsKey(e.Source)){b.add(e.Source,new Array())}b.get(e.Source).push(e)}}b.each(function(f,h,g){c.add({title:f,items:{xtype:"panel",id:c.id+"_panel"+c.items.getCount(),border:0,tpl:new Ext.XTemplate('<ul class="zebra" style="overflow:auto; height:100%;">','<tpl for=".">',"<li>",'<tpl if="this.hasLink(values)">','<a href="{Link}" target="datasources">{Text}</a>',"</tpl>",'<tpl if="!this.hasLink(values)">',"{Text}","</tpl>","</li>","</tpl>","</ul>",{hasLink:function(j){return j.Link!=null&&j.Link.length>0}}),data:h}})})}});Ext.define("CS.model.Compound",{extend:"Ext.data.Model",id:"CSID",spectra:null,cifs:null,images:null,uncertaintSyns:null,rejectedSyns:null,deletedSyns:null,confirmedSyns:null,approvedSyns:null,fields:[{name:"CSID",mapping:"CSID"},{name:"Name",mapping:"Name"},{name:"MF",mapping:"MF"},{name:"AM",mapping:"AM"},{name:"MW",mapping:"MW"},{name:"MM",mapping:"MM"},{name:"Mol",mapping:"Mol"},{name:"Identifiers",mapping:"Identifiers"},{name:"Synonyms",mapping:"Synonyms"},{name:"References",mapping:"References"},{name:"Blobs",mapping:"Blobs"}],hasSynonyms:function(){return this.data!=null&&this.data.Synonyms.length>0},hasReferences:function(){return this.data!=null&&this.data.References.length>0},hasSpectra:function(){if(this.spectra==null){this.parseBlobs()}return this.spectra.length>0},hasImages:function(){if(this.images==null){this.parseBlobs()}return this.images.length>0},hasCIFs:function(){if(this.cifs==null){this.parseBlobs()}return this.cifs.length>0},getSpectra:function(){if(this.spectra==null){this.parseBlobs()}return this.spectra},getImages:function(){if(this.images==null){this.parseBlobs()}return this.images},getCIFs:function(){if(this.cifs==null){this.parseBlobs()}return this.cifs},parseBlobs:function(){this.spectra=new Array();this.cifs=new Array();this.images=new Array();for(var b=0;b<this.data.Blobs.length;b++){var a=this.data.Blobs[b];if(a.BlobType==0){this.spectra.push(a)}else{if(a.BlobType==1){this.images.push(a)}else{if(a.BlobType==2){this.cifs.push(a)}}}}},hasUncertaintSynonyms:function(){if(this.uncertaintSyns==null){this.parseSynonyms()}return this.uncertaintSyns.length>0},hasRejectedSynonyms:function(){if(this.rejectedSyns==null){this.parseSynonyms()}return this.rejectedSyns.length>0},hasDeletedSynonyms:function(){if(this.deletedSyns==null){this.parseSynonyms()}return this.deletedSyns.length>0},hasConfirmedSynonyms:function(){if(this.confirmedSyns==null){this.parseSynonyms()}return this.confirmedSyns.length>0},hasApprovedSynonyms:function(){if(this.approvedSyns==null){this.parseSynonyms()}return this.approvedSyns.length>0},getUncertaintSynonyms:function(){if(this.uncertaintSyns==null){this.parseSynonyms()}return this.uncertaintSyns},getRejectedSynonyms:function(){if(this.rejectedSyns==null){this.parseSynonyms()}return this.rejectedSyns},getDeletedSynonyms:function(){if(this.deletedSyns==null){this.parseSynonyms()}return this.deletedSyns},getConfirmedSynonyms:function(){if(this.confirmedSyns==null){this.parseSynonyms()}return this.confirmedSyns},getApprovedSynonyms:function(){if(this.approvedSyns==null){this.parseSynonyms()}return this.approvedSyns},parseSynonyms:function(){this.uncertaintSyns=new Array();this.rejectedSyns=new Array();this.deletedSyns=new Array();this.confirmedSyns=new Array();this.approvedSyns=new Array();for(var b=0;b<this.data.Synonyms.length;b++){var a=this.data.Synonyms[b];if(a.Reliability==0){this.uncertaintSyns.push(a)}else{if(a.Reliability==1){this.rejectedSyns.push(a)}else{if(a.Reliability==2){this.deletedSyns.push(a)}else{if(a.Reliability==3){this.confirmedSyns.push(a)}else{if(a.Reliability==4){this.approvedSyns.push(a)}}}}}}}});Ext.define("CS.store.Compound",{extend:"Ext.data.Store",requires:["CS.model.Compound","CS.config.Settings"],model:"CS.model.Compound",constructor:function(){this.callParent(arguments);this.setProxy({type:"jsonp",timeout:60000,url:CS.config.Settings.baseUrl+"/JSON.ashx?op=GetRecordsAsCompounds"})}});Ext.define("LSP.view.usergrid.UserGrid",{extend:"Ext.form.Panel",alias:"widget.usergrid",initComponent:function(){this.items=[grid=Ext.widget("dynamicgrid")];grid.buttonRender(["new","edit","filter","delete","load","exporter"]);this.callParent(arguments)}});Ext.define("LSP.view.sparqlform.Queryform",{extend:"Ext.form.Panel",alias:"widget.queryform",closable:true,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[{xtype:"form",padding:"5 5 0 5",border:false,style:"background-color: #fff;",items:[{xtype:"textarea",name:"query",id:"query_id",fieldLabel:"SPARQL query",height:120,labelWidth:110,width:700,value:"SELECT *  WHERE { ?s ?p ?o}"},{xtype:"fieldcontainer",height:31,width:700,layout:{type:"column"},items:[{xtype:"numberfield",name:"limit",margin:"0 10 0 110",padding:"",width:190,fieldLabel:"Limit",labelWidth:110,autoStripChars:true,maxValue:100,minValue:1,value:10,allowDecimals:false},{xtype:"numberfield",name:"offset",margin:"0 10 0 0",width:190,fieldLabel:"Offset",labelWidth:110,maxValue:10000,minValue:0,value:0,allowDecimals:false}]},{xtype:"button",action:"query",text:"Submit query"}]},{xtype:"dynamicgrid3",title:"SPARQL query results",name:"sparql_query_results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.view.dropdowns.conceptWikiCompoundLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiCompoundLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"concept_label"},{type:"string",name:"concept_url"},{type:"string",name:"define_url"},{type:"string",name:"concept_uuid"},{type:"string",name:"concept_alt_labels"},{type:"string",name:"tag_label"},{type:"string",name:"tag_uuid"},{type:"string",name:"match"}],proxy:{type:"ajax",api:{read:"/concept_wiki_api_calls/compound_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"concept_url",displayField:"concept_label",name:"compound_uri",minChars:4,hideTrigger:true,forceSelection:true,allowBlank:false,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,fieldLabel:"Compound name",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching compounds found.",getInnerTpl:function(){return'<p><span style="font-family: verdana; color: grey; "><small>Match: {match}</small></span><br/><b>{concept_label}</b> <a href="{define_url}" target="_blank">(definition)</a></p>'}}});Ext.define("LSP.view.cmpd_by_name.CmpdByNameForm",{extend:"Ext.form.Panel",alias:"widget.CmpdByNameForm",closable:true,header:false,requires:["LSP.view.dropdowns.conceptWikiCompoundLookup","LSP.view.dynamicgrid.DynamicGrid","LSP.view.cmpd_by_name.CmpdByNameSingleDisplayForm"],layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Type in compound name. E.g. "Aspirin"</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[Ext.create("CW.view.ConceptWikiLookup",{xtype:"conceptWikiLookup",fieldLabel:"Compound name",itemId:"compoundByNameLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),extraParams:{branch:4}}}),name:"compound_uri",cwTagUuid:"07a84994-e464-4bbf-812a-a4b96fa3d197"}),{xtype:"button",padding:"5 5 5 5",text:"Search",itemId:"CmpdByNameSubmit_id",disabled:true,action:"query_cmpd_by_name"},{xtype:"radiogroup",width:160,labelWidth:65,fieldLabel:"Provenance",itemId:"provId",margin:"5 0 0 90",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]}]},{xtype:"CmpdByNameSingleDisplayForm",flex:1}]});this.callParent(arguments)}});Ext.define("LSP.view.dropdowns.conceptWikiLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"concept_label"},{type:"string",name:"concept_url"},{type:"string",name:"concept_uuid"},{type:"string",name:"concept_alt_labels"},{type:"string",name:"tag_label"},{type:"string",name:"tag_uuid"}],proxy:{type:"ajax",api:{read:"/concept_wiki_api_calls/concept_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"concept_url",displayField:"concept_label",name:"concept_uri",minChars:4,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:70,typeAheadDelay:150,queryDelay:700,fieldLabel:"Concept name",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching concepts found.",getInnerTpl:function(){return'<p><b>{concept_label}</b> <a href="{concept_url}" target="_blank">(definition)</a> <i>({tag_label})</i><br/ ><small><i>{concept_alt_labels}</i></small></p>'}}});Ext.define("LSP.view.concept.SummeryForm",{extend:"Ext.form.Panel",alias:"widget.SummeryForm",closable:true,requires:["LSP.view.dropdowns.conceptWikiLookup"],initComponent:function(){var a=this;a.items=[{xtype:"container",height:"6%",margin:"5 5 5 5",name:"form_fields",layout:{type:"column"},items:[{xtype:"conceptWikiLookup"},{xtype:"button",padding:"5 5 5 5",text:"Look up",action:"look_up_concept"},{name:"utf8",xtype:"hidden",value:"&#x2713;"},{name:"authenticity_token",xtype:"hidden",value:$$("meta[name=csrf-token]")[0].readAttribute("content")}]},object_grid=Ext.widget("dynamicgrid2"),subject_grid=Ext.widget("dynamicgrid2")];object_grid.setTitle("Concept Properties");object_grid.setHeight("47%");subject_grid.setTitle("Concept Relations");subject_grid.setHeight("47%");a.callParent(arguments)}});Ext.define("LSP.view.placeholder.temp",{extend:"Ext.form.Panel",alias:"widget.temp",closable:true,title:"OpenPhacts Exemplars",initComponent:function(){var a=this;Ext.applyIf(a,{xtype:"panel",bodyPadding:10,title:"OpenPhacts Exemplars",layout:"anchor",autoScroll:true,items:[{xtype:"label",text:"This page contains links to the OpenPhacts exemplars",labelWidth:600},{xtype:"displayfield",value:"<a target='_blank' href='http://ws.bioinfo.cnio.es/OpenPHACTS/'>Target Dossier</a>",labelWidth:600},{xtype:"displayfield",value:"<a target='_blank' href='http://cbn.zbh.uni-hamburg.de'>ChemBioNavigator</a> - username/password: cbn/cbn4ops",labelWidth:600},{xtype:"displayfield",value:"Polypharmacology Browser - no link yet",labelWidth:600}]});this.callParent(arguments)}});Ext.define("LSP.view.dropdowns.pmidLookup",{extend:"Ext.form.ComboBox",alias:"widget.pmidLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"pmid"},{type:"string",name:"pmid_uri"}],proxy:{type:"ajax",api:{read:"core_api_calls/pmid_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"pmid_uri",displayField:"pmid",name:"pmid_uri",minChars:2,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing Pubmed id...",margin:"5 5 5 5",width:600,queryDelay:700,fieldLabel:"Pubmed id",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching pubmed ids found."}});Ext.define("LSP.view.textmining.pmidTextMiningHitsForm",{extend:"Ext.form.Panel",alias:"widget.pmidTextMiningHits",requires:["LSP.view.dropdowns.pmidLookup"],closable:true,height:560,width:606,bodyPadding:10,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",activeItem:0,layout:{type:"column"},items:[{xtype:"pmidLookup",margin:"0 10 0 10",labelWidth:75,width:650},{xtype:"button",text:"Search...",action:"query",disabled:true,width:120}]},{xtype:"fieldset",height:200,layout:"anchor",defaults:{labelWidth:75},title:"Bibliographic information",items:[{xtype:"displayfield",fieldLabel:"Title",name:"title",anchor:"100%"},{xtype:"textarea",height:150,readOnly:true,fieldLabel:"Abstract",name:"abstract",anchor:"100%"}]},{xtype:"dynamicgrid2",title:"Text mined concepts",gridBaseTitle:"Text mined concepts",name:"textmining_hits",flex:1}]});a.callParent(arguments)}});Ext.define("LSP.view.dropdowns.wikiPathwaysCompoundLookup",{extend:"Ext.form.ComboBox",alias:"widget.wikiPathwaysCompoundLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"compound_name"},{type:"string",name:"compound_uri"}],proxy:{type:"ajax",api:{read:"/core_api_calls/wiki_pathway_compound_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"compound_uri",displayField:"compound_name",name:"compound_uri",minChars:4,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,queryDelay:700,fieldLabel:"Compound name",labelWidth:120,listConfig:{loadingText:"Searching..."}});Ext.define("LSP.view.pathways.pathwayByCompoundForm",{extend:"Ext.form.Panel",alias:"widget.pathwayByCompoundForm",requires:["LSP.view.dropdowns.wikiPathwaysCompoundLookup"],closable:true,height:560,width:606,bodyPadding:10,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",activeItem:0,layout:{type:"column"},items:[{xtype:"wikiPathwaysCompoundLookup",margin:"0 10 0 10",labelWidth:100,width:650},{xtype:"button",text:"Search...",disabled:true,action:"query",width:120}]},{xtype:"dynamicgrid2",title:"Pathways including compound",gridBaseTitle:"Pathways including compound",name:"pathway_by_cmpd_grid",flex:1,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"View pathway in WikiPathways applet (Google Chrome only)",action:"wp_view"}]}]}]});a.callParent(arguments)}});Ext.define("LSP.view.dropdowns.wikiPathwaysProteinLookup",{extend:"Ext.form.ComboBox",alias:"widget.wikiPathwaysProteinLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"wp_protein_name"},{type:"string",name:"wp_protein_uri"}],proxy:{type:"ajax",api:{read:"/core_api_calls/wiki_pathway_protein_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"wp_protein_uri",displayField:"wp_protein_name",name:"wp_protein_uri",minChars:4,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,queryDelay:700,fieldLabel:"Protein name",labelWidth:120,listConfig:{loadingText:"Searching..."}});Ext.define("LSP.view.pathways.pathwayByProteinForm",{extend:"Ext.form.Panel",alias:"widget.pathwayByProteinForm",requires:["LSP.view.dropdowns.wikiPathwaysProteinLookup"],closable:true,height:560,width:606,bodyPadding:10,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",activeItem:0,layout:{type:"column"},items:[{xtype:"wikiPathwaysProteinLookup",margin:"0 10 0 10",labelWidth:100,width:650},{xtype:"button",text:"Search...",action:"query",disabled:true,width:120}]},{xtype:"dynamicgrid2",title:"Pathways including protein",gridBaseTitle:"Pathways including protein",name:"pathway_by_protein_grid",flex:1,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"View pathway in WikiPathways applet (Google Chrome only)",action:"wp_view"}]}]}]});a.callParent(arguments)}});Ext.define("LSP.view.Viewer",{extend:"Ext.tab.Panel",alias:"widget.viewer",xtype:"plain-tabs",plain:true,requires:["LSP.view.dynamicgrid.DynamicGrid","LSP.view.usergrid.UserGrid","LSP.view.sparqlform.Queryform","LSP.view.larkc_sim_search.SimSearchForm","LSP.view.cmpd_by_name.CmpdByNameForm","LSP.view.target_by_name.TargetByNameForm","LSP.view.pharm_by_cmpd_name2.PharmByCmpdNameForm","LSP.view.pharm_by_target_name2.PharmByTargetNameForm","LSP.view.concept.SummeryForm","LSP.view.placeholder.temp","LSP.view.pharm_by_enzyme_family.PharmEnzymeForm","LSP.view.textmining.pmidTextMiningHitsForm","LSP.view.pathways.pathwayByCompoundForm","LSP.view.pathways.pathwayByProteinForm","LSP.view.api_status.Status","LSP.view.background_tasks.BackgroundTasksForm"],activeItem:0,margins:"0 4 4 4",items:[{title:"Home",bodyPadding:60,padding:"0 0 0 100",html:'<div class="welcome-text-heading">Welcome to the Open PHACTS Explorer</div><br><br><p><div class="welcome-text">We are pleased to present the first public release of the beta Open PHACTS Explorer.</div></p><br><p><div class="welcome-text">The Open PHACTS Explorer allows multiple sources of publicly-available pharmacological and physicochemical data to be intuitively queried, and makes data provenance accessible at every step. The Open PHACTS Explorer was built to answer critical pharmacological questions as defined by academic and pharmaceutical industry scientists.</div></p><br><p><div class="welcome-text">For more information visit the Open PHACTS Explorer <a href="http://www.openphacts.org/explorer">homepage</a></div></p><br><br><iframe  width="640" height="360" src="http://www.youtube.com/embed/BK3fkEFkOy0?feature=player_embedded" frameborder="0" allowfullscreen></iframe><br><br><p><div class="welcome-text">This is the first public release of the Open PHACTS Explorer, and we look forward to and value your feedback and comments.</div></p><br><br><p><div class="welcome-text-linkout"><a href="http://www.openphacts.org/the-project">About us & Acknowledgments</a></div></p>'}],initComponent:function(){console.log("Viewer: initComponent()");this.callParent(arguments);this.on("tabchange",function(c,a,b){Ext.History.add("!p="+a.xtype)})}});Ext.define("LSP.view.feedback.FeedbackPanel",{extend:"Ext.panel.Panel",alias:"widget.FeedbackPanel",layout:"anchor",bodyCls:"fb-panel",border:false,items:[{xtype:"displayfield",value:"<br>",itemId:"spacer1"},{xtype:"displayfield",anchor:"100%",value:'Open PHACTS Explorer <a href="http://www.openphacts.org/explorer" target="_blank">homepage</a>',fieldCls:"fb-message",itemId:"homepage"},{xtype:"displayfield",value:"<br>",itemId:"spacer2"},{xtype:"displayfield",fieldCls:"fb-message",value:'Watch <a href="http://www.openphacts.org/tutorials" target="_blank">tutorials</a>',itemId:"tutorial"},{xtype:"displayfield",value:"<br>",itemId:"spacer3"},{xtype:"displayfield",anchor:"100%",itemId:"fpUserMessage1",fieldCls:"fb-message",value:'Give us <a href="http://www.openphacts.org/explorer/160" target="_blank">feedback</a>.'},{xtype:"displayfield",fieldCls:"fb-message",value:"Please note that we read everything, but can't always respond.",itemId:"feedbackText"},{xtype:"displayfield",value:"<br>",itemId:"spacer4"},{xtype:"displayfield",fieldCls:"fb-message",value:'See <a href="http://www.openphacts.org/known-issues-with-beta-open-phacts-explorer-" target="_blank">known issues</a>',itemId:"issues"},{xtype:"displayfield",value:"<br>",itemId:"spacer5"},{xtype:"displayfield",anchor:"100%",itemId:"fbVersionId",fieldCls:"fb-message",value:"version: "+explorer_version},{xtype:"displayfield",value:"<br>",itemId:"spacer6"}]});Ext.define("LSP.view.Navigator",{extend:"Ext.Panel",alias:"widget.navigator",requires:["LSP.view.Appmoduletree","Ext.layout.container.Accordion","LSP.view.feedback.FeedbackPanel","LSP.view.api_status.Status"],collapsible:true,margins:"0 0 4 4",layout:"accordion",layoutConfig:{animate:true},initComponent:function(){this.items=[{title:"Navigation",layout:"fit",border:false,iconCls:"nav",items:[{xtype:"appmoduletree",id:"appModuleTree",border:false}]},{title:"Help and Feedback",border:false,autoScroll:true,iconCls:"fb-accordion",bodyBorder:false,items:[{xtype:"FeedbackPanel"}]},{title:"API Status",border:false,autoScroll:true,iconCls:"fb-accordion",bodyBorder:false,items:[{xtype:"Status"}]},{title:"TSV Downloads",border:false,itemId:"background_tasks_form",autoScroll:true,iconCls:"fb-accordion",bodyBorder:false,items:[{xtype:"BackgroundTasksForm"}]}];this.callParent(arguments)}});Ext.define("LSP.view.user.Loginbutton",{extend:"Ext.Button",alias:"widget.loginbutton",size:"small",text:"Log in",initComponent:function(){this.callParent(arguments)}});Ext.define("LSP.view.user.Logoutbutton",{extend:"Ext.Button",alias:"widget.logoutbutton",size:"small",text:"Log out",initComponent:function(){this.callParent(arguments)}});Ext.define("LSP.view.user.Newbutton",{extend:"Ext.Button",alias:"widget.usernewbutton",size:"small",text:"Create account",initComponent:function(){this.callParent(arguments)}});iconSize="small";Ext.define("LSP.view.Viewport",{extend:"Ext.container.Viewport",alias:"widget.lspviewport",requires:["LSP.view.Viewer","LSP.view.Navigator","LSP.view.Settings","LSP.view.user.Loginbutton","LSP.view.user.Logoutbutton","LSP.view.user.Newbutton","Ext.layout.container.Border","Ext.toolbar.Spacer","LSP.store.GuiComponents"],listeners:{afterrender:{fn:function(){console.log("Viewport: afterrender()");var a=Ext.History.getToken();if(a){if(a.length>0){this.handleHistoryToken(a)}}}}},layout:"border",getFormByXtype:function(a){return Ext.data.StoreManager.lookup("GuiComponents").findRecord("xtype",a)},handleHistoryToken:function(b){console.log("Viewport: handleHistoryToken()");if(b){if(b.indexOf("!")==0){var a=this.parseHistoryToken(unescape(b).substring(1));if(a.p){var c=this.getFormByXtype(a.p);if(c){this.changeView(c,a)}}}}},parseHistoryToken:function(c){console.log("Viewport: parseHistoryToken()");var b={};var a=c.split("&");Ext.each(a,function(g){var f=g.indexOf("=");if(f!=-1){var d=g.substring(0,f);var e=g.substring(f+1,g.length);b[d]=e}});return b},changeView:function(b,c){console.log("Viewport: changeView()");var a;Ext.getCmp("centerView").items.each(function(e){if(e.gridId==b.data.id){a=e;return}});if(!a){a=Ext.widget(b.data.xtype);a.setTitle(b.data.home);a.url=b.data.url;a.gridId=b.data.id;Ext.getCmp("centerView").add(a)}var d=Ext.getCmp("centerView");d.suspendEvents(false);d.setActiveTab(a);d.resumeEvents();if(c){if(a.setFormData){a.setFormData(c)}else{a.fireEvent("historyToken",c)}}},initComponent:function(){console.log("Viewport: initComponent()");LDAProvenanceMode=LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR;Ext.History.init();Ext.History.on("change",function(b){if(b){this.handleHistoryToken(b)}},this);var a=Ext.create("Ext.Img",{src:"./assets/ops_logo.png",bodyStyle:{background:"transparent"},width:77,height:50});this.items=[{region:"north",id:"northView",height:60,border:false,bodyStyle:{background:"transparent"},layout:{type:"hbox",padding:"5",align:"middle"},items:[a,{id:"lsp-header",xtype:"box",html:"<h1>Open PHACTS Explorer</h1>"},{xtype:"tbspacer",flex:1},{xtype:"displayfield",value:"Testing connection to OPS API...",width:400,name:"ops_api_staus",id:"ops_api_staus_id",hidden:true},{xtype:"tbspacer",flex:1},{xtype:"loginbutton",id:"loginButton",hidden:true},{xtype:"usernewbutton",id:"userNewButton",hidden:true},{xtype:"logoutbutton",id:"logoutButton",hidden:true}]},{region:"center",id:"centerView",xtype:"viewer"},{region:"west",id:"westView",width:230,xtype:"navigator"}];this.callParent(arguments)}});Ext.create("Ext.app.Application",{name:"LSP",appFolder:"app",requires:["LDA.helper.LDAConstants","CW.config.Settings"],controllers:["grids.DynamicGrid","NavigationTree","SimSearchForm","CmpdByNameForm","TargetByNameForm","PharmByTargetNameForm","PharmByCmpdNameForm","PharmByEnzymeFamily","Settings","CW.controller.ConceptWikiLookup","Status","BackgroundTasks"],launch:function(){console.log("Application: launch()");Ext.create("LSP.view.Viewport")}});
=======
Ext.define("LDA.helper.LDAConstants",{singleton:true,LDA_BASE_URL:"http://ops2.few.vu.nl",LDA_IN_DATASET:"inDataset",LDA_ABOUT:"_about",LDA_LABEL:"label",LDA_COMPOUND_PHARMACOLOGY_COUNT:"compoundPharmacologyTotalResults",LDA_TARGET_PHARMACOLOGY_COUNT:"targetPharmacologyTotalResults",LDA_ENZYME_FAMILY_COUNT:"enzymePharmacologyTotalResults",LDA_PERMITTED_ACTIVITY_TYPES:["IC50","Activity"],LDA_ON_ASSAY:"onAssay",LDA_EXACT_MATCH:"exactMatch",LDA_PRIMARY_TOPIC:"primaryTopic",LDA_RESULT:"result",LDA_ACTIVITY:"activity",LDA_FOR_MOLECULE:"forMolecule",LDA_ASSAY_TARGET:"target",LDA_ITEMS:"items",LDA_PAGINATED_NEXT:"next",LDA_PAGINATED_PREVIOUS:"prev",LDA_PAGINATED_PAGE_SIZE:"itemsPerPage",LDA_PAGINATED_START_INDEX:"startIndex",LDA_TARGET_OF_ASSAY:"targetOfAssay",LDA_ASSAY_OF_ACTIVITY:"assayOfActivity",LDA_SRC_CLS_MAPPINGS:{"http://www.conceptwiki.org":"conceptWikiValue","http://www.conceptwiki.org/":"conceptWikiValue","http://data.kasabi.com/dataset/chembl-rdf":"chemblValue","http://www4.wiwiss.fu-berlin.de/drugbank":"drugbankValue","http://linkedlifedata.com/resource/drugbank":"drugbankValue","http://www.chemspider.com":"chemspiderValue","http://www.chemspider.com/":"chemspiderValue","http://rdf.chemspider.com":"chemspiderValue","http://rdf.chemspider.com/":"chemspiderValue","http://purl.uniprot.org":"uniprotValue","http://purl.uniprot.org/":"uniprotValue"},LDA_PROVENANCE_OFF:"Off",LDA_PROVENANCE_COLOUR:"Colour",LDA_PROVENANCE_ICON:"Icon",LDA_PROVENANCE_TEXT:"Text",LDAProvenanceMode:"Colour",LDADataItems:{compound_smiles:"smiles",activity_standard_value:"std_value",compound_inchikey:"inchiKey",activity_activity_type:"std_type",activity_standard_units:"std_unit",target_pref_label:"target_name",activity_relation:"relation",compound_inchi:"inchi",compound_full_mwt:"molweight",cw_compound_uri:"compound_cw",compound_pref_label:"compound_name",target_organism:"target_organisms",target_title:"target_names",assay_description:"assay_description",assay_organism:"assay_organism",activity_pubmed_id:"pmid",targets:"target_name",target_organisms:"target_organisms"},LDAUnits:{percentage:"%",microgram_per_milliliter:"μg/ml",nanomolar:"nM",micromolar:"μM"}});Ext.define("CW.config.Settings",{singleton:true,searchByTagUrl:cwBaseUrl+"/search/byTag",getConceptUrl:cwBaseUrl+"/getConceptDescription",base_ops_uri:"http://www.conceptwiki.org/concept/",lang_code:"en"});Ext.define("LSP.model.Unit",{extend:"Ext.data.Model",fields:["unit","name"]});Ext.define("LSP.model.DynamicGrid",{extend:"Ext.data.Model",fields:[]});Ext.define("LSP.view.cmpd_by_name.CmpdByNameSingleDisplayForm",{extend:"Ext.form.Panel",alias:"widget.CmpdByNameSingleDisplayForm",border:false,anchor:"100% 100%",autoScroll:true,bodyPadding:"10px",layout:"anchor",initComponent:function(){this.items=[{xtype:"panel",border:false,layout:"anchor",autoScroll:true,itemId:"displayPanel",bodyPadding:"20px",hidden:true,items:[{xtype:"panel",border:false,anchor:"100%",itemId:"topPanelDetails",layout:"column",items:[{xtype:"panel",itemId:"imageAndFigures",layout:"anchor",border:true,bodyPadding:"8px",items:[{xtype:"image",name:"image",itemId:"compound_form_imagepanel",width:150,height:150,src:"./assets/target_placeholder.png"},{xtype:"displayfield",name:"alogp",itemId:"alogp",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"20px 0 12px 0",fieldLabel:"ALogP",labelAlign:"top",columnWidth:0.1,renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"hba",itemId:"hba",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# H-Bond Acceptors",columnWidth:0.13,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"hbd",itemId:"hbd",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# H-Bond Donors",columnWidth:0.13,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"full_mwt",itemId:"full_mwt",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"Mol Weight",columnWidth:0.1,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"mw_freebase",itemId:"mw_freebase",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"MW Freebase",columnWidth:0.1,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"num_ro5_violations",itemId:"num_ro5_violations",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# Rule of 5 Violations",columnWidth:0.14,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"psa",itemId:"psa",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"Polar Surface Area (Å<sup>2</sup>)",columnWidth:0.12,labelAlign:"top",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"rtb",itemId:"rtb",fieldCls:"x-cmpBottomfieldValue",baseCls:"x-cmpBottomBase",anchor:"100%",padding:"0 0 12px 0",fieldLabel:"# Rotatable Bonds",columnWidth:0.12,labelAlign:"top",renderer:provenanceSummaryRenderer}]},{xtype:"panel",bodyPadding:30,columnWidth:1,border:false,itemId:"dataPanel",layout:"anchor",items:[{xtype:"displayfield",name:"compound_pref_label",itemId:"compound_pref_label",anchor:"100%",fieldCls:"x-cmpTitle",renderer:provenanceSummaryRenderer},{xtype:"displayfield",itemId:"spacer4",renderer:provenanceSummaryRenderer},{xtype:"button",margin:"0 10 0 0",text:"Pharmacology Data",itemId:"pharmCompoundButton",renderer:provenanceSummaryRenderer},{xtype:"button",margin:"0 10 0 0",text:"Structure Search",itemId:"pharmCompoundStructureButton",renderer:provenanceSummaryRenderer},{xtype:"button",margin:"0 0 0 10",text:"View in ChemBioNavigator",itemId:"cbnLinkout",action:"cbn_linkout",hidden:true},{xtype:"button",margin:"0 0 0 10",text:"ChemSpider Info",itemId:"csWindowLaunchButton",chemspiderId:"",action:"openCSWindow",hidden:true},{xtype:"displayfield",value:"<br>",itemId:"spacer1",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"description",itemId:"description",fieldCls:"x-cmpDescriptions",anchor:"90%",maxWidth:600,renderer:provenanceSummaryRenderer},{xtype:"displayfield",itemId:"spacer2"},{xtype:"displayfield",name:"biotransformation",itemId:"biotransformation",fieldCls:"x-cmpDescriptions",anchor:"90%",maxWidth:600,renderer:provenanceSummaryRenderer},{xtype:"displayfield",itemId:"spacer3",value:"<br>"},{xtype:"displayfield",name:"chemspider_id",itemId:"chemspider_id",cls:"x-cmpfield",labelWidth:120,labelAlign:"left",fieldLabel:"ChemSpider ID",anchor:"100%"},{xtype:"displayfield",name:"molform",itemId:"molform",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Molecular Formula",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"compound_smiles",itemId:"compound_smiles",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"SMILES",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"inchi",itemId:"inchi",cls:"x-cmpfield",labelWidth:120,maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Standard InChI",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"inchi_key",itemId:"inchi_key",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Standard InChIKey",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"affectedOrganism",itemId:"affectedOrganism",cls:"x-cmpfield",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Affected Organism",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"indication",itemId:"indication",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Indication",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"proteinBinding",itemId:"proteinBinding",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Protein Binding",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"toxicity",itemId:"toxicity",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Toxicity",renderer:provenanceSummaryRenderer},{xtype:"displayfield",name:"meltingPoint",itemId:"meltingPoint",cls:"x-cmpfield",fieldCls:"x-cmpDescriptions",labelWidth:120,padding:"10px 0 0 0",maxWidth:570,anchor:"80%",labelAlign:"left",fieldLabel:"Melting Point",renderer:provenanceSummaryRenderer}]}]},{xtype:"panel",itemId:"bottomPanelDetails",bodyPadding:30,border:false,height:100,layout:"column",hidden:true,fieldDefaults:{labelAlign:"top",labelWidth:120,anchor:"100%"},items:[]},{xtype:"displayfield",border:0,padding:"20px",itemId:"msg",region:"center",hidden:true,fieldCls:"compound-message",value:"message here"}]}];this.callParent(arguments)},showData:function(l,c,k){if(k){if(c.length>0){var f=l.first();var m=this.query("#displayPanel")[0];m.show();var e=this.query("#dataPanel")[0];e.show();var j=this.query("#topPanelDetails")[0];j.show();var a=this.query("#bottomPanelDetails")[0];a.show();var g=this.query("#compound_form_imagepanel")[0];var d;if(f.data.cs_uri){d=f.data.cs_uri.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];g.setSrc("http://www.chemspider.com/ImagesHandler.ashx?id="+d);g.show()}var b=this.down("#msg");b.hide();this.setValues(f)}else{this.showMessage("No records found within OPS for this search")}}else{this.showMessage("Server did not respond")}this.up("CmpdByNameForm").setLoading(false);var h=Ext.ComponentQuery.query("#CmpdByNameSubmit_id")[0].enable()},resetAllFields:function(){var a=this.query("displayfield");Ext.each(a,function(b){b.hide()},this);this.doLayout()},showSpacerFields:function(){var a=this.down("#spacer1");a.show();a=this.down("#spacer2");a.show();a=this.down("#spacer3");a.show();a=this.down("#spacer4");a.show()},setValues:function(q){this.resetAllFields();this.showSpacerFields();var g=q.data;recordData=q;var o=this.down("#pharmCompoundButton");o.hide();o.setHandler(function(){Ext.History.add("!p=PharmByCmpdNameForm&u="+q.store.proxy.extraParams.uri)});o.show();var c=this.down("#pharmCompoundStructureButton");c.hide();c.setHandler(function(){Ext.History.add("!p=SimSearchForm&sm="+q.data.compound_smiles+"&st=exact")});c.show();for(var a in g){if(g.hasOwnProperty(a)){var d;var p=this.down("#"+a);if(p){switch(a){case"alogp":if(g[a]){var k=new Number(g[a]);k=k.toFixed(1);p.setValue(k);p.show()}break;case"molform":if(g[a]){var f=g[a];f=f.replace(/(\d+)?\s*/g,"<sub>$1</sub>");p.setValue(f);p.show()}break;case"psa":if(g[a]){var l=parseFloat(g[a])*10000000000000000000;p.setValue(l.toFixed(1));p.show()}break;case"meltingPoint":if(g[a]){var n=g[a];n=n.replace(/oC/g,"°C");p.setValue(n);p.show()}break;default:if(g[a]){p.setValue(g[a]);p.show()}}}else{}}}if(q.data.cs_uri){var h=q.data.cs_uri.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];var j=this.query("#chemspider_id")[0];j.setValue('<a href="http://www.chemspider.com/'+h+'"  target="_blank">'+h+"</a>");j.show()}var m=this.query("#compound_form_imagepanel")[0];var e;if(q.data.cs_uri){e=q.data.cs_uri.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];m.setSrc("http://www.chemspider.com/ImagesHandler.ashx?id="+e)}m.show();var b=this.query("#csWindowLaunchButton")[0];b.show();b.chemspiderId=e;this.doLayout()},showMessage:function(b){var f=this.query("#displayPanel")[0];f.show();var g=this.query("#dataPanel")[0];g.hide();var e=this.query("#topPanelDetails")[0];e.hide();var a=this.query("#bottomPanelDetails")[0];a.hide();var d=this.query("#compound_form_imagepanel")[0];d.hide();var c=this.query("#msg")[0];c.setValue(b);c.setVisible(true)},toggleProv:function(a){compound_name_provenance=a;console.log(" Show provenance : "+compound_name_provenance)}});var compound_name_provenance=false;var recordData;function provenanceSummaryRenderer(f,e){var b=new Array();b["http://www.chemspider.com"]="ChemSpider";b["http://data.kasabi.com/dataset/chembl-rdf"]="Chembl";b["http://linkedlifedata.com/resource/drugbank"]="DrugBank";b["http://www.conceptwiki.org"]="ConceptWiki";if(compound_name_provenance){var d=e.name;var j=d+"_item";d+="_src";var a=recordData.data[d];var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!h){h="defaultValue"}var g=h+"Icon";g="/assets/"+g+".png";h+=LDAProvenanceMode;h+="Summary";var c;c="<div>"+f+'   <a href="'+recordData.data[j]+'" target="_blank"><img src="'+g+'" title= "'+b[a]+'" height="15" width="15"/></a></div>';return c}else{return f}}Ext.define("LSP.view.Appmoduletree",{extend:"Ext.tree.Panel",alias:"widget.appmoduletree",requires:["Ext.data.TreeStore"],rootVisible:false,useArrows:true,frame:false,autoScroll:true,height:"100%",store:"NavigationTree",listeners:{itemclick:function(a,b,f,d,g,c){console.log("AppmoduleTree: itemclick()");if(b.raw.application_type=="grid"){Ext.History.add("!p="+b.raw.xtype)}}},initComponent:function(){this.callParent(arguments)}});Ext.define("LSP.view.mol_editor_forms.KetcherForm",{extend:"Ext.window.Window",alias:"widget.KetcherForm",requires:["Ext.form.Panel"],title:"Draw structure",layout:"fit",modal:true,autoShow:true,height:570,width:810,initComponent:function(){this.items=[{xtype:"form",padding:"0 0 0 0",border:false,style:"background-color: #fff;",items:[{xtype:"box",width:800,height:520,id:"ketcher_box_id",autoEl:{tag:"iframe",src:"ketcher/ketcher.html"}}]}];this.buttons=[{text:"Use structure",action:"commit_structure"},{text:"Cancel",scope:this,handler:this.close}];this.callParent(arguments)}});Ext.define("LSP.store.NavigationTree",{extend:"Ext.data.TreeStore",root:{expanded:true,children:[{xtype:"",home:"",leaf:false,text:"Compound",cls:"folder",children:[{xtype:"CmpdByNameForm",home:"Compound by name",leaf:true,text:"Compound by name",cls:"file",application_type:"grid"},{xtype:"SimSearchForm",home:"Compound Structure Search",leaf:true,text:"Compound by structure",cls:"file",application_type:"grid"}]},{xtype:"",home:"",leaf:false,text:"Target",cls:"folder",children:[{xtype:"TargetByNameForm",home:"Target by name",leaf:true,text:"Target by name",cls:"file",application_type:"grid"}]},{xtype:"",leaf:false,text:"Pharmacology",cls:"folder",children:[{xtype:"PharmEnzymeForm",home:"Compounds active against enzyme family",leaf:true,text:"Pharmacology by Enzyme family",cls:"file",application_type:"grid"},{xtype:"PharmByCmpdNameForm",home:"Pharmacology by Compound name",leaf:true,text:"Pharmacology by Compound",cls:"file",application_type:"grid"},{xtype:"PharmByTargetNameForm",home:"Pharmacology by Target Name",leaf:true,text:"Pharmacology by Target",cls:"file",application_type:"grid"}]}]}});Ext.define("LSP.view.Settings",{extend:"Ext.form.Panel",alias:"widget.settingsform",height:"100%",initComponent:function(){this.items=[{xtype:"form",padding:"5 5 0 5",border:false,style:"background-color: #fff;",items:[{xtype:"label",text:"To use a different endpoint than the default Amsterdam VU one insert URL of sparql endpoint below and click save"},{xtype:"textarea",name:"endpoint",heigth:50,fieldLabel:"URL",emptyText:"Insert full URL to the sparql endpoint used, eg: http://10.11.93.218:8183/sparql",labelWidth:30},{name:"utf8",xtype:"hidden",value:"&#x2713;"},{name:"authenticity_token",xtype:"hidden",value:$$("meta[name=csrf-token]")[0].readAttribute("content")},{xtype:"button",text:"Save",action:"save_endpoint"}]}];this.callParent(arguments)}});Ext.define("CW.helper.ConceptWikiJSONReader",{extend:"Ext.data.reader.Json",readRecords:function(f){var c=[];var j=0;var g=f.result["primaryTopic"]["result"];var a,l,k,b,d,h,e;d=[];Ext.each(g,function(m,o){a=m._about.split("/").pop();l=m.match;k=m.prefLabel;e="";Ext.each(m.exactMatch,function(p,q){if(p.matchType=="PREFERRED"){e=p.url;return false}});Ext.each(m.altLabel_en,function(p,q){d.push(p)});var n=Ext.create("CW.model.ConceptWikiLookup",{match:l.replace(/\<\/em\>/g,"</b>").replace(/\<em\>/g,"<b>"),uuid:a,ops_uri:CW.config.Settings.base_ops_uri+a,pref_label:k,alt_labels:d.join("; "),pref_url:e});c.push(n);j++});return new Ext.data.ResultSet({total:j,count:j,records:c,success:true,message:"loaded"})}});Ext.define("LSP.controller.CmpdByNameForm",{extend:"Ext.app.Controller",views:["cmpd_by_name.CmpdByNameSingleDisplayForm"],refs:[{ref:"cmpdByNameSingleDisplayForm",selector:"CmpdByNameSingleDisplayForm"},{ref:"compoundImagePanel",selector:"CmpdByNameSingleDisplayForm #compound_form_imagepanel"},{ref:"formView",selector:"CmpdByNameForm"},{ref:"submitButton",selector:"#CmpdByNameSubmit_id"},{ref:"lookup",selector:"CmpdByNameForm #compoundByNameLookup"}],current_uri:null,init:function(){this.control({"CmpdByNameForm button[action=query_cmpd_by_name]":{click:this.submitQuery},"CmpdByNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},CmpdByNameForm:{historyToken:this.handleHistoryToken},"CmpdByNameForm button[action = cbn_linkout]":{click:this.firecbnLink},"CmpdByNameForm button[action=openCSWindow]":{click:this.openChemSpiderWidget},"CmpdByNameForm #provId":{change:this.onProvChange}});this.compoundWnd=Ext.create("CS.view.CompoundWindow")},firecbnLink:function(){window.open("http://cbn.zbh.uni-hamburg.de/?ops_uris="+this.current_uri,"_blank")},openChemSpiderWidget:function(a){if(parseInt(a.chemspiderId)>=1){this.compoundWnd.showCompound(a.chemspiderId)}},handleHistoryToken:function(b){console.log("CmpdByNameForm: handleHistoryToken()");var c=this;var e=c.getFormView().down("CmpdByNameSingleDisplayForm");if(b.u){var a=this.getStore("LDA.store.CompoundStore");if(b.u!=a.proxy.extraParams.uri){var g=this.getController("CW.controller.ConceptWikiLookup");var f=this.getFormView().down("conceptWikiLookup");g.setConcept(b.u,f,a);a.proxy.extraParams.uri=b.u;c.current_uri=b.u;c.getFormView().setLoading(true);a.load(function(j,h,k){console.log("LSP.controller.CmpdByNameForm: store is loaded "+k);if(k){c.getSubmitButton().enable();e.setValues(j[0]);e.recordData=j[0];e.down("#displayPanel").setVisible(true);e.down("#msg").setVisible(false);c.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});c.getSubmitButton().enable();e.down("#displayPanel").setVisible(false);e.down("#msg").setVisible(true);c.getFormView().setLoading(false)}})}}else{if(b.s){var d=this.getLookup();d.setRawValue(b.s);d.doQuery(b.s)}}},enableSubmit:function(c){var b=this.getFormView();var a=this.getSubmitButton();a.enable()},submitQuery:function(c){c.disable();var e=this;var d=this.getFormView();var b=d.getValues().compound_uri;if(this.current_uri==b){var f=e.getFormView().down("CmpdByNameSingleDisplayForm");var a=this.getStore("LDA.store.CompoundStore");a.proxy.extraParams.uri=this.current_uri;e.getFormView().setLoading(true);a.load(function(h,g,j){console.log("LSP.controller.CmpdByNameForm: store is loaded "+j);if(j){e.getSubmitButton().enable();f.setValues(h[0]);f.recordData=h[0];f.down("#displayPanel").setVisible(true);f.down("#msg").setVisible(false);e.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});e.getSubmitButton().enable();f.down("#displayPanel").setVisible(false);f.down("#msg").setVisible(true);e.getFormView().setLoading(false)}})}else{Ext.History.add("!p=CmpdByNameForm&u="+b)}},onProvChange:function(d,b,a){var c=this.getCmpdByNameSingleDisplayForm();c.toggleProv(b.prov);c.setValues(c.recordData)}});Ext.define("LSP.controller.Settings",{extend:"Ext.app.Controller",views:["Settings"],init:function(){this.control({"settingsform button[action=save_endpoint]":{click:this.saveEndpoint}})},saveEndpoint:function(b){var c=b.up("form");var a=c.getValues();c.submit({url:"/sparql_endpoint/settings.json",waitMsg:"Saving end point...",success:function(d,e){Ext.Msg.alert("Success","Endpoint stored")}})}});Ext.define("LSP.view.api_status.Status",{extend:"Ext.form.Panel",alias:"widget.Status",closable:true,header:false,layout:"fit",border:false,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},items:[{xtype:"label",text:"Linked Data API",margin:"0 0 0 10"},{xtype:"image",name:"lda_image",itemId:"status_form_lda_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"label",text:"Concept Wiki",margin:"0 0 0 10"},{xtype:"image",name:"cw_image",itemId:"status_form_cw_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"label",text:"Chemspider",margin:"0 0 0 10"},{xtype:"image",name:"cs_image",itemId:"status_form_cs_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"label",text:"IMS",margin:"0 0 0 10"},{xtype:"image",name:"ims_image",itemId:"status_form_ims_image",width:15,height:15,hidden:false,src:"./assets/question_mark.png"}]}]});Ext.define("CW.model.ConceptWikiLookup",{extend:"Ext.data.Model",fields:[{name:"match",mapping:"match",type:"string"},{name:"uuid",mapping:"uuid",type:"string"},{name:"ops_uri",mapping:"ops_uri",type:"string"},{name:"pref_label",mapping:"pref_labels",type:"string"},{name:"alt_labels",mapping:"alt_labels",type:"string"},{name:"uuid",mapping:"uuid",type:"string"},{name:"concept_type_tags",mapping:"uuid_tags",type:"string"},{name:"pref_url",mapping:"pref_url",type:"string"}],getSomething:function(){if(this.something==null){this.parseSomething()}return this.something},parseSomething:function(){this.something=new Array();for(var b=0;b<this.data.something.length;b++){var a=this.data.tags[b];if(a.length==1){this.something.push(a)}}}});Ext.define("LDA.model.SimModel",{extend:"Ext.data.Model",fields:["cw_uri","cs_uri","chembl_uri","drugbank_uri","inchi","inchi_src","inchi_key","inchi_key_src","smiles","smiles_src","alogp","alogp_src","full_mwt","full_mwt_src","hba","hba_src","hbd","hbd_src","molform","molform_src","mw_freebase","mw_freebase_src","psa","psa_src","rtb","rtb_src","biotransformation","biotransformation_src","description","description_src","proteinBinding","proteinBinding_src","toxicity","toxicity_src","prefLabel","prefLabel_src"]});Ext.define("LDA.store.SimSearchLocalStore",{extend:"Ext.data.Store",model:"LDA.model.SimModel",storeId:"simSearchLocalStore",typeName:undefined,proxy:{type:"memory",reader:{type:"json"}},setTypeName:function(a){this.typeName=a},getTypeName:function(){return this.typeName}});Ext.define("LSP.controller.Status",{extend:"Ext.app.Controller",views:["api_status.Status"],refs:[{ref:"CWImage",selector:"#status_form_cw_image"},{ref:"LDAImage",selector:"#status_form_lda_image"},{ref:"CSImage",selector:"#status_form_cs_image"},{ref:"IMSImage",selector:"#status_form_ims_image"}],init:function(){var c=this;var a=function(){c.testConceptWiki();c.testLDA();c.testChemspider();c.testIMS()};var b=Ext.TaskManager.start({run:a,interval:600000})},testIMS:function(){var a=this;var b=Ext.create("LDA.store.IMSStore",{});b.load(function(d,c,e){if(d[0].data.status=="true"){console.log("IMS fetch success "+d[0]);a.getIMSImage().setSrc("./assets/tick.png");a.getIMSImage().setVisible(true)}else{console.log("IMS fetch boom");a.getIMSImage().setSrc("./assets/cancel.png");a.getIMSImage().setVisible(true)}})},testChemspider:function(){var b=this;var a=Ext.create("CS.engine.search.Structure",{listeners:{finished:function(e,d){if(d.length==0){console.log("CS fetch boom");b.getCSImage().setSrc("./assets/cancel.png");b.getCSImage().setVisible(true)}else{console.log("CS fetch success "+d[0]);b.getCSImage().setSrc("./assets/tick.png");b.getCSImage().setVisible(true)}},failed:function(e,d){console.log("CS fetch boom");b.getCSImage().setSrc("./assets/cancel.png");b.getCSImage().setVisible(true)}}});var c={};c["searchOptions.Molecule"]="CC(=O)Oc1ccccc1C(=O)O";a.doSearch("exact",c)},testLDA:function(){var b="http://www.conceptwiki.org/concept/dd758846-1dac-4f0d-a329-06af9a7fa413";var c=Ext.create("LDA.store.CompoundStore",{});var a=this;c.proxy.extraParams.uri=b;c.proxy.reader.uri=b;c.load({callback:function(e,d,f){if(f){console.log("Compound Store Success",e[0]);a.getLDAImage().setSrc("./assets/tick.png");a.getLDAImage().setVisible(true)}else{console.log("LDA boom");a.getLDAImage().setSrc("./assets/cancel.png");a.getLDAImage().setVisible(true)}}},this)},testConceptWiki:function(){var b="07a84994-e464-4bbf-812a-a4b96fa3d197";var a=Ext.create("CW.store.ConceptWikiLookup",{});a.proxy.noCache=false;a.proxy.pageParam="";a.proxy.startParam="";a.proxy.setExtraParam("uuid",b);a.proxy.setExtraParam("limit",1);a.proxy.callbackKey="_callback";var c=this;a.load({params:{q:"aspi",branch:"4",app_key:app_key,app_id:app_id,_format:"json"},callback:function(e,d,f){if(f){console.log("Success",e[0]);c.getCWImage().setSrc("./assets/tick.png");c.getCWImage().setVisible(true)}else{console.log("CW boom");c.getCWImage().setSrc("./assets/cancel.png");c.getCWImage().setVisible(true)}}},this)},csFetch:function(c){var d=this;var a=Ext.create("LDA.store.CompoundStore",{});a.proxy.reader=Ext.create("LDA.helper.ChemspiderCompoundReader");for(var b=0;b<c.length;b++){a.proxy.extraParams.uri="http://rdf.chemspider.com/"+c[b];a.load(function(f,e,g){if(g){console.log("CS fetch success "+f[0]);d.getCSImage().setSrc("./assets/tick.png");d.getCSImage().setVisible(true)}else{console.log("CS fetch boom");d.getCSImage().setSrc("./assets/cancel.png");d.getCSImage().setVisible(true)}})}}});Ext.define("CW.store.ConceptWikiLookup",{extend:"Ext.data.Store",requires:["CW.model.ConceptWikiLookup","CW.config.Settings"],queryValue:undefined,comboBox:undefined,model:"CW.model.ConceptWikiLookup",proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader")},constructor:function(){console.log("CW.store.ConceptWikiLookup: constructor()");this.callParent(arguments)},listeners:{load:function(){var a=this;Ext.each(this.data.items,function(c,b){if(c.data.pref_label==this.store.queryValue){a.getComboBox().setValue(c);a.getComboBox().fireEvent("matchingconcept")}})}},setQueryValue:function(a){this.queryValue=a},getQueryValue:function(){return this.queryValue},setComboBox:function(a){this.comboBox=a},getComboBox:function(){return this.comboBox}});Ext.define("CW.view.ConceptWikiLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiLookup",requires:["CW.model.ConceptWikiLookup","CW.helper.ConceptWikiJSONReader","CW.store.ConceptWikiLookup"],cwTagUuid:"pleaseConfigure[cwConceptTagUuid:]",store:undefined,forceSelection:true,allowBlank:false,typeAhead:true,typeAheadDelay:250,queryDelay:250,queryCaching:false,queryParam:"q",queryMode:"remote",valueField:"ops_uri",displayField:"pref_label",name:"ops_uri",minChars:4,hideTrigger:true,forceSelection:true,allowBlank:false,typeAhead:false,emptyText:"Start typing...",margin:"5 5 5 5",width:700,fieldLabel:"Overwrite this in config",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"Nothing found which matches your text, you may need to enter more text or try something different.",getInnerTpl:function(){return'<p><span style="font-family: verdana; color: grey; "><small>Match: {match}</small></span><br/><b>{pref_label}</b> <a href="http://ops.conceptwiki.org/wiki/#/concept/{uuid}/view" target="_blank">(definition)</a></p>'}},autoSelect:false,listeners:{beforequery:function(){this.store.setQueryValue(this.rawValue);this.store.setComboBox(this)}},initComponent:function(){this.addEvents("matchingconcept");this.callParent(arguments)}});Ext.define("CW.controller.ConceptWikiLookup",{extend:"Ext.app.Controller",models:["CW.model.ConceptWikiLookup"],views:["CW.view.ConceptWikiLookup"],stores:["CW.store.ConceptWikiLookup"],init:function(){this.control({conceptWikiLookup:{afterrender:this.prepProxy}})},prepProxy:function(a){a.store.proxy.setExtraParam("uuid",a.cwTagUuid)},setConcept:function(d,a,c){console.log("CW.controller.ConceptWikiLookup: setConcept()");var e=d.match(/http:\/\/www.conceptwiki.org\/concept\/([a-f0-9\-]+)/)[1];var b=Ext.create("Ext.data.Store",{model:"CW.model.ConceptWikiLookup",proxy:{type:"jsonp",url:CW.config.Settings.getConceptUrl,reader:Ext.create("CW.helper.ConceptWikiJSONGetReader"),noCache:false,limitParam:undefined,startParam:undefined,pageParam:undefined,callbackKey:"_callback",extraParams:{_format:"json",app_id:app_id,app_key:app_key}}});b.load({params:{uuid:e},callback:function(g,f,h){if(h){a.setValue(g[0]);c.setTypeName(g[0].data.pref_label)}else{}}},this)}});Ext.define("LSP.view.background_tasks.BackgroundTasksForm",{extend:"Ext.form.Panel",alias:"widget.BackgroundTasksForm",itemId:"tasks_container",closable:true,header:false,layout:"fit",border:false,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.addEvents("taskadded");this.callParent(arguments)},items:[]});Ext.define("LDA.helper.FilterUnitsReader",{extend:"Ext.data.reader.Json",requires:["LDA.helper.LDAConstants"],readRecords:function(d){var e=d.result["primaryTopic"];var c=e[LDA.helper.LDAConstants.LDA_LABEL];var b=e.unit;var a=new Array();Ext.each(b,function(k,h){var j=k[LDA.helper.LDAConstants.LDA_ABOUT];var g=k[LDA.helper.LDAConstants.LDA_LABEL];var f=Ext.create("LDA.model.FilterUnitsModel",{activity_type:c,unit:g,about:j});a.push(f)});return new Ext.data.ResultSet({total:a.length,count:a.length,records:a,success:true,message:"loaded"})}});Ext.define("LDA.model.FilterUnitsModel",{extend:"Ext.data.Model",fields:["activity_type","unit","about"]});Ext.define("Ext.ux.grid.FiltersFeature",{extend:"Ext.grid.feature.Feature",alias:"feature.filters",uses:["Ext.ux.grid.menu.ListMenu","Ext.ux.grid.menu.RangeMenu","Ext.ux.grid.filter.BooleanFilter","Ext.ux.grid.filter.DateFilter","Ext.ux.grid.filter.ListFilter","Ext.ux.grid.filter.NumericFilter","Ext.ux.grid.filter.StringFilter"],autoReload:true,filterCls:"ux-filtered-column",local:false,menuFilterText:"Filters",paramPrefix:"filter",showMenu:true,stateId:undefined,updateBuffer:500,hasFeatureEvent:false,constructor:function(a){var b=this;a=a||{};Ext.apply(b,a);b.deferredUpdate=Ext.create("Ext.util.DelayedTask",b.reload,b);b.filters=b.createFiltersCollection();b.filterConfigs=a.filters},attachEvents:function(){var c=this,a=c.view,d=a.headerCt,b=c.getGridPanel();c.bindStore(a.getStore(),true);d.on("menucreate",c.onMenuCreate,c);a.on("refresh",c.onRefresh,c);b.on({scope:c,beforestaterestore:c.applyState,beforestatesave:c.saveState,beforedestroy:c.destroy});b.filters=c;b.addEvents("filterupdate")},createFiltersCollection:function(){return Ext.create("Ext.util.MixedCollection",false,function(a){return a?a.dataIndex:null})},createFilters:function(){var h=this,g=h.filters.getCount(),a=h.getGridPanel(),d=h.createFiltersCollection(),e=a.store.model,f=e.prototype.fields,j,c,b;if(g){b={};h.saveState(null,b)}function k(m,l,n){if(m&&(n||l)){j=f.get(m);c={dataIndex:m,type:(j&&j.type&&j.type.type)||"auto"};if(Ext.isObject(l)){Ext.apply(c,l)}d.replace(c)}}Ext.Array.each(h.filterConfigs,function(l){k(l.dataIndex,l)});Ext.Array.each(a.columns,function(l){if(l.filterable===false){d.removeAtKey(l.dataIndex)}else{k(l.dataIndex,l.filter,l.filterable)}});h.removeAll();if(d.items){h.initializeFilters(d.items)}if(g){h.applyState(null,b)}},initializeFilters:function(e){var d=this,f=e.length,b,c,a;for(b=0;b<f;b++){c=e[b];if(c){a=d.getFilterClass(c.type);c=c.menu?c:new a(c);d.filters.add(c);Ext.util.Observable.capture(c,this.onStateChange,this)}}},onMenuCreate:function(c,b){var a=this;a.createFilters();b.on("beforeshow",a.onMenuBeforeShow,a)},onMenuBeforeShow:function(d){var c=this,b,a;if(c.showMenu){b=c.menuItem;if(!b||b.isDestroyed){c.createMenuItem(d);b=c.menuItem}a=c.getMenuFilter();if(a){b.setMenu(a.menu,false);b.setChecked(a.active);b.setDisabled(a.disabled===true)}b.setVisible(!!a);this.sep.setVisible(!!a)}},createMenuItem:function(b){var a=this;a.sep=b.add("-");a.menuItem=b.add({checked:false,itemId:"filters",text:a.menuFilterText,listeners:{scope:a,checkchange:a.onCheckChange,beforecheckchange:a.onBeforeCheck}})},getGridPanel:function(){return this.view.up("gridpanel")},applyState:function(b,e){var d=this,a,c;d.applyingState=true;d.clearFilters();if(e.filters){for(a in e.filters){if(e.filters.hasOwnProperty(a)){c=d.filters.get(a);if(c){c.setValue(e.filters[a]);c.setActive(true)}}}}d.deferredUpdate.cancel();if(d.local){d.reload()}delete d.applyingState;delete e.filters},saveState:function(a,c){var b={};this.filters.each(function(d){if(d.active){b[d.dataIndex]=d.getValue()}});return(c.filters=b)},destroy:function(){var a=this;Ext.destroyMembers(a,"menuItem","sep");a.removeAll();a.clearListeners()},removeAll:function(){if(this.filters){Ext.destroy.apply(Ext,this.filters.items);this.filters.clear()}},bindStore:function(a){var b=this;if(b.store&&b.storeListeners){b.store.un(b.storeListeners)}if(a){b.storeListeners={scope:b};if(b.local){b.storeListeners.load=b.onLoad}else{b.storeListeners["before"+(a.buffered?"prefetch":"load")]=b.onBeforeLoad}a.on(b.storeListeners)}else{delete b.storeListeners}b.store=a},getMenuFilter:function(){var a=this.view.headerCt.getMenu().activeHeader;return a?this.filters.get(a.dataIndex):null},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return !b||this.getMenuFilter().isActivatable()},onStateChange:function(d,b){if(d!=="serialize"){var c=this,a=c.getGridPanel();if(b==c.getMenuFilter()){c.menuItem.setChecked(b.active,false)}if((c.autoReload||c.local)&&!c.applyingState){c.deferredUpdate.delay(c.updateBuffer)}c.updateColumnHeadings();if(!c.applyingState){a.saveState()}a.fireEvent("filterupdate",c,b)}},onBeforeLoad:function(a,b){b.params=b.params||{};this.cleanParams(b.params);var c=this.buildQuery(this.getFilterData());Ext.apply(b.params,c)},onLoad:function(a){a.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var a=this,b=a.view.headerCt;if(b){b.items.each(function(d){var c=a.getFilter(d.dataIndex);d[c&&c.active?"addCls":"removeCls"](a.filterCls)})}},reload:function(){var b=this,a=b.view.getStore();if(b.local){a.clearFilter(true);a.filterBy(b.getRecordFilter());a.sort()}else{b.deferredUpdate.cancel();if(a.buffered){a.pageMap.clear()}a.loadPage(1)}},getRecordFilter:function(){var c=[],a,b;this.filters.each(function(d){if(d.active){c.push(d)}});a=c.length;return function(d){for(b=0;b<a;b++){if(!c[b].validateRecord(d)){return false}}return true}},addFilter:function(a){var f=this,c=f.getGridPanel().columns,b,h,e,g,d;for(b=0,h=c.length;b<h;b++){e=c[b];if(e.dataIndex===a.dataIndex){e.filter=a}}if(f.view.headerCt.menu){f.createFilters()}else{f.view.headerCt.getMenu()}for(b=0,g=f.filters.items.length;b<g;b++){d=f.filters.items[b];if(d.dataIndex===a.dataIndex){return d}}},addFilters:function(c){if(c){var b=this,a,d;for(a=0,d=c.length;a<d;a++){b.addFilter(c[a])}}},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(false)})},getFilterData:function(){var c=[],b,a;this.filters.each(function(e){if(e.active){var g=[].concat(e.serialize());for(b=0,a=g.length;b<a;b++){c.push({field:e.dataIndex,data:g[b]})}}});return c},buildQuery:function(b){var a={},c,h,j,e,k,d,g=b.length;if(!this.encode){for(c=0;c<g;c++){h=b[c];j=[this.paramPrefix,"[",c,"]"].join("");a[j+"[field]"]=h.field;e=j+"[data]";for(k in h.data){a[[e,"[",k,"]"].join("")]=h.data[k]}}}else{d=[];for(c=0;c<g;c++){h=b[c];d.push(Ext.apply({},{field:h.field},h.data))}if(d.length>0){a[this.paramPrefix]=Ext.JSON.encode(d)}}return a},cleanParams:function(c){if(this.encode){delete c[this.paramPrefix]}else{var b,a;b=new RegExp("^"+this.paramPrefix+"[[0-9]+]");for(a in c){if(b.test(a)){delete c[a]}}}},getFilterClass:function(a){switch(a){case"auto":a="string";break;case"int":case"float":a="numeric";break;case"bool":a="boolean";break}return Ext.ClassManager.getByAlias("gridfilter."+a)}});Ext.getHead().insertHtml("beforeEnd",'<style type="text/css">.x-selectable, .x-selectable * {    -khtml-user-select: text !important;    -moz-user-select: text !important;}</style>');Ext.require("Ext.view.Table",function(){Ext.override(Ext.view.Table,{afterrender:function(){var a=this;a.callParent();a.mon(a.el,{scroll:a.fireBodyScroll,scope:a});if(a.getFeature("selectable")===undefined){a.el.unselectable()}a.attachEventsForFeatures()}})});Ext.require("Ext.grid.feature.Feature",function(){Ext.define("LSP.view.dynamicgrid.feature.selectable",{extend:"Ext.grid.feature.Feature",alias:"feature.selectable",mutateMetaRowTpl:function(b){var a,c=b.length;for(a=0;a<c;a++){tpl=b[a];tpl=tpl.replace(/x-grid-row/,"x-grid-row x-selectable");tpl=tpl.replace(/x-grid-cell-inner x-unselectable/g,"x-grid-cell-inner");tpl=tpl.replace(/unselectable="on"/g,"");b[a]=tpl}}})});Ext.define("LSP.view.ux.download.FileDownload",{extend:"Ext.Component",alias:"widget.FileDownload",autoEl:{tag:"iframe",cls:"x-hidden",src:Ext.SSL_SECURE_URL},stateful:true,load:function(a){var b=this.getEl();b.dom.src=a.url+(a.params?"?"+Ext.urlEncode(a.params):"");b.dom.onload=function(){if(b.dom.contentDocument.body.childNodes[0].wholeText=="404"){Ext.Msg.show({title:"Attachment missing",msg:"The document you are after can not be found on the server.",buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}}}});Ext.define("LSP.view.dropdowns.conceptWikiProteinLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiProteinLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"concept_label"},{type:"string",name:"concept_url"},{type:"string",name:"define_url"},{type:"string",name:"concept_uuid"},{type:"string",name:"concept_alt_labels"},{type:"string",name:"tag_label"},{type:"string",name:"tag_uuid"},{type:"string",name:"match"}],proxy:{type:"ajax",api:{read:"/concept_wiki_api_calls/protein_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"concept_url",displayField:"concept_label",name:"protein_uri",minChars:4,hideTrigger:true,forceSelection:true,allowBlank:false,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,fieldLabel:"Protein name",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching proteins found.",getInnerTpl:function(){return'<p><span style="font-family: verdana; color: grey; "><small>Match: {match}</small></span><br/><b>{concept_label}</b> <a href="{define_url}" target="_blank">(definition)</a></p>'}}});Ext.define("Ext.ux.DataView.Animated",{defaults:{duration:750,idProperty:"id"},constructor:function(a){Ext.apply(this,a||{},this.defaults)},init:function(a){this.dataview=a;var c=this.idProperty,b=a.store;a.blockRefresh=true;a.updateIndexes=Ext.Function.createSequence(a.updateIndexes,function(){this.getTargetEl().select(this.itemSelector).each(function(f,g,e){f.id=f.dom.id=Ext.util.Format.format("{0}-{1}",a.id,b.getAt(e).internalId)},this)},a);this.dataviewID=a.id;this.cachedStoreData={};this.cacheStoreData(b.data||b.snapshot);a.on("resize",function(){var e=a.store;if(e.getCount()>0){}},this);a.store.on("datachanged",d,this);function d(o){var m=a.getTargetEl(),h=o.getAt(0),q=this.getAdded(o),y=this.getRemoved(o),j=this.getRemaining(o),v=Ext.apply({},j,q);Ext.each(y,function(D){var E=this.dataviewID+"-"+D.internalId;Ext.fly(E).animate({remove:false,duration:e,opacity:0,useDisplay:true,callback:function(){Ext.fly(E).setDisplayed(false)}})},this);if(h==undefined){this.cacheStoreData(o);return}this.cacheStoreData(o);var g=Ext.get(this.dataviewID+"-"+h.internalId);if(!g){a.refresh();return true}var A=o.getCount(),l=g.getMargin("lr")+g.getWidth(),w=g.getMargin("bt")+g.getHeight(),s=m.getWidth(),f=Math.floor(s/l),r=Math.ceil(A/f),B=Math.ceil(this.getExistingCount()/f);var k={},C={},t={};Ext.iterate(j,function(F,E){var F=E.internalId,D=t[F]=Ext.get(this.dataviewID+"-"+F);k[F]={top:D.getTop()-m.getTop()-D.getMargin("t")-m.getPadding("t"),left:D.getLeft()-m.getLeft()-D.getMargin("l")-m.getPadding("l")}},this);m.applyStyles({display:"block",position:"relative"});Ext.iterate(j,function(G,F){var D=k[G],E=t[G];if(E.getStyle("position")!="absolute"){t[G].applyStyles({position:"absolute",left:D.left+"px",top:D.top+"px"})}});var p=0;Ext.iterate(o.data.items,function(F){var J=F.internalId,E=t[J];var D=p%f,I=Math.floor(p/f),H=I*w,G=D*l;C[J]={top:H,left:G};p++},this);var u=new Date(),e=this.duration,n=this.dataviewID;var z=function(){var M=new Date()-u,O=M/e,D;if(O>=1){for(D in C){Ext.fly(n+"-"+D).applyStyles({top:C[D].top+"px",left:C[D].left+"px"})}Ext.TaskManager.stop(x)}else{for(D in C){if(!j[D]){continue}var G=k[D],J=C[D],H=G.top,K=J.top,F=G.left,L=J.left,I=O*Math.abs(H-K),N=O*Math.abs(F-L),P=H>K?H-I:H+I,E=F>L?F-N:F+N;Ext.fly(n+"-"+D).applyStyles({top:P+"px",left:E+"px"}).setDisplayed(true)}}};var x={run:z,interval:20,scope:this};Ext.TaskManager.start(x);Ext.iterate(q,function(E,D){Ext.fly(this.dataviewID+"-"+D.internalId).applyStyles({top:C[D.internalId].top+"px",left:C[D.internalId].left+"px"}).setDisplayed(true);Ext.fly(this.dataviewID+"-"+D.internalId).animate({remove:false,duration:e,opacity:1})},this);this.cacheStoreData(o)}},cacheStoreData:function(a){this.cachedStoreData={};a.each(function(b){this.cachedStoreData[b.internalId]=b},this)},getExisting:function(){return this.cachedStoreData},getExistingCount:function(){var c=0,b=this.getExisting();for(var a in b){c++}return c},getAdded:function(a){var b={};a.each(function(c){if(this.cachedStoreData[c.internalId]==undefined){b[c.internalId]=c}},this);return b},getRemoved:function(a){var b=[],c;for(c in this.cachedStoreData){if(a.findBy(function(d){return d.internalId==c})==-1){b.push(this.cachedStoreData[c])}}return b},getRemaining:function(a){var b={};a.each(function(c){if(this.cachedStoreData[c.internalId]!=undefined){b[c.internalId]=c}},this);return b}});Ext.define("LSP.view.target_by_name.TargetPanel",{extend:"Ext.panel.Panel",alias:"widget.TargetPanel",border:false,anchor:"100% 100%",autoScroll:true,bodyPadding:"10px",layout:"anchor",initComponent:function(){this.items=[{xtype:"panel",border:0,layout:"anchor",autoScroll:true,itemId:"dp",bodyPadding:"20px",cls:"target-data-panel",hidden:true,items:[{xtype:"panel",border:0,anchor:"100%",itemId:"topPanel",layout:"column",autoScroll:true,items:[{xtype:"image",itemId:"target_image",width:150,height:150,src:"./assets/target_placeholder.png"},{xtype:"panel",bodyPadding:30,columnWidth:1,border:0,autoScroll:true,itemId:"textDataPanel",layout:"anchor",items:[{xtype:"displayfield",anchor:"100%",itemId:"prefLabel",renderer:provenanceTargetSummaryRenderer,fieldCls:"target-title"},{xtype:"button",text:"Pharmacology Data",margin:"15 0 20 0",itemId:"pharmTargetButton",cls:"target-pharm-button"},{xtype:"displayfield",anchor:"100%",itemId:"target_type",fieldLabel:"Target Type",renderer:provenanceTargetSummaryRenderer,cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",itemId:"organism",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Organism",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",itemId:"description",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Description",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"synonyms",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Synonyms",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"specific_function",fieldLabel:"Specific Function",renderer:provenanceTargetSummaryRenderer,cls:"target-descriptions"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",itemId:"cellular_function",renderer:provenanceTargetSummaryRenderer,fieldLabel:"Cellular Function",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"keywords",fieldLabel:"Keywords",renderer:provenanceTargetSummaryRenderer,cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"pdb_id_page",renderer:provenanceTargetSummaryRenderer,fieldLabel:"PDB Entry",cls:"target-field-label"},{xtype:"displayfield",anchor:"100%",padding:"10px 0 0 0",maxWidth:600,itemId:"cellular_location",fieldLabel:"Cellular Location",renderer:provenanceTargetSummaryRenderer,cls:"target-field-label"},{xtype:"panel",border:0,anchor:"100%",itemId:"numericDataPanel",layout:"column",bodyPadding:30,items:[{xtype:"displayfield",itemId:"molecular_weight",columnWidth:0.33,fieldLabel:"Molecular Weight",renderer:provenanceTargetSummaryRenderer,cls:"target-field-bottom",fieldCls:"target-field-bottom-field",labelAlign:"top"},{xtype:"displayfield",itemId:"number_of_residues",columnWidth:0.33,fieldLabel:"Number of Residues",renderer:provenanceTargetSummaryRenderer,cls:"target-field-bottom",fieldCls:"target-field-bottom-field",labelAlign:"top"},{xtype:"displayfield",itemId:"theoretical_pi",columnWidth:0.33,fieldLabel:"Theoretical Pi",renderer:provenanceTargetSummaryRenderer,cls:"target-field-bottom",fieldCls:"target-field-bottom-field",labelAlign:"top"},]}]}]}]},{xtype:"displayfield",border:0,padding:"20px",itemId:"msg",region:"center",hidden:true,fieldCls:"target-message",value:"message here"}];this.callParent(arguments)},resetAllFields:function(){var b=this.query("displayfield");Ext.each(b,function(c){c.hide()},this);var a=this.down("#target_image");a.setSrc("./assets/target_placeholder.png");this.doLayout()},showMessage:function(a){var c=this.down("#dp");var b=this.down("#msg");c.setVisible(false);b.setValue(a);b.setVisible(true)},showData:function(c,b,g){console.log("LSP.view.target_by_name.TargetPanel: showData()");if(g){var f=c.first().data;if(b.length>0&&f.hasOwnProperty("prefLabel")){var e=this.down("#dp");var d=this.down("#msg");d.setVisible(false);this.setValues(c.first());e.setVisible(true)}else{this.showMessage("No records found within OPS for this search")}}else{this.showMessage("Server did not respond")}this.up("TargetByNameForm").setLoading(false);var a=Ext.ComponentQuery.query("#TargetByNameSubmit_id")[0].enable()},clearDomBelow:function(a){if(a.hasChildNodes()){while(a.childNodes.length>0){a.removeChild(a.firstChild)}}},addKeywords:function(d){var g=d.split(",");var e=this.down("#keywords");var j=e.bodyEl;var c=j.dom;this.clearDomBelow(c);var b;if(target_name_provenance){var a=recordData.data.keywords_src;var k=recordData.data.keywords_item;var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];h+="Icon";h="/assets/"+h+".png";b='{kw} <a href="'+k+'"><img src="'+h+'" title='+a+' height="15" width="15"/></a>'}else{b="{kw}"}var f=Ext.DomHelper.createTemplate({tag:"div",cls:"keyword",html:b});Ext.each(g,function(l){f.append(j,{kw:l.trim()})},this);e.show()},addOrganism:function(d){var f=this.down("#organism");var g=f.bodyEl;var c=g.dom;this.clearDomBelow(c);var b;if(target_name_provenance){var j=recordData.data.organism_item;var a=recordData.data.organism_src;var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];h+="Icon";h="/assets/"+h+".png";b='{org} <a href="'+j+'" target="_blank"><img src="'+h+'" title='+a+' height="15" width="15"/></a>'}else{b="{org}"}var e=Ext.DomHelper.createTemplate({tag:"div",cls:"organism",html:"output"});e.append(g,{org:d});f.show()},addSynonyms:function(f){var g=f.split(" , ");var e=this.down("#synonyms");var j=e.bodyEl;var c=j.dom;this.clearDomBelow(c);var b;if(target_name_provenance){var a=recordData.data.synonyms_src;var k=recordData.data.synonyms_item;var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];h+="Icon";h="/assets/"+h+".png";b='{syn} <a href="'+k+'" target="_blank"><img src="'+h+'" title='+a+' height="15" width="15"/></a>'}else{b="{syn}"}var d=Ext.DomHelper.createTemplate({tag:"div",cls:"synonym",html:b});Ext.each(g,function(l){d.append(j,{syn:l})},this);e.show()},addPDBImage:function(c){var g=new String(c);var e=new String();var b,f;g=g.split(",");Ext.each(g,function(j,h){b=j.split("/").pop();if(h==0){f=b}e+="<a target='_blank' href='"+j+"'>"+b+"</a>   "},this);var a=this.down("#target_image");var d=this.down("#pdb_id_page");d.setRawValue(e);d.show();a.setSrc("http://www.rcsb.org/pdb/images/"+f+"_asr_r_250.jpg");a.show()},setFieldValue:function(c,g){if(c=="synonyms"){if(g!=null){var h=this.down("#"+c);var b=new String(g);var d=b.replace(new RegExp(" ,","g"),",");h.setValue(d);h.show()}}else{if(c=="keywords"){if(g!=null){var j=this.down("#"+c);var e=g.join(", ");j.setValue(e);j.show()}}else{if(c=="organism"){if(g!=null){this.addOrganism(g)}}else{if(c=="pdb_id_page"){if(g!=""&&g!=null){this.addPDBImage(g)}}else{if(c=="cellular_location"){if(g!=null){var a=this.down("#"+c);var k=g.replace(new RegExp(" ,","g"),",");a.setValue(k);a.show()}}else{var f=this.down("#"+c);if(f!=null){f.setValue(g);f.show()}}}}}}},setValues:function(a){this.resetAllFields();var d=a.data;recordData=a;var b=this.down("#pharmTargetButton");b.hide();b.setHandler(function(){Ext.History.add("!p=PharmByTargetNameForm&u="+a.store.proxy.extraParams.uri)});b.show();for(var c in d){if(d.hasOwnProperty(c)){if(d[c]){this.setFieldValue(c,d[c])}}}this.doLayout()},toggleProv:function(a){target_name_provenance=a;console.log(" Show provenance : "+target_name_provenance)}});var target_name_provenance=false;var recordData;function provenanceTargetSummaryRenderer(f,e){var b=new Array();b["http://www.chemspider.com"]="ChemSpider";b["http://data.kasabi.com/dataset/chembl-rdf"]="Chembl";b["http://linkedlifedata.com/resource/drugbank"]="DrugBank";b["http://www.conceptwiki.org"]="ConceptWiki";b["http://purl.uniprot.org"]="UniProt";if(target_name_provenance){var d=e.itemId;var j=d+"_item";d+="_src";var a=recordData.data[d];var h=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!h){h="defaultValue"}var g=h+"Icon";g="/assets/"+g+".png";h+=LDAProvenanceMode;h+="Summary";var c;c="<div>"+f+'   <a href="'+recordData.data[j]+'" target="_blank"><img src="'+g+'" title='+b[a]+' height="15" width="15"/></a></div>';return c}else{return f}}Ext.define("LSP.model.GuiComponent",{extend:"Ext.data.Model",fields:["xtype","url","id","text","home"]});Ext.define("LDA.helper.JamesQueryStringEncoder",{extend:"Ext.Base",toQueryString:function(c){var b=[],h=[],d,a,e,g,f;for(d in c){if(c.hasOwnProperty(d)){b=b.concat(Ext.Object.toQueryObjects(d,c[d],false))}}for(a=0,e=b.length;a<e;a++){g=b[a];f=g.value;if(Ext.isEmpty(f)){continue}else{if(Ext.isDate(f)){f=Ext.Date.toString(f)}}h.push(encodeURIComponent(g.name)+"="+encodeURIComponent(String(f)))}return h.join("&")}});Ext.define("LSP.controller.BackgroundTasks",{extend:"Ext.app.Controller",views:["background_tasks.BackgroundTasksForm"],refs:[{ref:"tasksContainer",selector:"#tasks_container"}],task_list:new Array(),init:function(){this.control({"#background_tasks_form":{taskadded:this.addNewTask}})},removeTask:function(){runner=this.getTaskRunner();if(runner){runner.destroy()}this.close()},addNewTask:function(a,f){console.log("adding task with uuid : "+a);var e=this;this.task_list.push(a);var d=f;var b=Ext.create("LSP.view.background_tasks.BackgroundTask",{});b.down("#type").setText(f+"....creating");b.down("#type").setHeight("auto");b.down("#cancel_button").on({click:{fn:e.removeTask,scope:b}});this.getTasksContainer().add(b);var j=Ext.create("LDA.store.TSVStatusStore",{});j.setUUID(a);j.setTask(b);j.setTasksContainer(this.getTasksContainer());var c=function(){this.load({params:{uuid:this.getUUID()},callback:function(l,k,m){if(m){console.log("success tsv status");status=l[0].data.status;percentage=l[0].data.percentage;if(percentage!="0"){this.getTask().down("#progress").updateProgress(percentage/100,"",true);this.getTask().down("#type").setText(d+"....creating("+percentage+"%)")}if(status=="finished"){this.getTask().down("#progress").hide();this.getTask().down("#type").setText(f+"...ready for download");this.getTaskRunner().destroy();tsv_download_button=Ext.create("Ext.Button",{text:"Download tsv file",tooltip:"Download results as a tab separated file",itemId:"tsvDownloadProxy_"+this.getUUID(),iconCls:"icon-csv",hidden:false,disabled:false,margin:"2",href:tsv_download_url,renderTo:Ext.getBody()});tsv_download_button.href=tsv_download_url+"uuid="+this.getUUID();tsv_download_button.setParams();this.getTask().add(tsv_download_button)}else{if(status=="failed"){this.getTask().down("#progress").hide();this.getTask().down("#type").setText(f+"...FAILED");this.getTaskRunner().destroy()}}}else{console.log("fail tsv status")}}})};var h=new Ext.util.TaskRunner();j.setTaskRunner(h);var g=h.start({run:c,interval:5000,scope:j});b.setTaskRunner(h)}});Ext.define("LSP.view.target_by_name.TargetByNameForm",{extend:"Ext.form.Panel",alias:"widget.TargetByNameForm",closable:true,header:false,requires:["LSP.view.dropdowns.conceptWikiProteinLookup","LSP.view.target_by_name.TargetPanel"],layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Start typing in protein name and species. E.g. "Adenosine receptor A2a (Homo sapiens)"</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[Ext.create("CW.view.ConceptWikiLookup",{fieldLabel:"Target name",itemId:"targetByNameLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),noCache:false,limitParam:undefined,startParam:undefined,pageParam:undefined,callbackKey:"_callback",extraParams:{branch:3,_format:"json",app_id:app_id,app_key:app_key}}}),name:"protein_uri",cwTagUuid:"eeaec894-d856-4106-9fa1-662b1dc6c6f1"}),{xtype:"button",padding:"5 5 5 5",text:"Search",itemId:"TargetByNameSubmit_id",disabled:true,action:"query_target_by_name"},{xtype:"radiogroup",width:160,labelWidth:65,fieldLabel:"Provenance",itemId:"provId",margin:"5 0 0 90",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]}]},{xtype:"TargetPanel",flex:1}];this.callParent(arguments)}});Ext.define("LSP.controller.TargetByNameForm",{extend:"Ext.app.Controller",views:["target_by_name.TargetByNameForm"],current_uri:null,refs:[{ref:"targetPanel",selector:"TargetPanel"},{ref:"formView",selector:"TargetByNameForm"},{ref:"submitButton",selector:"#TargetByNameSubmit_id"},{ref:"lookup",selector:"#targetByNameLookup"}],init:function(){this.control({"TargetByNameForm button[action=query_target_by_name]":{click:this.submitQuery},"TargetByNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},TargetByNameForm:{historyToken:this.handleHistoryToken},"TargetByNameForm #provId":{change:this.onProvChange}})},handleHistoryToken:function(b){console.log("LSP.controller.TargetByNameForm: handleHistoryToken()");var c=this;var e=c.getFormView().down("TargetPanel");if(b.u){this.current_uri=b.u;var a=this.getStore("LDA.store.TargetStore");if(b.u!=a.proxy.extraParams.uri){var g=this.getController("CW.controller.ConceptWikiLookup");var f=this.getFormView().down("conceptWikiLookup");g.setConcept(b.u,f,a);a.proxy.extraParams.uri=b.u;c.getFormView().setLoading(true);a.load(function(j,h,k){if(k){console.log("LSP.controller.TargetByNameForm: store is loaded "+k);c.getSubmitButton().enable();e.setValues(j[0]);e.recordData=j[0];e.down("#dp").setVisible(true);e.down("#msg").setVisible(false);c.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});c.getSubmitButton().enable();e.down("#dp").setVisible(false);c.getFormView().setLoading(false)}})}}else{if(b.s){var d=this.getLookup();d.setRawValue(b.s);d.doQuery(b.s)}}},enableSubmit:function(){var b=this.getFormView();var a=this.getSubmitButton();a.enable()},submitQuery:function(c){c.disable();var e=this;var d=this.getFormView();var f=e.getFormView().down("TargetPanel");var a=d.getValues().protein_uri;if(this.current_uri==a){var b=this.getStore("LDA.store.TargetStore");b.proxy.extraParams.uri=this.current_uri;e.getFormView().setLoading(true);b.load(function(h,g,j){if(j){console.log("LSP.controller.TargetByNameForm: store is loaded "+j);e.getSubmitButton().enable();f.setValues(h[0]);f.recordData=h[0];f.down("#dp").setVisible(true);f.down("#msg").setVisible(false);e.getFormView().setLoading(false)}else{Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});e.getSubmitButton().enable();f.down("#dp").setVisible(false);e.getFormView().setLoading(false)}})}else{Ext.History.add("!p=TargetByNameForm&u="+a)}},onProvChange:function(d,b,a){var c=this.getTargetPanel();c.toggleProv(b.prov);c.setValues(c.recordData)}});Ext.define("LSP.store.GuiComponents",{extend:"Ext.data.Store",id:"GuiComponents",model:"LSP.model.GuiComponent",autoLoad:true,data:[{url:"users.json",text:"Users",id:3,xtype:"dynamicgrid",home:"Users grid"},{url:"rdf.json",text:"SPARQL",id:5,xtype:"queryform",home:"SPARQL form"},{url:"",text:"Compound by name",id:18,xtype:"CmpdByNameForm",home:"Compound by name"},{url:"",text:"Compound by structure",id:23,xtype:"SimSearchForm",home:"Compound Structure Search"},{url:"",text:"Target by name",id:24,xtype:"TargetByNameForm",home:"Target by name"},{url:"",text:"X-Target by sequence",id:25,xtype:"temp",home:""},{url:"",text:"Pharmacology by Target",id:26,xtype:"PharmByTargetNameForm",home:"Pharmacology by Target Name"},{url:"",text:"Pharmacology by Compound",id:27,xtype:"PharmByCmpdNameForm",home:"Pharmacology by Compound name"},{url:"",text:"Pharmacology by Enzyme family",id:28,xtype:"PharmEnzymeForm",home:"Compounds active against enzyme family"},{url:"",text:"X-Polypharmacology Browser",id:34,xtype:"temp",home:""},{url:"",text:"X-Target Dossier",id:35,xtype:"temp",home:""},{url:"",text:"X-Chem-Bio Navigator",id:36,xtype:"temp",home:""}]});Ext.define("LSP.controller.NavigationTree",{extend:"Ext.app.Controller",stores:["NavigationTree","GuiComponents"],views:["Appmoduletree"],init:function(){}});Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux.DataView","/ext/examples/ux/DataView/");Ext.define("LSP.view.dataview.StructureViewer",{extend:"Ext.window.Window",alias:"widget.StructureViewer",requires:["Ext.form.Panel","Ext.util.*","Ext.ux.DataView.Animated"],title:"Structures",layout:"fit",modal:true,autoShow:true,height:570,width:810,initComponent:function(){var b=structureViewStore;var a=Ext.create("Ext.view.View",{deferInitialRefresh:false,store:b,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="structure_data_view-wrap">','<p height="180">','<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>','<br /><strong>Chemspider id : <a href ="http://inchi.chemspider.com/Chemical-Structure.{csid}.html" target="_blank">{csid}</a></strong>',"</p>","</div>","</tpl>"),plugins:[Ext.create("Ext.ux.DataView.Animated",{duration:550,idProperty:"csid"})],itemSelector:"div.structure_data_view-wrap",overItemCls:"x-view-over_structure_dv",singleSelect:true,autoScroll:true});this.items=[{xtype:"form",padding:"0 0 0 0",border:false,autoScroll:true,style:"background-color: #fff;",items:a}];this.buttons=[{text:"Use structure",action:"commit_structure"},{text:"Cancel",scope:this,handler:this.close}];this.callParent(arguments)}});Ext.define("LDA.store.basestores.BaseStore",{extend:"Ext.data.Store",requires:["LDA.helper.LDAConstants"],_format:"json",uri:"",BASE_URL:"",remoteSort:true,app_key:app_key,app_id:app_id,typeName:"",stringEncoder:Ext.create("LDA.helper.JamesQueryStringEncoder"),proxy:{type:"jsonp",noCache:false,startParam:undefined,limitParam:undefined,pageParam:undefined,callbackKey:"_callback",listeners:{exception:function(c,a,b){}}},prefetchPage:function(e,b){var d=this,a=d.pageSize||d.defaultPageSize,f=(e-1)*d.pageSize,c=d.totalCount;if(c!==undefined&&d.getCount()===c&&d.getCount()>a){return}d.prefetch(Ext.applyIf({page:e,start:f,limit:a},b))},listeners:{beforeprefetch:{fn:function(){var a=this;a.updateProxyURL()}},beforeload:{fn:function(){var a=this;a.updateProxyURL()}}},sort:function(){var b=this,a=b.pageMap;if(b.buffered){if(b.remoteSort){a.clear();this.sortColumn(arguments);this.currentPage=1;this.guaranteeRange(0,49)}else{b.callParent(arguments)}}else{b.callParent(arguments)}},setURI:function(a){this.uri=a},updateProxyURL:function(){this.proxy.url=this.BASE_URL+this.stringEncoder.toQueryString({_format:this._format,uri:this.uri,app_key:this.app_key,app_id:this.app_id})},setTypeName:function(a){this.typeName=a},getTypeName:function(){return this.typeName}});Ext.define("LDA.store.FilterUnitsStore",{extend:"LDA.store.basestores.BaseStore",model:"LDA.model.FilterUnitsModel",storeId:"FilterUnitsStore",BASE_URL:ldaBaseUrl+"/pharmacology/filters/units/",activity_type:undefined,constructor:function(a,b){console.log("LDA.store.FilterUnitsStore: constructor()");this.proxy.reader=Ext.create("LDA.helper.FilterUnitsReader");this.BASE_URL+=a.activity_type+"?";this.callParent(b)}});Ext.Loader.setConfig({enabled:true});Ext.Loader.setPath("Ext.ux.grid","ext/examples/ux/grid");Ext.define("LSP.view.dynamicgrid.DynamicGrid",{extend:"Ext.grid.Panel",alias:"widget.dynamicgrid",requires:["LDA.helper.FilterUnitsReader","LDA.store.FilterUnitsStore","LDA.model.FilterUnitsModel","Ext.grid.RowNumberer","Ext.form.*","Ext.ux.grid.FiltersFeature","Ext.selection.CellModel","LSP.view.dynamicgrid.feature.selectable","LSP.view.ux.download.FileDownload"],viewConfig:{enableTextSelection:true},exportStore:null,exportCSVReady:false,exportSDFReady:false,rowNumberer:true,defaultWidth:200,showMenu:function(k,j,e){var l=e.data.compound_pref_label;var q=e.data.targets;var p;if(q){p=e.data.targets[0]}var h=e.data.target_pref_label_item;var m=e.data.compound_smiles;var g=e.data.cw_compound_uri;var f=e.data.cs_compound_uri;var a;if(f!=null){a=Ext.create("Ext.menu.Item",{text:"View chemspider info",iconCls:"menu-search-compound",handler:function(){var t=f.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];if(parseInt(t)>=1){Ext.create("CS.view.CompoundWindow").showCompound(t)}}})}var o;var r=new Array();if(q){if(e.data.targets.length>1){target_text_items=new Array();Ext.each(e.data.targets,function(u,t){if(u.title!=""){r.push({text:u.title,iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&s="+u.title)}});target_text_items.push({xtype:"textfield",value:u.title})}});var b=Ext.create("Ext.menu.Menu",{text:"View target info",items:r});var n=Ext.create("Ext.menu.Menu",{text:"View target info",items:target_text_items});o=Ext.create("Ext.menu.Item",{text:"View target info",iconCls:"menu-search-target",menu:b});text_menu_item=Ext.create("Ext.menu.Item",{text:"Copy target data",menu:target_text_items})}else{var d=e.data.targets[0].cw_uri;if(d!=null&&d!=""){o=Ext.create("Ext.menu.Item",{text:"View target info",iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&u="+d)}})}else{o=Ext.create("Ext.menu.Item",{text:"View target info",iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&s="+e.data.targets[0].title)}})}text_menu_item={xtype:"textfield",value:e.data.targets[0].title}}}if(p){var c=new Ext.menu.Menu({items:[{xtype:"textfield",value:l},{xtype:"textfield",value:m}]});if(text_menu_item!=null){c.insert(1,text_menu_item)}var s=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+g)}},{text:"Search for compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+m+"&st=exact")}},{text:"Copy Data",menu:c}]});if(q.length>0){s.insert(s.items.length-2,o)}if(a!=null){s.insert(s.items.length-1,a)}s.showAt(k,j)}else{var c=new Ext.menu.Menu({items:[{xtype:"textfield",value:l},{xtype:"textfield",value:m}]});var s=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+g)}},{text:"Search for compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+m+"&st=exact")}},{text:"Copy Data",menu:c}]});if(a!=null){s.insert(s.items.length-1,a)}s.showAt(k,j)}},initComponent:function(){console.log("DynamicGrid: initComponent()");var c={ftype:"filters",encode:true,local:true};var d={ftype:"selectable",id:"selectable"};var a=this.getExportStore();var b={tbar:[{xtype:"button",text:"Prepare tsv file",tooltip:"Prepare results as a tab separated file",itemId:"tsvDownloadProxy_id",iconCls:"icon-csv",hidden:false,disabled:true,},{xtype:"tbseparator"},{xtype:"button",text:"Download SD file ",tooltip:"Download results in SD file format",itemId:"sdfDownloadProxy_id",iconCls:"icon-sdf",hidden:true,disabled:true},],features:[c,d]};Ext.apply(this,b);Ext.apply(this.initialConfig,b);this.callParent(arguments)}});CSV_EXPORT_LIMIT=10000;Ext.define("LSP.controller.grids.DynamicGrid",{extend:"Ext.app.Controller",views:["dynamicgrid.DynamicGrid"],models:["DynamicGrid","Unit"],refs:[{ref:"gridView",selector:"dynamicgrid"}],current_jobs:new Array(),init:function(){console.log("DynamicGrid: init()");this.control({dynamicgrid:{itemcontextmenu:function(d,c,b,e,a,f){a.preventDefault();this.getGridView().showMenu(a.getX(),a.getY(),c)}},"dynamicgrid toolbar #sdfDownloadProxy_id":{click:this.prepSDFile}})},onLaunch:function(){},testThis:function(a){},prepareTSVDownload:function(){var g=this;var h=this.getGridView();var e,a,l,b,f,j,d,c,k;var m=Ext.create("LDA.store.TSVCreateStore",{});Ext.ComponentQuery.query("#background_tasks_form")[0].expand();Ext.each(this.getFilters(),function(o,n){if(o.filterType=="activity"){e=h.store.getActivityConditionParam();a=h.store.activity_type;l=h.store.activity_value;b=h.store.activity_unit}else{if(o.filterType=="organism"){f=h.store.assay_organism}else{if(o.filterType=="target"){j=h.store.target_organism}}}});d=h.store.proxy.extraParams.uri;c=h.store.getTotalCount();k=h.store.REQUEST_TYPE;m.load({params:{activity_value_type:e,activity_type:a,activity_value:l,activity_unit:b,assay_organism:f,target_organism:j,uri:d,total_count:c,request_type:k},callback:function(o,n,p){if(p){console.log("success tsv create");uuid=o[0].data.uuid;g.current_jobs.push(uuid);background_tasks_form=Ext.ComponentQuery.query("#background_tasks_form")[0];background_tasks_form.fireEvent("taskadded",uuid,g.getGridView().getStore().getTypeName())}else{console.log("fail tsv create")}}})},setTSVDownloadParams:function(){var c=this.getTsvDownloadButton();var a=this.getGridView();var b=new Array();Ext.each(this.getFilters(),function(e,d){if(e.filterType=="activity"){b.push("activity_value_type="+a.store.getActivityConditionParam()+"&activity_type="+a.store.activity_type+"&activity_value="+a.store.activity_value+"&activity_unit="+a.store.activity_unit)}else{if(e.filterType=="organism"){b.push("assay_organism="+a.store.assay_organism)}}});b.push("uri="+a.store.proxy.extraParams.uri+"&total_count="+a.store.getTotalCount()+"&request_type="+a.store.REQUEST_TYPE);total_params=b.join("&");c.href=tsv_download_url+"?"+total_params;c.setParams()},addCompletedActivityFilter:function(b){console.log("DynamicGrid: addCompletedActivityFilter()");activity_value=this.getFilterContainer().down("#activity_combobox_id").getValue();conditions_value=this.getFilterContainer().down("#conditions_combobox_id").getValue();value_value=this.getFilterContainer().down("#value_textfield_id").getValue();unit_value=this.getFilterContainer().down("#unit_combobox_id").getValue();unit_text=this.getFilterContainer().down("#unit_combobox_id").getRawValue();if(activity_value!=null&&conditions_value!=null&&value_value!=""&unit_value!=null){filter=Ext.create("LSP.model.Filter",{activity:activity_value,condition:conditions_value,value:value_value,unit:unit_value,unit_text:unit_text});filter.filterType="activity";this.getFilters().push(filter);filter.controller=this;filter_view=Ext.create("LSP.view.filter.CompletedActivityFilter",{});filter_view.down("#activityLabel_id").setText(activity_value);filter_view.down("#conditionsLabel_id").setText(conditions_value);filter_view.down("#valueLabel_id").setText(value_value);filter_view.down("#unitLabel_id").setText(unit_text);filter.filterView=filter_view;this.getFormView().down("#completedFilterContainer_id").add(filter_view);this.getFormView().down("#completedFilterContainer_id").setVisible(true);filter_view.filterModel=filter;filter_view.on({close:this.removeFilter});var c=this.getGridView();var a=c.store;a.filters=this.getFilters();a.setActivityType(activity_value);a.setActivityValue(value_value);a.setActivityCondition(conditions_value);a.setActivityUnit(unit_value);this.getFormView().down("#addCompletedActivityFilter_id").disable()}else{Ext.MessageBox.show({title:"Error",msg:"Filter options cannot be empty.<br>Please select a value for each of the filter options.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},addCompletedOrganismFilter:function(b){console.log("DynamicGrid: addCompletedOrganismFilter()");organism_value=this.getFilterContainer().down("#organism_combobox_id").getValue();if(organism_value!=null){filter=Ext.create("LSP.model.Filter",{value:organism_value});filter.filterType="organism";this.getFilters().push(filter);filter.controller=this;filter_view=Ext.create("LSP.view.filter.CompletedOrganismFilter",{});filter_view.down("#valueLabel_id").setText("Assay Organism");filter_view.down("#conditionsLabel_id").setText("=");filter_view.down("#organismType_id").setText(organism_value);filter.filterView=filter_view;this.getFormView().down("#completedFilterContainer_id").add(filter_view);this.getFormView().down("#completedFilterContainer_id").setVisible(true);filter_view.filterModel=filter;filter_view.on({close:this.removeFilter});var c=this.getGridView();var a=c.store;a.filters=this.getFilters();a.setAssayOrganism(organism_value);this.getFormView().down("#addCompletedOrganismFilter_id").disable()}else{Ext.MessageBox.show({title:"Error",msg:"Filter options cannot be empty.<br>Please select a value for each of the filter options.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},addCompletedTargetOrganismFilter:function(b){console.log("DynamicGrid: addCompletedTargetOrganismFilter()");organism_value=this.getFilterContainer().down("#target_organism_combobox_id").getValue();if(organism_value!=null){filter=Ext.create("LSP.model.Filter",{value:organism_value});filter.filterType="target";this.getFilters().push(filter);filter.controller=this;filter_view=Ext.create("LSP.view.filter.CompletedTargetOrganismFilter",{});filter_view.down("#valueLabel_id").setText("Target Organism");filter_view.down("#conditionsLabel_id").setText("=");filter_view.down("#organismType_id").setText(organism_value);filter.filterView=filter_view;this.getFormView().down("#completedFilterContainer_id").add(filter_view);this.getFormView().down("#completedFilterContainer_id").setVisible(true);filter_view.filterModel=filter;filter_view.on({close:this.removeFilter});var c=this.getGridView();var a=c.store;a.filters=this.getFilters();a.setTargetOrganism(organism_value);this.getFormView().down("#addCompletedTargetOrganismFilter_id").disable()}else{Ext.MessageBox.show({title:"Error",msg:"Filter options cannot be empty.<br>Please select a value for each of the filter options.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},removeFilter:function(c){console.log("DynamicGrid: filterClosed()");controller=c.filterModel.controller;var d=controller.getGridView();var a=d.store;if(c.filterModel.filterType=="activity"){var b=controller.getFilters().indexOf(c.filterModel);controller.getFilters().splice(b,1);a.filters=controller.getFilters();a.setActivityType("");a.setActivityValue("");a.setActivityCondition("");a.setActivityUnit("");controller.getFormView().down("#addCompletedActivityFilter_id").enable()}else{if(c.filterModel.filterType=="organism"){var b=controller.getFilters().indexOf(c.filterModel);controller.getFilters().splice(b,1);a.filters=controller.getFilters();a.setAssayOrganism(null);controller.getFormView().down("#addCompletedOrganismFilter_id").enable()}else{if(c.filterModel.filterType=="target"){var b=controller.getFilters().indexOf(c.filterModel);controller.getFilters().splice(b,1);a.filters=controller.getFilters();a.setTargetOrganism(null);controller.getFormView().down("#addCompletedTargetOrganismFilter_id").enable()}}}},addFilterForm:function(a){console.log("DynamicGrid: addFilterForm()");hide=this.getFilterContainer().hidden;if(hide){this.getFilterContainer().setVisible(true)}else{this.getFilterContainer().setVisible(false)}},prepSDFile:function(a){Ext.MessageBox.show({title:"Info",msg:"SD file export is not available in this release. The functionality will be available in the next release.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},updateSDFStatus:function(e,c,a){var b=c.data.items;var d=b.length;var f=0;var g=0;Ext.each(b,function(h){if(h.molfile!==undefined){g++}});e.setText("SD-File "+(100*g/a).toFixed(0)+"% ready");if(g>=0.98*a){e.setText("SD-File ready! Click ->");e.up("grid").down("#sdfDownload_id").enable();e.up("grid").exportSDFReady=true;e.up("form").setLoading(false)}},getMolfile:function(b,c,d,a){var f=this;var g=Ext.create("CS.store.Compound");var e=c.length;g.load({params:{"csids[0]":b},callback:function(k,h,m){if(m){var j=g.first().raw.Mol;for(i=0;i<e;i++){var l=d.getAt(c[i]);l.molfile=j}f.updateSDFStatus(a,d)}else{}}},this)},prepGrid:function(){console.log(this.$className+": prepGrid()");this.filters=new Array();var b=this.getGridView();var a=b.getStore();a.on("prefetch",this.storeLoadComplete,this)},storeLoadComplete:function(b,a,c){console.log(this.$className+": storeLoadComplete()");grid_view=this.getGridView();grid_store=grid_view.getStore();if(c){this.setTSVDownloadParams();grid_view.down("#sdfDownloadProxy_id").enable();grid_view.down("#tsvDownloadProxy_id").enable();this.getSubmitButton().enable();grid_view.setLoading(false);grid_view.setTitle(grid_view.gridBaseTitle+" - Total Records: "+grid_store.getTotalCount())}else{console.log(this.$className+": possible timeout for with uri "+grid_store.proxy.url);this.getSubmitButton().enable();grid_view.setLoading(false);grid_view.setTitle(grid_view.gridBaseTitle+" ---- There was an error retrieving some of the records ----")}},fetchTotalResults:function(){console.log("DynamicGrid: fetchTotalResults() for "+this.$className);try{var e=this.getGridView();var c=e.getStore();var d=this.getFormView();var b=this.getSubmitButton();this.resetDownload();countStore=this.getCountStore();countStore.uri=c.proxy.reader.uri;Ext.each(this.getFilters(),function(g,f){if(g.filterType=="activity"){countStore.setActivityType(g.data.activity);countStore.setActivityValue(g.data.value);countStore.setActivityCondition(g.data.condition);countStore.setActivityUnit(g.data.unit)}else{if(g.filterType=="organism"){countStore.setAssayOrganism(g.data.value)}else{if(g.filterType=="target"){countStore.setTargetOrganism(g.data.value)}}}});countStore.load(function(g,f,h){if(h){total=f.response.result.primaryTopic[this.countNode];c.proxy.reader.total_count=total;if(total==0){e.setTitle(e.gridBaseTitle+" - No records found within OPS for this search!");e.down("#sdfDownloadProxy_id").disable();e.down("#tsvDownloadProxy_id").disable();b.enable();e.setLoading(false);Ext.MessageBox.show({title:"Info",msg:"The OPS system does not contain any data that match this search.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{e.setLoading(false);c.guaranteeRange(0,49)}}else{e.setTitle(e.gridBaseTitle+" - We are sorry but the OPS system returned an error!");e.down("#sdfDownloadProxy_id").disable();e.down("#tsvDownloadProxy_id").disable();b.enable();e.setLoading(false);Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}})}catch(a){console.log("DynamicGrid: exception fetching results for "+this.$className+"with uri "+c.proxy.uri);Ext.MessageBox.show({title:"Info",msg:"We are sorry but the OPS system returned an error.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}},enableSubmit:function(a){this.getGridView().getStore().setTypeName(a.rawValue);this.getSubmitButton().enable()},resetDownload:function(){var a=this.getGridView();a.exportCSVReady=false;a.exportSDFReady=false;a.getExportStore().removeAll(true)},onProvChange:function(d,b,a){var c=this.getGridView();c.toggleProv(b.prov);c.getView().refresh()},getFilters:function(){if(this.filters==null){this.filters=new Array()}return this.filters},getRequestType:function(){return this.request_type}});Ext.define("LSP.view.larkc_sim_search.SimSearchScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.SimSearchScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:["LDA.model.SimModel"],refs:[],store:Ext.create("LDA.store.SimSearchLocalStore",{}),exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.SimSearchStore",{})}return this.exportStore},columns:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_uri",xtype:"templatecolumn",tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',width:135,sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",renderer:structureProvenanceRenderer,width:180,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Molecular Formula",dataIndex:"molform",renderer:structureProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"ALogP",dataIndex:"alogp",renderer:structureProvenanceRenderer,width:60,align:"center",tdCls:"gridRowPadding"},{header:"# HBA",dataIndex:"hba",renderer:structureProvenanceRenderer,tooltip:"Number of Hydrogen Bond Acceptors",width:60,align:"center",tdCls:"gridRowPadding"},{header:"# HBD",dataIndex:"hbd",renderer:structureProvenanceRenderer,tooltip:"Number of Hydrogen Bond Donors",width:60,align:"center",tdCls:"gridRowPadding"},{header:"Mol Weight",dataIndex:"full_mwt",renderer:structureProvenanceRenderer,tooltip:"Molecular Weight",width:70,align:"center",tdCls:"gridRowPadding"},{header:"MW Freebase",dataIndex:"mw_freebase",renderer:structureProvenanceRenderer,tooltip:"Molecular Weight (Free Base)",align:"center",tdCls:"gridRowPadding"},{header:"# RTB",dataIndex:"rtb",renderer:structureProvenanceRenderer,tooltip:"Number of Rotatable Bonds",width:60,align:"center",tdCls:"gridRowPadding"},{header:"Melting Point",dataIndex:"meltingPoint",renderer:structureProvenanceRenderer,width:140,tdCls:"wrap gridDescriptiveRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:structureProvenanceRenderer,width:135,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"inchi",renderer:structureProvenanceRenderer,width:135,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"inchi_key",renderer:structureProvenanceRenderer,width:135,align:"center",tdCls:"gridRowPadding"}],simSearchProv:false,toggleProv:function(a){this.simSearchProv=a;console.log(" Show provenance : "+this.simSearchProv);this.doLayout()},showMenu:function(l,j,f){var k=f.data.compound_pref_label;var h=f.data.target_title;var g=f.data.compound_smiles;var e=f.data.cw_uri;var b=f.data.cs_uri;var c;if(b!=null){c=Ext.create("Ext.menu.Item",{text:"View chemspider info",iconCls:"menu-search-compound",handler:function(){var m=b.match(/http:\/\/rdf.chemspider.com\/(\d+)/)[1];if(parseInt(m)>=1){Ext.create("CS.view.CompoundWindow").showCompound(m)}}})}if(h){var a=new Ext.menu.Menu({items:[{xtype:"textfield",value:k},{xtype:"textfield",value:h},{xtype:"textfield",value:g}]});var d=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+e)}},{text:"View target info",itemId:"searchForTarget",iconCls:"menu-search-target",handler:function(){Ext.History.add("!p=TargetByNameForm&s="+h)}},{text:"Search for a compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+g+"&st=exact")}},{text:"Copy Data",menu:a}]});if(c!=null){d.insert(d.items.length-1,c)}d.showAt(l,j)}else{var a=new Ext.menu.Menu({items:[{xtype:"textfield",value:k},{xtype:"textfield",value:g}]});var d=new Ext.menu.Menu({items:[{text:"View compound info",itemId:"searchForCompoundByName",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=CmpdByNameForm&u="+e)}},{text:"Search for a compound by SMILES",itemId:"searchForCompoundBySMILES",iconCls:"menu-search-compound",handler:function(){Ext.History.add("!p=SimSearchForm&sm="+g+"&st=exact")}},{text:"View compound pharmacology info",itemId:"searchForPharmacologyByCompound",iconCls:"menu-search-compound",handler:function(){if(e){Ext.History.add("!p=PharmByCmpdNameForm&u="+e)}else{Ext.History.add("!p=PharmByCmpdNameForm&s="+k)}}},{text:"Copy Data",menu:a}]});if(c!=null){d.insert(d.items.length-1,c)}d.showAt(l,j)}}});function structureProvenanceRenderer(b,h,c,f,d,g){if(this.simSearchProv){var e=this.columns[d].dataIndex;var l=e+"_item";e+="_src";var a=c.data[e];var k=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!k){k="defaultValue"}var j=k+"Icon";j="/assets/"+j+".png";k+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(c.data[e]&&b){return'<div class="'+k+'">'+b+'</div><br><a href="'+c.data[l]+'" target="_blank"><img src="'+j+'" height="15" width="15"/></a>'}else{b==null?b="":"";return'<div class="'+k+'">'+b+"</div>"}}}else{return b}return b}var sim_search_type=Ext.create("Ext.data.Store",{fields:["sim_type","name"],data:[{sim_type:"Tanimoto",name:"Tanimoto"},{sim_type:"Tversky",name:"Tversky"},{sim_type:"Euclidian",name:"Euclidian"}]});Ext.define("LSP.view.larkc_sim_search.SimSearchForm",{extend:"Ext.form.Panel",alias:"widget.SimSearchForm",header:false,requires:["LSP.view.mol_editor_forms.KetcherForm","LSP.view.larkc_sim_search.SimSearchScrollingGrid"],closable:true,layout:{type:"vbox",align:"stretch"},initComponent:function(){console.log("LSP.view.larkc_sim_search.SimSearchForm: initComponent()");this.items=[{xtype:"form",padding:"5 5 5 5",border:false,style:"background-color: #fff;",items:[{name:"molfile",xtype:"hidden",value:""},{xtype:"fieldcontainer",layout:"column",collapsible:false,defaults:{anchor:"100%"},items:[{xtype:"textfield",name:"smiles",itemId:"smilesField",emptyText:"Enter SMILES here or use the molecular editor to draw structure - click button ->",fieldLabel:"Search for compounds similar to SMILES",labelWidth:230,width:650},{xtype:"button",action:"ketcher_editor",text:"Draw structure"},{xtype:"radiogroup",width:160,labelWidth:65,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 80",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"radiogroup",fieldLabel:"Search type",itemId:"searchTypeRadio",items:[{boxLabel:"Exact structure search",name:"search_type",inputValue:1,checked:true},{boxLabel:"Substructure search",name:"search_type",inputValue:2},{boxLabel:"Structural similarity search",name:"search_type",inputValue:3}]},{xtype:"container",layout:"column",items:[{xtype:"combobox",itemId:"sim_search_type_id",fieldLabel:"Similarity Threshold Type",labelWidth:150,store:sim_search_type,queryMode:"local",displayField:"sim_type",valueField:"sim_type",labelPad:2,padding:"0 2 0 0",value:"Tanimoto"},{xtype:"numberfield",itemId:"tanimoto_threshold_id",anchor:"100%",name:"tanimoto_threshold",fieldLabel:"Similarity threshold",labelWidth:115,value:90,width:175,allowDecimals:false,maxValue:100,minValue:1,padding:"0 2 0 25"},{xtype:"numberfield",itemId:"max_records_id",anchor:"100%",name:"max_records",fieldLabel:"Maximum records to retrieve",labelWidth:160,width:260,step:20,value:100,allowDecimals:false,minValue:20,padding:"0 2 0 25"}]},{xtype:"button",action:"query",itemId:"sim_sss_start_search_button_id",text:"Start search..."}]},{xtype:"SimSearchScrollingGrid",itemId:"simSearchGrid",title:"Structure search results",gridBaseTitle:"Structure search results",flex:1}];this.callParent(arguments)},setFormData:function(b){if(b.sm){var c=this.down("#smilesField");c.setValue(b.sm);var a=this.down("#searchTypeRadio");if(b.st){if(b.st=="exact"){a.setValue({search_type:1})}else{if(b.st=="sub"){a.setValue({search_type:2})}else{if(b.st=="sim"){a.setValue({search_type:3})}}}}else{a.setValue({search_type:1})}this.fireEvent("historyToken",b)}}});Ext.define("LSP.controller.SimSearchForm",{extend:"Ext.app.Controller",views:["larkc_sim_search.SimSearchForm","mol_editor_forms.KetcherForm","dataview.StructureViewer"],refs:[{ref:"ssform",selector:"SimSearchForm"},{ref:"strucGrid",selector:"#simSearchGrid"},{ref:"submitButton",selector:"SimSearchForm #sim_sss_start_search_button_id"},{ref:"tsvDownloadButton",selector:"SimSearchForm #tsvDownloadProxy_id"},{ref:"tanimotoThresholdSpinner",selector:"SimSearchForm #tanimoto_threshold_id"},{ref:"maxRecordsSpinner",selector:"SimSearchForm #max_records_id"},{ref:"SimSearchType",selector:"SimSearchForm #sim_search_type_id"}],all_records:undefined,total_count:0,current_count:0,missing_count:0,failed_to_load:0,current_smiles:undefined,current_mode:undefined,success_count:0,csids:undefined,current_jobs:new Array(),init:function(){console.log("LSP.controller.SimSearchForm: init()");this.control({"SimSearchForm button[action=ketcher_editor]":{click:this.launchKetcher},"KetcherForm button[action=commit_structure]":{click:this.getSmiles},"SimSearchForm button[action=query]":{click:this.submitQuery},SimSearchForm:{historyToken:this.handleHistoryToken,afterrender:this.prepGrid},"SimSearchForm #provId":{change:this.onProvChange},"#simSearchGrid":{itemcontextmenu:function(d,c,b,e,a,f){a.preventDefault();this.getStrucGrid().showMenu(a.getX(),a.getY(),c)}},"SimSearchForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},prepareTSVDownload:function(){console.log("Sim Search TSV download");var g=this;var h=this.getStrucGrid();var e,a,k,b,f,d,c,j;var l=Ext.create("LDA.store.TSVCreateStore",{});l.proxy.url=cs_download_url;c=h.store.getTotalCount();j=h.store.REQUEST_TYPE;l.load({params:{csids:Ext.encode(g.csids),total_count:c,request_type:j},callback:function(n,m,o){if(o){console.log("success tsv create");uuid=n[0].data.uuid;g.current_jobs.push(uuid);background_tasks_form=Ext.ComponentQuery.query("#background_tasks_form")[0];background_tasks_form.fireEvent("taskadded",uuid,g.getStrucGrid().getStore().getTypeName())}else{console.log("fail tsv create")}}})},setTSVDownloadParams:function(){var d=this.getTsvDownloadButton();var b=new Array();var c=this.getStrucGrid().getStore();var a=c.data.items;var e=new Array();Ext.each(a,function(g,f){b.push("csids[]="+g.data.csid);e.push(g.data.csid)});total_params=b.join("&");d.href=cs_download_url+"?"+total_params;d.setParams();this.csids=e},prepGrid:function(){console.log("LSP.controller.SimSearchForm: prepGrid()");var b=this.getStrucGrid();var a=b.getStore();a.removeAll();a.on("prefetch",this.storeLoadComplete,this)},storeLoadComplete:function(b,a,c){console.log("SimSearchForm: storeLoadComplete() "+this.current_count);if(this.current_count==this.total_count){b=Ext.create("Ext.data.store",{model:"LDA.model.SimModel"});b.add(this.all_records);this.getStrucGrid().store=b;this.getSubmitButton().enable();this.getSsform().doLayout();this.getSsform().setLoading(false);this.getStrucGrid().down("#tsvDownloadProxy_id").enable()}},hitCoreAPI:function(d){console.log("SimSearchForm: hitCoreAPI()");var e=this;this.failed_to_load=0;e.getStrucGrid().getStore().sorters.clear();var c=this.getStrucGrid();this.all_records=new Array();var a=Ext.create("LDA.store.CompoundStore",{});a.proxy.reader=Ext.create("LDA.helper.ChemspiderCompoundReader");this.current_count=0;this.missing_count=0;this.success_count=0;this.total_count=d.length;for(var b=0;b<d.length;b++){a.proxy.extraParams.uri=d[b];a.load(function(g,f,h){if(h){e.getSsform().setLoading("Fetching compounds...."+e.current_count+" of "+e.total_count);g[0].index=e.success_count;e.success_count++;e.current_count++;e.getStrucGrid().getStore().add(g[0]);if(e.current_count==e.total_count){e.setTitleAfterLoading()}}else{e.getSsform().setLoading("Fetching compounds...."+e.current_count+" of "+e.total_count);e.current_count++;e.failed_to_load++;if(e.current_count==e.total_count){e.setTitleAfterLoading()}}})}},setTitleAfterLoading:function(){this.getSubmitButton().enable();this.getSsform().setLoading(false);this.getStrucGrid().down("#tsvDownloadProxy_id").enable();if(this.failed_to_load>0){if(this.current_mode=="exact"){this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle+": There are no records in OPS for this compound")}else{this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle+" (No information on "+this.failed_to_load+" records out of "+this.total_count+")");if(this.missing_count>0){this.getStrucGrid().setTitle(this.getStrucGrid().getTitle+". The OPS API has no data on "+this.missing_records+" compounds.")}}}else{if(this.current_mode=="exact"){this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle)}else{this.getStrucGrid().setTitle(this.getStrucGrid().gridBaseTitle+" ("+this.total_count+" records)");if(this.missing_count>0){this.getStrucGrid().setTitle(this.getStrucGrid().getTitle+"OPS has no data on "+this.missing_records+" compounds.")}}}this.setTSVDownloadParams()},handleHistoryToken:function(d){console.log("SimSearchForm: handleHistoryToken() "+d);var f=this;f.current_smiles=d.sm;f.current_mode=d.st;var j=f.getStrucGrid();var a=j.store.getRange();j.store.removeAll();j.getStore().setTypeName(f.current_smiles+" : "+f.current_mode);var k=Ext.create("CS.engine.search.Structure",{listeners:{finished:function(n,m){if(m.length==0){Ext.MessageBox.show({title:"Error",msg:"No compounds were found for this search, please try again with a different structure.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});f.getSubmitButton().enable();f.getSsform().setLoading(false)}else{f.hitCoreAPI(m)}},failed:function(n,m){Ext.MessageBox.show({title:"Error",msg:"There was an error retrieving the compounds for this structure search.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});f.getSubmitButton().enable();f.getSsform().setLoading(false);f.getStrucGrid().down("#tsvDownloadProxy_id").disable()}}});var l="";var h="";var c={};var g=this.getSsform().getValues();c["searchOptions.Molecule"]=g.smiles;if(g.search_type=="1"){l="Exact structure match";h="exact"}else{if(g.search_type=="2"){l="Substructure structure";h="substructure"}else{if(g.search_type=="3"){l="Similarity search";h="similarity";var e=this.getTanimotoThresholdSpinner().value;c["resultOptions.Threshold"]=e/100;var b=this.getSimSearchType().value;b=="Tanimoto"?c["searchOptions.SimilarityType"]=0:"";b=="Tversky"?c["searchOptions.SimilarityType"]=1:"";b=="Euclidian"?c["searchOptions.SimilarityType"]=2:""}else{}}}this.getStrucGrid().setTitle(l);this.getSsform().setLoading("Fetching compounds....");k.setLimit(this.getMaxRecordsSpinner().value);k.doSearch(h,c)},launchKetcher:function(c){var a=Ext.widget("KetcherForm");fields=this.getSsform().form.getFields().items;var b="";fields.forEach(function(e){if(e.name=="molfile"){b=e.getValue();var d=12}});if(b!=""){document.getElementById("ketcher_box_id").contentWindow.ketcher.setMolecule(b)}},getSmiles:function(b){var a=document.getElementById("ketcher_box_id");smiles=a.contentWindow.ketcher.getSmiles();molfile=a.contentWindow.ketcher.getMolfile();fields=this.getSsform().form.getFields().items;fields.forEach(function(c){if(c.name=="smiles"){c.setValue(smiles)}else{if(c.name=="molfile"){c.setValue(molfile)}}});b.up("KetcherForm").close()},submitQuery:function(f){console.log(" SimSearchForm: submitQuery()");var g=this;f.disable();var a=f.up("form");var j=a.getValues();if(j.smiles.length<4){f.enable();return}var h="exact";if(j.search_type==2){h="sub"}else{if(j.search_type==3){h="sim"}}if(g.current_smiles==j.smiles&&g.current_mode==h){var l=g.getStrucGrid();var b=l.store.getRange();l.store.removeAll();var m=Ext.create("CS.engine.search.Structure",{listeners:{finished:function(o,n){if(n.length==0){Ext.MessageBox.show({title:"Error",msg:"Chemspider returned no compounds for this search, please try again with a different structure.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});g.getSubmitButton().enable();g.getSsform().setLoading(false)}else{g.hitCoreAPI(n)}},failed:function(o,n){Ext.MessageBox.show({title:"Error",msg:"There was an error retrieving the list of compounds from Chemspider",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});g.getSubmitButton().enable();g.getSsform().setLoading(false);g.getStrucGrid().down("#tsvDownloadProxy_id").disable()}}});var k="";var d={};var j=this.getSsform().getValues();d["searchOptions.Molecule"]=j.smiles;if(j.search_type=="1"){k="Exact structure match";search_type="exact"}else{if(j.search_type=="2"){k="Substructure structure";search_type="substructure"}else{if(j.search_type=="3"){k="Similarity search";search_type="similarity";var e=this.getTanimotoThresholdSpinner().value;d["resultOptions.Threshold"]=e/100;var c=this.getSimSearchType().value;c=="Tanimoto"?d["searchOptions.SimilarityType"]=0:"";c=="Tversky"?d["searchOptions.SimilarityType"]=1:"";c=="Euclidian"?d["searchOptions.SimilarityType"]=2:""}else{}}}g.getStrucGrid().setTitle(k);g.getSsform().setLoading("Fetching compounds....");m.setLimit(this.getMaxRecordsSpinner().value);m.doSearch(search_type,d)}else{Ext.History.add("!p=SimSearchForm&sm="+j.smiles+"&st="+h)}},onProvChange:function(d,b,a){var c=this.getStrucGrid();c.toggleProv(b.prov);c.getView().refresh()}});Ext.define("LSP.view.pharm_by_enzyme_family.PharmByEnzymeFamilyScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.PharmByEnzymeFamilyScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:[],listeners:{sortchange:function(b,c,d,a){console.log("PharmByEnzymeFamilyScrollingGrid: sortchange()");this.setLoading(true)}},store:"EnzymeFamilyPaginatedStore",exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.EnzymeFamilyPaginatedStore",{})}return this.exportStore},columns:{defaults:{},items:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_compound_uri",xtype:"templatecolumn",tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',width:135,sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",width:180,renderer:enzymeProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Name",dataIndex:"target_title",width:180,renderer:enzymeProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Organism",dataIndex:"target_organism",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Organism",dataIndex:"assay_organism",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Description",dataIndex:"assay_description",width:200,renderer:enzymeProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Activity Type",dataIndex:"activity_activity_type",renderer:enzymeProvenanceRenderer,width:72,align:"center",tdCls:"gridRowPadding"},{header:"Relation",dataIndex:"activity_relation",renderer:enzymeProvenanceRenderer,width:52,align:"center",tdCls:"gridRowPadding"},{header:"Value",dataIndex:"activity_standard_value",renderer:enzymeProvenanceRenderer,width:60,align:"center",tdCls:"gridRowPadding"},{header:"Units",dataIndex:"activity_standard_units",renderer:enzymeProvenanceRenderer,width:60,align:"center",tdCls:"gridRowPadding"},{header:"Mol Weight",dataIndex:"compound_full_mwt",renderer:enzymeProvenanceRenderer,align:"center",width:80,tdCls:"gridRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"compound_inchi",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"compound_inchikey",renderer:enzymeProvenanceRenderer,align:"center",tdCls:"gridRowPadding"}]},enzyme_prov:false,toggleProv:function(a){this.enzyme_prov=a;console.log(" Show provenance : "+this.enzyme_prov);this.doLayout()}});function enzymeProvenanceRenderer(f,m,g,k,h,l){if(this.enzyme_prov){var j=this.columns[h].dataIndex;var p=j+"_item";j+="_src";var a=g.data[j];var o=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!o){o="defaultValue"}var n=o+"Icon";n="/assets/"+n+".png";o+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(g.data[j]&&f){if(this.columns[h].dataIndex=="target_title"){var b=new String();var e=f.split(",");var c=g.data.target_concatenated_uris.split(",");var d="https://www.ebi.ac.uk/chembl/target/inspect/";Ext.each(e,function(v,s){var r=c[s];if(r){var q=d+r.split("/").pop();b+='<div class="'+o+'">'+v+'</div><br><a href="'+q+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}else{var t=c[0].split("/").pop();var u=d+t;b+='<div class="'+o+'">'+v+'</div><br><a href="'+u+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}});return b}return'<div class="'+o+'">'+f+'</div><br><a href="'+g.data[p]+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}else{return'<div class="'+o+'">'+f+"</div>"}}}else{return f}return f}var target_condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});Ext.define("LSP.view.pharm_by_target_name2.PharmByTargetNameForm",{extend:"Ext.form.Panel",alias:"widget.PharmByTargetNameForm",closable:true,header:false,layout:{type:"vbox",align:"stretch"},verticalScrollerType:"paginggridscroller",invalidateScrollerOnRefresh:false,disableSelection:true,initComponent:function(){console.log("PharmByTargetNameForm: constructor()");this.items=[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Type in protein name and species. E.g. "ADA protein human" and select a result</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[Ext.create("CW.view.ConceptWikiLookup",{xtype:"conceptWikiLookup",fieldLabel:"Protein name",itemId:"pharmByProteinCWLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),noCache:false,limitParam:undefined,startParam:undefined,pageParam:undefined,callbackKey:"_callback",extraParams:{branch:3,_format:"json",app_id:app_id,app_key:app_key}}}),name:"protein_uri",cwTagUuid:"eeaec894-d856-4106-9fa1-662b1dc6c6f1"}),{xtype:"button",itemId:"pharmByTargetSubmit_id",padding:"5 5 5 5",text:"Search...",disabled:true,name:"query_summit_button",action:"query_pharm_by_target_name"}]},{xtype:"container",margin:"0 5 5 5",name:"filter_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{xtype:"button",itemId:"addFilterButton_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Show or hide filter selector",action:"add_filter_form"},{xtype:"label",forId:"addFilterButton_id",text:"Filter",margin:"5 5 5 5"},{xtype:"radiogroup",width:200,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 65",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"container",margin:"0 5 5 5",name:"filter_selector_container",itemId:"filterSelectorContainer_id",hidden:true,layout:{type:"vbox"},style:"background-color: #fff;",items:[{xtype:"container",margin:"0 5 5 5",name:"activity_selector_container",itemId:"activitySelectorContainer_id",hidden:false,layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:Ext.create("LDA.store.FilterActivityStore",{}),queryMode:"remote",queryParam:false,displayField:"activity_type",valueField:"about",labelWidth:100,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:target_condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0",emptyText:"Enter a value..."},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0",emptyText:"Use drop down...",editable:false},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]},{xtype:"OrganismFilterForm",itemId:"organismFilterContainer_id",margin:"0 5 5 5",name:"organism_filter_fields",hidden:false},{xtype:"TargetOrganismFilterForm",itemId:"targetOrganismFilterContainer_id",margin:"0 5 5 5",name:"target_organism_filter_fields",hidden:false}]},{xtype:"container",itemId:"completedFilterContainer_id",margin:"0 5 5 5",name:"completed_filter_container",hidden:true},{xtype:"PharmByTargetNameScrollingGrid",itemId:"pharmByTargetNameGrid",title:"Pharmacology by Target name search results",gridBaseTitle:"Pharmacology by Target name search results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.view.pharm_by_target_name2.PharmByTargetNameScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.PharmByTargetNameScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:[],listeners:{sortchange:function(b,c,d,a){console.log("PharmByTargetNameGrid: sortchange()");this.setLoading(true)}},store:"TargetPharmacologyPaginatedStore",exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.TargetPharmacologyPaginatedStore",{})}return this.exportStore},columns:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_compound_uri",xtype:"templatecolumn",width:135,tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",width:180,renderer:targetProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Name",dataIndex:"target_pref_label",width:180,renderer:targetProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Organism",dataIndex:"target_organism",width:130,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Organism",dataIndex:"assay_organism",tooltip:"Name of the organism for the assay system (e.g., the organism, tissue or cell line in which an assay was performed). May differ from the target organism (e.g., for a human protein expressed in non-human cells, or pathogen-infected human cells)",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Description",dataIndex:"assay_description",width:150,tdCls:"wrap gridDescriptiveRowPadding",renderer:targetProvenanceRenderer},{header:"Activity Type",dataIndex:"activity_activity_type",width:72,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Relation",dataIndex:"activity_relation",width:52,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Value",dataIndex:"activity_standard_value",width:60,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Units",dataIndex:"activity_standard_units",width:60,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"PubMed ID",dataIndex:"activity_pubmed_id",xtype:"templatecolumn",tpl:'<a href="http://www.ncbi.nlm.nih.gov/pubmed?term={activity_pubmed_id}" target="_blank">{activity_pubmed_id}</a>',align:"center",tdCls:"gridRowPadding"},{header:"Mol Weight",dataIndex:"compound_full_mwt",width:80,renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"compound_inchi",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"compound_inchikey",renderer:targetProvenanceRenderer,align:"center",tdCls:"gridRowPadding"}],target_prov:false,toggleProv:function(a){this.target_prov=a;console.log(" Show target provenance : "+this.target_prov);this.doLayout()}});function targetProvenanceRenderer(b,h,c,f,d,g){if(this.target_prov){var e=this.columns[d].dataIndex;var l=e+"_item";e+="_src";var a=c.data[e];var k=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!k){k="defaultValue"}var j=k+"Icon";j="/assets/"+j+".png";k+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(c.data[e]&&b){return'<div class="'+k+'">'+b+'</div><br><a href="'+c.data[l]+'" target="_blank"><img src="'+j+'" height="15" width="15"/></a>'}else{return'<div class="'+k+'">'+b+"</div>"}}}else{return b}return b}Ext.define("LSP.view.pharm_by_cmpd_name2.PharmByCmpdNameScrollingGrid",{extend:"LSP.view.dynamicgrid.DynamicGrid",alias:"widget.PharmByCmpdNameScrollingGrid",layout:"fit",disableSelection:true,invalidateScrollerOnRefresh:false,requires:[],listeners:{sortchange:function(b,c,d,a){console.log("PharmByCmpdNameScrollingGrid: sortchange()");this.setLoading(true)}},refs:[],store:"CompoundPharmacologyPaginatedStore",exportStore:null,getExportStore:function(){if(this.exportStore==null){this.exportStore=Ext.create("LDA.store.CompoundPharmacologyPaginatedStore",{})}return this.exportStore},columns:[{xtype:"rownumberer",width:40},{header:"Structure",dataIndex:"cs_compound_uri",xtype:"templatecolumn",width:135,tpl:'<img width="128" height="128" src="http://www.chemspider.com/ImagesHandler.ashx?id={csid}&w=128&h=128" alt="CSID:{csid}"/>',sortable:false},{header:"Compound Name",dataIndex:"compound_pref_label",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Target Names",width:180,dataIndex:"targets",renderer:compoundProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Target Organisms",dataIndex:"target_organisms",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Assay Organism",dataIndex:"assay_organism",renderer:compoundProvenanceRenderer,tooltip:"Name of the organism for the assay system (e.g., the organism, tissue or cell line in which an assay was performed). May differ from the target organism (e.g., for a human protein expressed in non-human cells, or pathogen-infected human cells)",align:"center",tdCls:"gridRowPadding"},{header:"Assay Description",dataIndex:"assay_description",width:200,renderer:compoundProvenanceRenderer,tdCls:"wrap gridDescriptiveRowPadding"},{header:"Activity Type",dataIndex:"activity_activity_type",width:72,renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Relation",width:52,dataIndex:"activity_relation",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Value",dataIndex:"activity_standard_value",width:60,renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"Units",dataIndex:"activity_standard_units",width:60,renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"PubMed ID",dataIndex:"activity_pubmed_id",xtype:"templatecolumn",tpl:'<a href="http://www.ncbi.nlm.nih.gov/pubmed?term={activity_pubmed_id}" target="_blank">{activity_pubmed_id}</a>',align:"center",tdCls:"gridRowPadding"},{header:"SMILES",dataIndex:"compound_smiles",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChI",dataIndex:"compound_inchi",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"},{header:"InChIKey",dataIndex:"compound_inchikey",renderer:compoundProvenanceRenderer,align:"center",tdCls:"gridRowPadding"}],compound_prov:false,toggleProv:function(a){this.compound_prov=a;console.log(" Show provenance : "+this.compound_prov);this.doLayout()}});function compoundProvenanceRenderer(d,m,e,k,g,l){if(this.compound_prov){var j=this.columns[g].dataIndex;var p=j+"_item";j+="_src";var a=e.data[j];var o=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[a];if(!o){o="defaultValue"}var n=o+"Icon";n="/assets/"+n+".png";o+=LDAProvenanceMode;if(LDAProvenanceMode==LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR){if(e.data[j]&&d||this.columns[g].dataIndex=="targets"||this.columns[g].dataIndex=="target_organisms"){if(this.columns[g].dataIndex=="targets"){var c=new String();Ext.each(d,function(t,s){var q=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[t.src];var r=q+"Icon";r="/assets/"+r+".png";q+=LDAProvenanceMode;c+='<div class="'+q+'">'+t.title+'</div><br><a href="'+t.item+'" target="_blank"><img src="'+r+'" height="15" width="15"/></a>'});return c}if(this.columns[g].dataIndex=="target_organisms"){var f=new String();Ext.each(d,function(t,q){var s=LDA.helper.LDAConstants.LDA_SRC_CLS_MAPPINGS[t.src];var r=s+"Icon";r="/assets/"+r+".png";s+=LDAProvenanceMode;f+='<div class="'+s+'">'+t.organism+'</div><br><a href="'+t.item+'" target="_blank"><img src="'+r+'" height="15" width="15"/></a>'});return f}return'<div class="'+o+'">'+d+'</div><br><a href="'+e.data[p]+'" target="_blank"><img src="'+n+'" height="15" width="15"/></a>'}else{return'<div class="'+o+'">'+d+"</div>"}}}else{if(this.columns[g].dataIndex=="targets"){var b="";Ext.each(d,function(r,q){b+=r.title;b+="<br><br>"});return"<div>"+b+"</div>"}else{if(this.columns[g].dataIndex=="target_organisms"){var h="";Ext.each(d,function(r,q){h+=r.organism;h+="<br><br>"});return"<div>"+h+"</div>"}}return d}return d}Ext.define("LDA.model.FilterActivityModel",{extend:"Ext.data.Model",fields:["activity_type","about"]});Ext.define("LDA.store.FilterActivityStore",{extend:"LDA.store.basestores.BaseStore",model:"LDA.model.FilterActivityModel",storeId:"FilterActivityStore",BASE_URL:ldaBaseUrl+"/pharmacology/filters/activities?",constructor:function(a,b){console.log("LDA.store.FilterActivityStore: constructor()");this.proxy.reader=Ext.create("LDA.helper.FilterActivityReader");this.callParent(b)}});Ext.define("LSP.controller.PharmByTargetNameForm",{extend:"LSP.controller.grids.DynamicGrid",views:["pharm_by_target_name2.PharmByTargetNameForm","pharm_by_target_name2.PharmByTargetNameScrollingGrid"],refs:[{ref:"gridView",selector:"#pharmByTargetNameGrid"},{ref:"formView",selector:"PharmByTargetNameForm"},{ref:"lookup",selector:"conceptWikiProteinLookup"},{ref:"submitButton",selector:"#pharmByTargetSubmit_id"},{ref:"filterContainer",selector:"PharmByTargetNameForm #filterSelectorContainer_id"},{ref:"unitsCombo",selector:"PharmByTargetNameForm #unit_combobox_id"},{ref:"tsvDownloadButton",selector:"PharmByTargetNameForm #tsvDownloadProxy_id"}],filters:undefined,current_uri:undefined,init:function(){console.log("PharmByTargetNameForm: init()");this.control({"PharmByTargetNameForm button[action=query_pharm_by_target_name]":{click:this.submitQuery},"PharmByTargetNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},PharmByTargetNameForm:{afterrender:this.prepGrid,historyToken:this.handleHistoryToken},"PharmByTargetNameForm button[action=add_filter_form]":{click:this.addFilterForm},"PharmByTargetNameForm button[action=add_completed_organism_filter]":{click:this.addCompletedOrganismFilter},"PharmByTargetNameForm button[action=add_completed_activity_filter]":{click:this.addCompletedActivityFilter},"PharmByTargetNameForm button[action=add_completed_target_organism_filter]":{click:this.addCompletedTargetOrganismFilter},"PharmByTargetNameForm #provId":{change:this.onProvChange},"PharmByTargetNameForm #activity_combobox_id":{select:this.comboSelect,scope:this},"PharmByTargetNameForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},comboSelect:function(g,b,d){var f=b[0].get("about");var e=this;if(this.current_activity_combo_select!=f){var c=this.getUnitsCombo().getStore();this.getUnitsCombo().clearValue();c.removeAll();this.current_activity_combo_select=f;this.getUnitsCombo().setLoading("Fetching units...");var a=Ext.create("LDA.store.FilterUnitsStore",{activity_type:f});a.load(function(j,h,k){store_records=j;store_operation=h;store_success=h.success;if(store_success){Ext.each(j,function(l,m){unit_abbr=LDA.helper.LDAConstants.LDAUnits[l.data.unit];unit_abbr==null?unit_abbr="unknown abbreviation":"";unit=Ext.create("LSP.model.Unit",{unit:l.data.unit+" ("+unit_abbr+")",name:l.data.unit});c.add(unit)})}e.getUnitsCombo().setLoading(false)})}},handleHistoryToken:function(b){if(b.u){var d=this.getGridView();var a=d.store;if(b.u!=a.proxy.extraParams.uri){var f=this.getController("CW.controller.ConceptWikiLookup");var e=this.getFormView().down("conceptWikiLookup");f.setConcept(b.u,e,a);this.current_uri=b.u;a.proxy.extraParams.uri=b.u;a.proxy.reader.uri=b.u;d.setLoading(true);this.fetchTotalResults()}}else{if(b.s){var c=this.getLookup();c.setRawValue(b.s);c.doQuery(b.s)}}},getCountStore:function(){return Ext.create("LDA.store.TargetPharmacologyCountStore")},submitQuery:function(c){var e=this.getGridView();var b=e.store;b.sort_column=undefined;var d=c.up("form");c.disable();var a=d.getValues();if(this.current_uri==a.protein_uri){b.proxy.extraParams.uri=this.current_uri;b.proxy.reader.uri=this.current_uri;e.setLoading(true);this.fetchTotalResults()}else{Ext.History.add("!p=PharmByTargetNameForm&u="+a.protein_uri)}}});Ext.define("LDA.helper.FilterActivityReader",{extend:"Ext.data.reader.Json",requires:["LDA.helper.LDAConstants"],readRecords:function(b){var d=b.result["primaryTopic"];var c=d.normalised_activity_type;var a=new Array();Ext.each(c,function(h,g){var k=h[LDA.helper.LDAConstants.LDA_ABOUT];var j=k.split("/");var l=j[j.length-1].substr(1);var f=h[LDA.helper.LDAConstants.LDA_LABEL];var e=Ext.create("LDA.model.FilterActivityModel",{activity_type:f,about:l});a.push(e)});return new Ext.data.ResultSet({total:a.length,count:a.length,records:a,success:true,message:"loaded"})}});var activity_type=Ext.create("LDA.store.FilterActivityStore",{});var condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});var unit=Ext.create("Ext.data.Store",{fields:["unit","name"]});Ext.define("LSP.view.filter.ActivityFilterForm",{extend:"Ext.container.Container",alias:"widget.ActivityFilterForm",closable:true,layout:{type:"hbox"},refs:[{ref:"activity_combobox",selector:"#activity_combobox_id"},{ref:"conditions_combobox",selector:"#conditions_combobox_id"},{ref:"value_textfield",selector:"#value_textfield_id"},],headerPosition:"right",frame:true,padding:"0 0 5 0",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:activity_type,queryMode:"remote",displayField:"activity_type",valueField:"activity_type",labelWidth:100,labelPad:2,padding:"0 2 0 0"},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0"},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0"},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0"},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]});Ext.define("LSP.model.Organism",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"abbr",type:"string"}]});var assay_organism=Ext.create("Ext.data.Store",{model:"LSP.model.Organism",proxy:{type:"ajax",url:"/core_api_calls/organisms.json",model:"LSP.model.Organism",reader:{type:"json"}}});Ext.define("LSP.view.filter.OrganismFilterForm",{extend:"Ext.container.Container",alias:"widget.OrganismFilterForm",closable:true,layout:{type:"hbox"},refs:[{ref:"organism_combobox",selector:"#organism_combobox_id"},{ref:"organism_textfield",selector:"#organism_textfield_id"}],headerPosition:"right",frame:true,padding:"0 0 5 0",items:[{xtype:"combobox",itemId:"organism_combobox_id",fieldLabel:"Assay Organism",store:assay_organism,queryMode:"remote",displayField:"abbr",valueField:"name",labelWidth:100,width:400,labelPad:2,padding:"0 2 0 0",emptyText:"Enter the name of an assay organism...",minChars:3,hideTrigger:true,listConfig:{emptyText:"No organisms found which match your text, try entering some different text."}},{xtype:"button",itemId:"addCompletedOrganismFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this organism filter",action:"add_completed_organism_filter"}]});Ext.define("LSP.view.Enzymetree",{extend:"Ext.tree.Panel",alias:"widget.enzymeTree",requires:["Ext.data.*","Ext.grid.*","Ext.tree.*"],singleExpand:true,multiSelect:false,rootVisible:false,useArrows:true,frame:true,height:550,autoScroll:true,columns:[{xtype:"treecolumn",text:"EC number",sortable:true,dataIndex:"ec_number",width:160},{text:"Enzyme family name",dataIndex:"name",width:290}],initComponent:function(){console.log("EnzymeTree: initComponent()");var a={store:{fields:[{name:"ec_number",type:"string",sortDir:"ASC"},{name:"name",type:"string"}],proxy:{type:"ajax",api:{read:"enzymes.json"},reader:{type:"json",root:"objects",totalProperty:"totalCount"}},sorters:[{property:"ec_number",direction:"ASC"}],sortOnLoad:true}};Ext.apply(this,a);Ext.apply(this.initialConfig,a);this.callParent(arguments)}});var compound_condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});Ext.define("LSP.view.pharm_by_cmpd_name2.PharmByCmpdNameForm",{extend:"Ext.form.Panel",alias:"widget.PharmByCmpdNameForm",closable:true,requires:["LSP.view.filter.ActivityFilterForm","LSP.view.filter.OrganismFilterForm","LSP.view.filter.TargetOrganismFilterForm"],header:false,layout:{type:"vbox",align:"stretch"},invalidateScrollerOnRefresh:false,disableSelection:true,initComponent:function(){console.log("PharmByCmpdNameForm: initComponent()");this.items=[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Type in compound name. E.g. "Aspirin" and select a result</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{name:"cmpd_uuid",xtype:"hidden",value:""},Ext.create("CW.view.ConceptWikiLookup",{xtype:"conceptWikiLookup",fieldLabel:"Compound name",itemId:"pharmByCompoundCWLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),noCache:false,limitParam:undefined,startParam:undefined,pageParam:undefined,callbackKey:"_callback",extraParams:{_format:"json",branch:4,app_id:app_id,app_key:app_key}}}),name:"compound_uri",cwTagUuid:"07a84994-e464-4bbf-812a-a4b96fa3d197"}),{xtype:"button",itemId:"pharmByCmpdSubmit_id",padding:"5 5 5 5",text:"Search...",disabled:true,action:"query_pharm_by_cmpd_name"}]},{xtype:"container",margin:"0 5 5 5",name:"filter_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{xtype:"button",itemId:"addFilterButton_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Show or hide filter selector",action:"add_filter_form"},{xtype:"label",forId:"addFilterButton_id",text:"Filter",margin:"5 5 5 5"},{xtype:"radiogroup",width:200,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 65",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"container",margin:"0 5 5 5",name:"filter_selector_container",itemId:"filterSelectorContainer_id",hidden:true,layout:{type:"vbox"},style:"background-color: #fff;",items:[{xtype:"container",margin:"0 5 5 5",name:"activity_selector_container",itemId:"activitySelectorContainer_id",hidden:false,layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:Ext.create("LDA.store.FilterActivityStore",{}),queryMode:"remote",queryParam:false,displayField:"activity_type",valueField:"about",labelWidth:100,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:compound_condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0",emptyText:"Enter a value..."},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0",emptyText:"Use drop down...",editable:false},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]},{xtype:"OrganismFilterForm",itemId:"organismFilterContainer_id",margin:"0 5 5 5",name:"organism_filter_fields",hidden:false},{xtype:"TargetOrganismFilterForm",itemId:"targetOrganismFilterContainer_id",margin:"0 5 5 5",name:"target_organism_filter_fields",hidden:false}]},{xtype:"container",itemId:"completedFilterContainer_id",margin:"0 5 5 5",name:"completed_filter_container",hidden:true},{xtype:"PharmByCmpdNameScrollingGrid",itemId:"pharmByCmpdNameGrid",title:"Pharmacology by Compound name search results",gridBaseTitle:"Pharmacology by Compound name search results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.controller.PharmByCmpdNameForm",{extend:"LSP.controller.grids.DynamicGrid",views:["pharm_by_cmpd_name2.PharmByCmpdNameForm","pharm_by_cmpd_name2.PharmByCmpdNameScrollingGrid"],refs:[{ref:"gridView",selector:"#pharmByCmpdNameGrid"},{ref:"formView",selector:"PharmByCmpdNameForm"},{ref:"submitButton",selector:"#pharmByCmpdSubmit_id"},{ref:"nextRecordsButton",selector:"PharmByCmpdNameForm dynamicgrid3 #nextRecords"},{ref:"lookup",selector:"PharmByCmpdNameForm #pharmByCompoundCWLookup"},{ref:"filterContainer",selector:"PharmByCmpdNameForm #filterSelectorContainer_id"},{ref:"unitsCombo",selector:"PharmByCmpdNameForm #unit_combobox_id"},{ref:"tsvDownloadButton",selector:"PharmByCmpdNameForm #tsvDownloadProxy_id"}],filters:undefined,current_uri:undefined,current_activity_combo_select:undefined,init:function(){console.log("PharmByCmpdNameForm: init()");this.control({"PharmByCmpdNameForm button[action=query_pharm_by_cmpd_name]":{click:this.submitQuery},"PharmByCmpdNameForm conceptWikiLookup":{select:this.enableSubmit,matchingconcept:this.enableSubmit},PharmByCmpdNameForm:{historyToken:this.handleHistoryToken,afterrender:this.prepGrid},"PharmByCmpdNameForm button[action=add_filter_form]":{click:this.addFilterForm},"PharmByCmpdNameForm button[action=add_completed_organism_filter]":{click:this.addCompletedOrganismFilter},"PharmByCmpdNameForm button[action=add_completed_activity_filter]":{click:this.addCompletedActivityFilter},"PharmByCmpdNameForm button[action=add_completed_target_organism_filter]":{click:this.addCompletedTargetOrganismFilter},"PharmByCmpdNameForm #provId":{change:this.onProvChange},"PharmByCmpdNameForm #activity_combobox_id":{select:this.comboSelect,scope:this},"PharmByCmpdNameForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},comboSelect:function(g,b,d){var f=b[0].get("about");var e=this;if(this.current_activity_combo_select!=f){var c=this.getUnitsCombo().getStore();this.getUnitsCombo().clearValue();c.removeAll();this.current_activity_combo_select=f;var a=Ext.create("LDA.store.FilterUnitsStore",{activity_type:f});this.getUnitsCombo().setLoading("Fetching units...");a.load(function(j,h,k){store_records=j;store_operation=h;store_success=h.success;if(store_success){Ext.each(j,function(l,m){unit_abbr=LDA.helper.LDAConstants.LDAUnits[l.data.unit];unit_abbr==null?unit_abbr="unknown abbreviation":"";unit=Ext.create("LSP.model.Unit",{unit:l.data.unit+" ("+unit_abbr+")",name:l.data.unit});c.add(unit)})}e.getUnitsCombo().setLoading(false)})}},prepCSVFile:function(a){console.log("PharmByCmpdNameForm: prepCSVFile()");this.callParent(a)},handleHistoryToken:function(b){console.log("PharmByCmpdNameForm: handleHistoryToken()");if(b.u){var d=this.getGridView();var a=d.store;if(b.u!=a.proxy.extraParams.uri){var f=this.getController("CW.controller.ConceptWikiLookup");var e=this.getFormView().down("conceptWikiLookup");f.setConcept(b.u,e,a);console.log("blah "+f);console.log("blah 2 "+e);this.current_uri=b.u;a.proxy.extraParams.uri=b.u;a.proxy.reader.uri=b.u;d.setLoading(true);this.fetchTotalResults()}}else{if(b.s){var c=this.getLookup();c.setRawValue(b.s);c.doQuery(b.s)}}},getCountStore:function(){return Ext.create("LDA.store.CompoundPharmacologyCountStore")},submitQuery:function(c){console.log("PharmByCmpdNameForm: submitQuery()");var e=this.getGridView();var b=e.store;b.sort_column=undefined;var d=c.up("form");c.disable();var a=d.getValues();if(this.current_uri==a.compound_uri){b.proxy.extraParams.uri=this.current_uri;b.proxy.reader.uri=this.current_uri;e.setLoading(true);this.fetchTotalResults()}else{Ext.History.add("!p=PharmByCmpdNameForm&u="+a.compound_uri)}}});Ext.define("LSP.view.tree_selector_forms.EnzymeTreeForm",{extend:"Ext.window.Window",alias:"widget.EnzymeTreeForm",requires:["Ext.form.Panel","LSP.view.Enzymetree"],title:"Select an enzyme family",layout:"fit",modal:true,autoShow:true,height:600,width:500,items:[{xtype:"form",padding:"0 0 0 0",border:false,style:"background-color: #fff;",items:[{xtype:"enzymeTree"}]}],buttons:[{text:"Use selection",action:"get_enzyme"},{text:"Cancel",action:"hide_enzyme_form"}],initComponent:function(){console.log("EnzymeTreeForm: initComponent()");this.callParent(arguments)}});var enzyme_condition=Ext.create("Ext.data.Store",{fields:["symbol","name"],data:[{symbol:"=",name:"="},{symbol:">",name:">"},{symbol:"<",name:"<"},{symbol:"<=",name:"<="},{symbol:">=",name:">="}]});Ext.define("LSP.view.pharm_by_enzyme_family.PharmEnzymeForm",{extend:"Ext.form.Panel",alias:"widget.PharmEnzymeForm",closable:true,header:false,requires:["LSP.view.tree_selector_forms.EnzymeTreeForm","LSP.view.dynamicgrid.DynamicGrid"],layout:{type:"vbox",align:"stretch"},initComponent:function(){console.log("PharmEnzymeForm: initComponent()");this.items=[{xtype:"container",height:34,name:"form_fields",layout:{type:"column"},items:[{xtype:"displayfield",name:"enzyme_family",margin:"5 5 5 5",width:400,value:"No enzyme class selected - press button ->",fieldLabel:"Enzyme family class",labelWidth:130},{xtype:"button",padding:"5 5 5 5",margin:"5 5 5 5",text:"Browse EC codes",action:"enz_tree"},{name:"enz_name",xtype:"hidden",value:""},{name:"ec_number",xtype:"hidden",value:""}]},{xtype:"button",action:"query",margin:"5 0 0 320",maxWidth:300,itemId:"submitEnzymePharm_id",text:"Start search...",disabled:true},{xtype:"container",margin:"0 5 5 5",name:"filter_fields",layout:{type:"column"},style:"background-color: #fff;",items:[{xtype:"button",itemId:"addFilterButton_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Show or hide filter selector",action:"add_filter_form"},{xtype:"label",forId:"addFilterButton_id",text:"Filter",margin:"5 5 5 5"},{xtype:"radiogroup",width:200,fieldLabel:"Provenance",itemId:"provId",margin:"5 5 5 65",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]},{xtype:"button",name:"provHelp",margin:"5 0 0 0",iconCls:"provenanceHelpIcon",tooltip:'Provenance Datasources <br><br><p class="conceptWikiValueColour"> - ConceptWiki </p> <br><p class="chemspiderValueColour"> - ChemSpider </p><br><p class="drugbankValueColour"> - Drugbank </p><br><p class="chemblValueColour"> - Chembl</p>'}]},{xtype:"container",margin:"0 5 5 5",name:"filter_selector_container",itemId:"filterSelectorContainer_id",hidden:true,layout:{type:"vbox"},style:"background-color: #fff;",items:[{xtype:"container",margin:"0 5 5 5",name:"activity_selector_container",itemId:"activitySelectorContainer_id",hidden:false,layout:{type:"hbox"},style:"background-color: #fff;",items:[{xtype:"combobox",itemId:"activity_combobox_id",fieldLabel:"Activity Type",store:Ext.create("LDA.store.FilterActivityStore",{}),queryMode:"remote",displayField:"activity_type",valueField:"about",labelWidth:100,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"combobox",itemId:"conditions_combobox_id",fieldLabel:"Conditions",store:enzyme_condition,queryMode:"local",displayField:"symbol",valueField:"name",labelWidth:70,labelPad:2,padding:"0 2 0 0",emptyText:"Use drop down...",editable:false},{xtype:"textfield",itemId:"value_textfield_id",name:"value",fieldLabel:"Value",allowBlank:false,labelWidth:50,labelPad:2,padding:"0 2 0 0",emptyText:"Enter a value..."},{xtype:"combobox",itemId:"unit_combobox_id",fieldLabel:"Unit",store:Ext.create("Ext.data.Store",{model:"LSP.model.unit",fields:["unit","name"]}),queryMode:"local",displayField:"unit",valueField:"name",labelWidth:50,labelPad:2,padding:"0 10 0 0",emptyText:"Use drop down...",editable:false},{xtype:"button",itemId:"addCompletedActivityFilter_id",iconCls:"icon-new",padding:"5 5 5 5",tooltip:"Add this activity filter",action:"add_completed_activity_filter"}]},{xtype:"OrganismFilterForm",itemId:"organismFilterContainer_id",margin:"0 5 5 5",name:"organism_filter_fields",hidden:false},{xtype:"TargetOrganismFilterForm",itemId:"targetOrganismFilterContainer_id",margin:"0 5 5 5",name:"target_organism_filter_fields",hidden:false}]},{xtype:"container",itemId:"completedFilterContainer_id",margin:"0 5 5 5",name:"completed_filter_container",hidden:true},{xtype:"PharmByEnzymeFamilyScrollingGrid",itemId:"pharmByEnzymeFamilyGrid",title:"Pharmacology by Enzyme Family search results",gridBaseTitle:"Pharmacology by Enzyme Family search results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.controller.PharmByEnzymeFamily",{extend:"LSP.controller.grids.DynamicGrid",views:["pharm_by_enzyme_family.PharmEnzymeForm","pharm_by_enzyme_family.PharmByEnzymeFamilyScrollingGrid"],refs:[{ref:"gridView",selector:"#pharmByEnzymeFamilyGrid"},{ref:"formView",selector:"PharmEnzymeForm"},{ref:"submitButton",selector:"#submitEnzymePharm_id"},{ref:"filterContainer",selector:"PharmEnzymeForm #filterSelectorContainer_id"},{ref:"unitsCombo",selector:"PharmEnzymeForm #unit_combobox_id"},{ref:"tsvDownloadButton",selector:"PharmEnzymeForm #tsvDownloadProxy_id"}],filters:undefined,current_uri:undefined,init:function(){console.log("PharmByEnzymeFamily: init()");this.control({"PharmEnzymeForm button[action=enz_tree]":{click:this.launchEnzyme},"EnzymeTreeForm button[action=get_enzyme]":{click:this.getEnzyme},"EnzymeTreeForm button[action=hide_enzyme_form]":{click:this.hideEnzyme},"PharmEnzymeForm #submitEnzymePharm_id":{click:this.submitQuery},PharmEnzymeForm:{afterrender:this.prepGrid,historyToken:this.handleHistoryToken},"PharmEnzymeForm button[action=add_filter_form]":{click:this.addFilterForm},"PharmEnzymeForm button[action=add_completed_organism_filter]":{click:this.addCompletedOrganismFilter},"PharmEnzymeForm button[action=add_completed_target_organism_filter]":{click:this.addCompletedTargetOrganismFilter},"PharmEnzymeForm button[action=add_completed_activity_filter]":{click:this.addCompletedActivityFilter},"PharmEnzymeForm #provId":{change:this.onProvChange},"PharmEnzymeForm #activity_combobox_id":{select:this.comboSelect,scope:this},"PharmEnzymeForm #tsvDownloadProxy_id":{click:this.prepareTSVDownload}})},comboSelect:function(g,b,d){var f=b[0].get("about");var e=this;if(this.current_activity_combo_select!=f){var c=this.getUnitsCombo().getStore();this.getUnitsCombo().clearValue();c.removeAll();this.current_activity_combo_select=f;this.getUnitsCombo().setLoading("Fetching units...");var a=Ext.create("LDA.store.FilterUnitsStore",{activity_type:f});a.load(function(j,h,k){store_records=j;store_operation=h;store_success=h.success;if(store_success){Ext.each(j,function(l,m){unit_abbr=LDA.helper.LDAConstants.LDAUnits[l.data.unit];unit_abbr==null?unit_abbr="unknown abbreviation":"";unit=Ext.create("LSP.model.Unit",{unit:l.data.unit+" ("+unit_abbr+")",name:l.data.unit});c.add(unit)})}e.getUnitsCombo().setLoading(false)})}},handleHistoryToken:function(b){console.log("PharmByEnzymeFamily: handleHistoryToken()");if(b.ec){this.current_uri="http://purl.uniprot.org/enzyme/"+b.ec;var c=this.getGridView();var a=c.getStore();c.setLoading(true);a.proxy.extraParams.uri="http://purl.uniprot.org/enzyme/"+b.ec;a.proxy.reader.uri="http://purl.uniprot.org/enzyme/"+b.ec;this.fetchTotalResults()}},getCountStore:function(){return Ext.create("LDA.store.EnzymeFamilyCountStore")},launchEnzyme:function(b){console.log("PharmByEnzymeFamily: launchEnzyme()");var a=Ext.ComponentQuery.query("EnzymeTreeForm")[0];if(a){console.log("enzyme show");a.show()}else{console.log("enzyme create");a=Ext.widget("EnzymeTreeForm");a.show()}},hideEnzyme:function(b){console.log("PharmByEnzymeFamily: hideEnzyme()");var a=Ext.ComponentQuery.query("EnzymeTreeForm")[0];if(a){console.log("enzyme hide");a.hide()}},getEnzyme:function(d){console.log("PharmByEnzymeFamily: getEnzyme()");var b=d.up().up().down("enzymeTree");var e=b.getView().getSelectionModel().getSelection();var f=e[0].data;var a=this.getFormView().getForm().findField("enzyme_family");a.setValue("<b>"+f.ec_number+" : "+f.name+"</b>");var c=this.getFormView().getForm().findField("ec_number");c.setValue(f.ec_number);var g=this.getFormView().getForm().findField("enz_name");g.setValue(f.name);this.hideEnzyme("");this.getSubmitButton().enable();this.getGridView().getStore().setTypeName(f.name)},submitQuery:function(c){console.log("PharmByEnzymeFamily: submitQuery()");var e=this.getGridView();var b=e.store;b.sort_column=undefined;var d=c.up("form");c.disable();var a=d.getValues();if(this.current_uri=="http://purl.uniprot.org/enzyme/"+a.ec_number){b.proxy.extraParams.uri=this.current_uri;b.proxy.reader.uri=this.current_uri;e.setLoading(true);this.fetchTotalResults()}else{Ext.History.add("!p=PharmEnzymeForm&ec="+a.ec_number)}}});(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function b(e){e=e.replace(/\r\n/g,"\n");var d="";for(var g=0;g<e.length;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f)}else{if((f>127)&&(f<2048)){d+=String.fromCharCode((f>>6)|192);d+=String.fromCharCode((f&63)|128)}else{d+=String.fromCharCode((f>>12)|224);d+=String.fromCharCode(((f>>6)&63)|128);d+=String.fromCharCode((f&63)|128)}}}return d}Ext.define("Ext.ux.exporter.Base64",{statics:{encode:function(e){var c="";var m,k,h,l,j,g,f;var d=0;e=b(e);while(d<e.length){m=e.charCodeAt(d++);k=e.charCodeAt(d++);h=e.charCodeAt(d++);l=m>>2;j=((m&3)<<4)|(k>>4);g=((k&15)<<2)|(h>>6);f=h&63;if(isNaN(k)){g=f=64}else{if(isNaN(h)){f=64}}c=c+a.charAt(l)+a.charAt(j)+a.charAt(g)+a.charAt(f)}return c}}})})();Ext.define("Ext.ux.exporter.Button",{extend:"Ext.Component",alias:"widget.exporterbutton",html:"<p></p>",config:{swfPath:"/flash/downloadify.swf",downloadImage:"/images/ext_reports/download.png",width:62,height:22,downloadName:"download"},constructor:function(b){b=b||{};this.initConfig();Ext.ux.exporter.Button.superclass.constructor.call(this,b);var a=this;this.on("afterrender",function(){a.setComponent(a.store||a.component||a.up("gridpanel")||a.up("treepanel"),b)})},setComponent:function(b,a){this.component=b;this.store=!b.is?b:b.getStore();this.setDownloadify(a)},setDownloadify:function(b){var a=this;Downloadify.create(this.el.down("p").id,{filename:function(){return a.getDownloadName()+"."+Ext.ux.exporter.Exporter.getFormatterByName(a.formatter).extension},data:function(){return Ext.ux.exporter.Exporter.exportAny(a.component,a.formatter,b)},onComplete:function(){alert("Your File Has Been Saved!")},onCancel:function(){alert("You have cancelled the saving of this file.")},onError:function(){alert("You must put something in the File Contents or there will be nothing to save!")},transparent:false,swf:this.getSwfPath(),downloadImage:this.getDownloadImage(),width:this.getWidth(),height:this.getHeight(),transparent:true,append:true})}});Ext.define("Ext.ux.grid.menu.RangeMenu",{extend:"Ext.menu.Menu",fieldCls:"Ext.form.field.Number",itemIconCls:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq"},fieldLabels:{gt:"Greater Than",lt:"Less Than",eq:"Equal To"},menuItemCfgs:{emptyText:"Enter Number...",selectOnFocus:false,width:155},menuItems:["lt","gt","-","eq"],constructor:function(a){var f=this,c,g,b,e,h,d,j;f.callParent(arguments);c=f.fields=f.fields||{};g=f.fieldCfg=f.fieldCfg||{};f.addEvents("update");f.updateTask=Ext.create("Ext.util.DelayedTask",f.fireUpdate,f);for(b=0,e=f.menuItems.length;b<e;b++){h=f.menuItems[b];if(h!=="-"){d={itemId:"range-"+h,enableKeyEvents:true,hideLabel:false,fieldLabel:f.iconTpl.apply({cls:f.itemIconCls[h]||"no-icon",text:f.fieldLabels[h]||"",src:Ext.BLANK_IMAGE_URL}),labelSeparator:"",labelWidth:29,labelStyle:"position: relative;",listeners:{scope:f,change:f.onInputChange,keyup:f.onInputKeyUp,el:{click:function(k){k.stopPropagation()}}},activate:Ext.emptyFn,deactivate:Ext.emptyFn};Ext.apply(d,Ext.applyIf(c[h]||{},g[h]),f.menuItemCfgs);j=d.fieldCls||f.fieldCls;h=c[h]=Ext.create(j,d)}f.add(h)}},fireUpdate:function(){this.fireEvent("update",this)},getValue:function(){var a={},b,c;for(b in this.fields){c=this.fields[b];if(c.isValid()&&c.getValue()!==null){a[b]=c.getValue()}}return a},setValue:function(c){var b=this,a,d;for(a in b.fields){d=b.fields[a];d.suspendEvents();d.setValue(a in c?c[a]:"");d.resumeEvents()}b.fireEvent("update",b)},onInputKeyUp:function(b,a){if(a.getKey()===a.RETURN&&b.isValid()){a.stopEvent();this.hide()}},onInputChange:function(f){var e=this,c=e.fields,b=c.eq,d=c.gt,a=c.lt;if(f==b){if(d){d.setValue(null)}if(a){a.setValue(null)}}else{b.setValue(null)}this.updateTask.delay(this.updateBuffer)}},function(){this.prototype.iconTpl=Ext.create("Ext.XTemplate",'<img src="{src}" alt="{text}" class="'+Ext.baseCSSPrefix+'menu-item-icon ux-rangemenu-icon {cls}" />')});Ext.define("Ext.ux.grid.menu.ListMenu",{extend:"Ext.menu.Menu",labelField:"text",loadingText:"Loading...",loadOnShow:true,single:false,constructor:function(b){var e=this,c,d,a,f;e.selected=[];e.addEvents("checkchange");e.callParent([b=b||{}]);if(!b.store&&b.options){c=[];for(d=0,a=b.options.length;d<a;d++){f=b.options[d];switch(Ext.type(f)){case"array":c.push(f);break;case"object":c.push([f.id,f[e.labelField]]);break;case"string":c.push([f,f]);break}}e.store=Ext.create("Ext.data.ArrayStore",{fields:["id",e.labelField],data:c,listeners:{load:e.onLoad,scope:e}});e.loaded=true;e.autoStore=true}else{e.add({text:e.loadingText,iconCls:"loading-indicator"});e.store.on("load",e.onLoad,e)}},destroy:function(){var b=this,a=b.store;if(a){if(b.autoStore){a.destroyStore()}else{a.un("unload",b.onLoad,b)}}b.callParent()},show:function(){if(this.loadOnShow&&!this.loaded&&!this.store.loading){this.store.load()}this.callParent()},onLoad:function(c,b){var g=this,f,h,d,a,e={checkchange:g.checkChange,scope:g};Ext.suspendLayouts();g.removeAll(true);f=g.single?Ext.id():null;for(d=0,a=b.length;d<a;d++){h=b[d].get("id");g.add(Ext.create("Ext.menu.CheckItem",{text:b[d].get(g.labelField),group:f,checked:Ext.Array.contains(g.selected,h),hideOnClick:false,value:h,listeners:e}))}g.loaded=true;Ext.resumeLayouts(true);g.fireEvent("load",g,b)},getSelected:function(){return this.selected},setSelected:function(a){a=this.selected=[].concat(a);if(this.loaded){this.items.each(function(d){d.setChecked(false,true);for(var c=0,b=a.length;c<b;c++){if(d.value==a[c]){d.setChecked(true,true)}}},this)}},checkChange:function(b,a){var c=[];this.items.each(function(d){if(d.checked){c.push(d.value)}},this);this.selected=c;this.fireEvent("checkchange",b,a)}});Ext.define("Ext.ux.exporter.Formatter",{format:Ext.emptyFn,constructor:function(a){a=a||{};Ext.applyIf(a,{})}});Ext.define("Ext.ux.grid.filter.Filter",{extend:"Ext.util.Observable",active:false,dataIndex:null,menu:null,updateBuffer:500,constructor:function(a){Ext.apply(this,a);this.addEvents("activate","deactivate","serialize","update");Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=this.createMenu(a);this.init(a);if(a&&a.value){this.setValue(a.value);this.setActive(a.active!==false,true);delete a.value}},destroy:function(){if(this.menu){this.menu.destroy()}this.clearListeners()},init:Ext.emptyFn,createMenu:function(a){return Ext.create("Ext.menu.Menu",a)},getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return true},getSerialArgs:Ext.emptyFn,validateRecord:function(){return true},serialize:function(){var a=this.getSerialArgs();this.fireEvent("serialize",a,this);return a},fireUpdate:function(){if(this.active){this.fireEvent("update",this)}this.setActive(this.isActivatable())},setActive:function(b,a){if(this.active!=b){this.active=b;if(a!==true){this.fireEvent(b?"activate":"deactivate",this)}}}});Ext.define("Ext.ux.exporter.sdfFormatter.SdfFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/plain;base64,",extension:"sdf",format:function(b,c){var d=this;var a=[];b.each(function(e,f){if(e.molfile!==undefined){a.push(this.buildRecord(c.columns,e,e.molfile))}},this);return a.join("\n")+"\n"},buildRecord:function(c,e,b){var d=[];var a=e.data.csid;Ext.each(c,function(g){var f=">  <";if(!g.hidden&&g.text!="&#160"){var j=e.data[g.dataIndex];if(j.text!==undefined){j=j.text}var k=this.stripTags(j);var h=this.escapeTextSeperator(k);f=f+this.stripTags(g.text)+"> ("+a+")\n";f=f+h+"\n";if(h!==""){d.push(f)}}},this);return b+d.join("\n")+"\n$$$$"},stripTags:function(b){if(typeof(b)==="string"){b=b.replace(/<(.|\n)*?>/gi,"")}var a=document.createElement("textarea");a.innerHTML=b;return a.value},escapeTextSeperator:function(b){if(typeof(b)==="string"){b=b.replace(/"/gi,'""')}var a=document.createElement("textarea");a.innerHTML=b;return a.value}});Ext.define("Ext.ux.exporter.excelFormatter.ExcelFormatter",{extend:"Ext.ux.exporter.Formatter",uses:["Ext.ux.exporter.excelFormatter.Cell","Ext.ux.exporter.excelFormatter.Style","Ext.ux.exporter.excelFormatter.Worksheet","Ext.ux.exporter.excelFormatter.Workbook"],contentType:"data:application/vnd.ms-excel;base64,",extension:"xls",format:function(b,c){var a=new Ext.ux.exporter.excelFormatter.Workbook(c);a.addWorksheet(b,c||{});return a.render()}});Ext.define("Ext.ux.exporter.csvFormatter.CsvFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/csv;base64,",separator:"\t",extension:"csv",format:function(a,b){this.columns=b.columns||(a.fields?a.fields.items:a.model.prototype.fields.items);return this.getHeaders()+"\n"+this.getRows(a)},getHeaders:function(a){var b=[],c;Ext.each(this.columns,function(d){var e;if(d.text!=undefined){e=d.text}else{if(d.name){e=d.name.replace(/_/g," ");e=Ext.String.capitalize(e)}}if(d.text!="&#160"){b.push(e)}},this);return b.join(this.separator)},getRows:function(a){var b=[];a.each(function(c,d){b.push(this.geCell(c,d))},this);return b.join("\n")},geCell:function(a,c){var b=[];Ext.each(this.columns,function(e){var d=e.name||e.dataIndex;if(d){if(Ext.isFunction(e.renderer)){var f=e.renderer(a.get(d),null,a)}else{var f=a.get(d)}b.push(f)}});return b.join(this.separator)}});Ext.define("Ext.ux.grid.filter.BooleanFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.boolean",defaultValue:false,yesText:"Yes",noText:"No",init:function(a){var c=Ext.id();this.options=[Ext.create("Ext.menu.CheckItem",{text:this.yesText,group:c,checked:this.defaultValue===true}),Ext.create("Ext.menu.CheckItem",{text:this.noText,group:c,checked:this.defaultValue===false})];this.menu.add(this.options[0],this.options[1]);for(var b=0;b<this.options.length;b++){this.options[b].on("click",this.fireUpdate,this);this.options[b].on("checkchange",this.fireUpdate,this)}},getValue:function(){return this.options[0].checked},setValue:function(a){this.options[a?0:1].setChecked(true)},getSerialArgs:function(){var a={type:"boolean",value:this.getValue()};return a},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue()}});Ext.define("Ext.ux.grid.filter.DateFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.date",uses:["Ext.picker.Date","Ext.menu.Menu"],afterText:"After",beforeText:"Before",compareMap:{before:"lt",after:"gt",on:"eq"},dateFormat:"m/d/Y",menuItems:["before","after","-","on"],menuItemCfgs:{selectOnFocus:true,width:125},onText:"On",pickerOpts:{},init:function(d){var g=this,c,e,a,f,b;c=Ext.apply(g.pickerOpts,{xtype:"datepicker",minDate:g.minDate,maxDate:g.maxDate,format:g.dateFormat,listeners:{scope:g,select:g.onMenuSelect}});g.fields={};for(e=0,a=g.menuItems.length;e<a;e++){f=g.menuItems[e];if(f!=="-"){b={itemId:"range-"+f,text:g[f+"Text"],menu:Ext.create("Ext.menu.Menu",{items:[Ext.apply(c,{itemId:f,listeners:{select:g.onPickerSelect,scope:g}}),]}),listeners:{scope:g,checkchange:g.onCheckChange}};f=g.fields[f]=Ext.create("Ext.menu.CheckItem",b)}g.menu.add(f)}g.values={}},onCheckChange:function(e,d){var c=this,b=e.menu.items.first(),f=b.itemId,a=c.values;if(d){a[f]=b.getValue()}else{delete a[f]}c.setActive(c.isActivatable());c.fireEvent("update",c)},onInputKeyUp:function(c,b){var a=b.getKey();if(a==b.RETURN&&c.isValid()){b.stopEvent();this.menu.hide()}},onMenuSelect:function(c,b){var a=this.fields,d=this.fields[c.itemId];d.setChecked(true);if(d==a.on){a.before.setChecked(false,true);a.after.setChecked(false,true)}else{a.on.setChecked(false,true);if(d==a.after&&this.getFieldValue("before")<b){a.before.setChecked(false,true)}else{if(d==a.before&&this.getFieldValue("after")>b){a.after.setChecked(false,true)}}}this.fireEvent("update",this);c.up("menu").hide()},getValue:function(){var b,a={};for(b in this.fields){if(this.fields[b].checked){a[b]=this.getFieldValue(b)}}return a},setValue:function(c,b){var a;for(a in this.fields){if(c[a]){this.getPicker(a).setValue(c[a]);this.fields[a].setChecked(true)}else{if(!b){this.fields[a].setChecked(false)}}}this.fireEvent("update",this)},isActivatable:function(){var a;for(a in this.fields){if(this.fields[a].checked){return true}}return false},getSerialArgs:function(){var a=[];for(var b in this.fields){if(this.fields[b].checked){a.push({type:"date",comparison:this.compareMap[b],value:Ext.Date.format(this.getFieldValue(b),this.dateFormat)})}}return a},getFieldValue:function(a){return this.values[a]},getPicker:function(a){return this.fields[a].menu.items.first()},validateRecord:function(b){var c,e,d=b.get(this.dataIndex),a=Ext.Date.clearTime;if(!Ext.isDate(d)){return false}d=a(d,true).getTime();for(c in this.fields){if(this.fields[c].checked){e=a(this.getFieldValue(c),true).getTime();if(c=="before"&&e<=d){return false}if(c=="after"&&e>=d){return false}if(c=="on"&&e!=d){return false}}}return true},onPickerSelect:function(b,a){this.values[b.itemId]=a;this.fireEvent("update",this)}});Ext.define("Ext.ux.grid.filter.ListFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.list",phpMode:false,init:function(a){this.dt=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},createMenu:function(a){var b=Ext.create("Ext.ux.grid.menu.ListMenu",a);b.on("checkchange",this.onCheckChange,this);return b},getValue:function(){return this.menu.getSelected()},setValue:function(a){this.menu.setSelected(a);this.fireEvent("update",this)},isActivatable:function(){return this.getValue().length>0},getSerialArgs:function(){return{type:"list",value:this.phpMode?this.getValue().join(","):this.getValue()}},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(a){var b=this.getValue();return Ext.Array.indexOf(b,a.get(this.dataIndex))>-1}});Ext.define("Ext.ux.grid.filter.NumericFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.numeric",uses:["Ext.form.field.Number"],createMenu:function(a){var b=this,c;c=Ext.create("Ext.ux.grid.menu.RangeMenu",a);c.on("update",b.fireUpdate,b);return c},getValue:function(){return this.menu.getValue()},setValue:function(a){this.menu.setValue(a)},isActivatable:function(){var a=this.getValue(),b;for(b in a){if(a[b]!==undefined){return true}}return false},getSerialArgs:function(){var c,b=[],a=this.menu.getValue();for(c in a){b.push({type:"numeric",comparison:c,value:a[c]})}return b},validateRecord:function(a){var d=a.get(this.dataIndex),b=this.getValue(),c=Ext.isNumber;if(c(b.eq)&&d!=b.eq){return false}if(c(b.lt)&&d>=b.lt){return false}if(c(b.gt)&&d<=b.gt){return false}return true}});Ext.define("Ext.ux.grid.filter.StringFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.string",iconCls:"ux-gridfilter-text-icon",emptyText:"Enter Filter Text...",selectOnFocus:true,width:125,init:function(a){Ext.applyIf(a,{enableKeyEvents:true,iconCls:this.iconCls,hideLabel:true,listeners:{scope:this,keyup:this.onInputKeyUp,el:{click:function(b){b.stopPropagation()}}}});this.inputItem=Ext.create("Ext.form.field.Text",a);this.menu.add(this.inputItem);this.updateTask=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(a){this.inputItem.setValue(a);this.fireEvent("update",this)},isActivatable:function(){return this.inputItem.getValue().length>0},getSerialArgs:function(){return{type:"string",value:this.getValue()}},validateRecord:function(a){var b=a.get(this.dataIndex);if(typeof b!="string"){return(this.getValue().length===0)}return b.toLowerCase().indexOf(this.getValue().toLowerCase())>-1},onInputKeyUp:function(c,b){var a=b.getKey();if(a==b.RETURN&&c.isValid()){b.stopEvent();this.menu.hide();return}this.updateTask.delay(this.updateBuffer)}});Ext.define("Ext.ux.exporter.excelFormatter.Cell",{constructor:function(a){Ext.applyIf(a,{type:"String"});Ext.apply(this,a);Ext.ux.exporter.excelFormatter.Cell.superclass.constructor.apply(this,arguments)},render:function(){return this.tpl.apply(this)},tpl:new Ext.XTemplate('<ss:Cell ss:StyleID="{style}">','<ss:Data ss:Type="{type}"><![CDATA[{value}]]></ss:Data>',"</ss:Cell>")});Ext.define("Ext.ux.exporter.excelFormatter.Worksheet",{constructor:function(a,b){b=b||{};this.store=a;Ext.applyIf(b,{hasTitle:true,hasHeadings:true,stripeRows:true,title:"Workbook",columns:a.fields==undefined?{}:a.fields.items});Ext.apply(this,b);Ext.ux.exporter.excelFormatter.Worksheet.superclass.constructor.apply(this,arguments)},dateFormatString:"Y-m-d",worksheetTpl:new Ext.XTemplate('<ss:Worksheet ss:Name="{title}">',"<ss:Names>",'<ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\'{title}\'!R1:R2" />',"</ss:Names>",'<ss:Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="{colCount}" ss:ExpandedRowCount="{rowCount}">',"{columns}",'<ss:Row ss:Height="38">','<ss:Cell ss:StyleID="title" ss:MergeAcross="{colCount - 1}">','<ss:Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String">','<html:B><html:U><html:Font html:Size="15">{title}','</html:Font></html:U></html:B></ss:Data><ss:NamedCell ss:Name="Print_Titles" />',"</ss:Cell>","</ss:Row>",'<ss:Row ss:AutoFitHeight="1">',"{header}","</ss:Row>","{rows}","</ss:Table>","<x:WorksheetOptions>","<x:PageSetup>",'<x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" />','<x:Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" />','<x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" />',"</x:PageSetup>","<x:FitToPage />","<x:Print>","<x:PrintErrors>Blank</x:PrintErrors>","<x:FitWidth>1</x:FitWidth>","<x:FitHeight>32767</x:FitHeight>","<x:ValidPrinterInfo />","<x:VerticalResolution>600</x:VerticalResolution>","</x:Print>","<x:Selected />","<x:DoNotDisplayGridlines />","<x:ProtectObjects>False</x:ProtectObjects>","<x:ProtectScenarios>False</x:ProtectScenarios>","</x:WorksheetOptions>","</ss:Worksheet>"),render:function(a){return this.worksheetTpl.apply({header:this.buildHeader(),columns:this.buildColumns().join(""),rows:this.buildRows().join(""),colCount:this.columns.length,rowCount:this.store.getCount()+2,title:this.title})},buildColumns:function(){var a=[];Ext.each(this.columns,function(b){a.push(this.buildColumn())},this);return a},buildColumn:function(a){return Ext.String.format('<ss:Column ss:AutoFitWidth="1" ss:Width="{0}" />',a||164)},buildRows:function(){var a=[];this.store.each(function(b,c){a.push(this.buildRow(b,c))},this);return a},buildHeader:function(){var a=[];Ext.each(this.columns,function(b){var c;if(b.text!=undefined){c=b.text}else{if(b.name){c=b.name.replace(/_/g," ");c=Ext.String.capitalize(c)}}a.push(Ext.String.format('<ss:Cell ss:StyleID="headercell"><ss:Data ss:Type="String">{0}</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>',c))},this);return a.join("")},buildRow:function(a,c){var d,b=[];if(this.stripeRows===true){d=c%2==0?"even":"odd"}Ext.each(this.columns,function(f){var e=f.name||f.dataIndex;if(e){if(Ext.isFunction(f.renderer)){var h=f.renderer(a.get(e),null,a),g="String"}else{var h=a.get(e),g=this.typeMappings[f.type||a.fields.get(e).type.type]}b.push(this.buildCell(h,g,d).render())}},this);return Ext.String.format("<ss:Row>{0}</ss:Row>",b.join(""))},buildCell:function(c,b,a){if(b=="DateTime"&&Ext.isFunction(c.format)){c=c.format(this.dateFormatString)}return new Ext.ux.exporter.excelFormatter.Cell({value:c,type:b,style:a})},typeMappings:{"int":"Number",string:"String","float":"Number",date:"DateTime"}});Ext.define("Ext.ux.exporter.excelFormatter.Style",{constructor:function(a){a=a||{};Ext.apply(this,a,{parentStyle:"",attributes:[]});Ext.ux.exporter.excelFormatter.Style.superclass.constructor.apply(this,arguments);if(this.id==undefined){throw new Error("An ID must be provided to Style")}this.preparePropertyStrings()},preparePropertyStrings:function(){Ext.each(this.attributes,function(a,b){this.attributes[b].propertiesString=this.buildPropertyString(a);this.attributes[b].children=a.children||[];Ext.each(a.children,function(d,c){this.attributes[b].children[c].propertiesString=this.buildPropertyString(d)},this)},this)},buildPropertyString:function(b){var a="";Ext.each(b.properties||[],function(c){a+=Ext.String.format('ss:{0}="{1}" ',c.name,c.value)},this);return a},render:function(){return this.tpl.apply(this)},tpl:new Ext.XTemplate('<tpl if="parentStyle.length == 0">','<ss:Style ss:ID="{id}">',"</tpl>",'<tpl if="parentStyle.length != 0">','<ss:Style ss:ID="{id}" ss:Parent="{parentStyle}">',"</tpl>",'<tpl for="attributes">','<tpl if="children.length == 0">',"<ss:{name} {propertiesString} />","</tpl>",'<tpl if="children.length > 0">',"<ss:{name} {propertiesString}>",'<tpl for="children">',"<ss:{name} {propertiesString} />","</tpl>","</ss:{name}>","</tpl>","</tpl>","</ss:Style>")});Ext.define("Ext.ux.exporter.excelFormatter.Workbook",{constructor:function(a){a=a||{};Ext.apply(this,a,{title:"Workbook",worksheets:[],compiledWorksheets:[],cellBorderColor:"#e4e4e4",styles:[],compiledStyles:[],hasDefaultStyle:true,hasStripeStyles:true,windowHeight:9000,windowWidth:50000,protectStructure:false,protectWindows:false});if(this.hasDefaultStyle){this.addDefaultStyle()}if(this.hasStripeStyles){this.addStripedStyles()}this.addTitleStyle();this.addHeaderStyle()},render:function(){this.compileStyles();this.joinedCompiledStyles=this.compiledStyles.join("");this.compileWorksheets();this.joinedWorksheets=this.compiledWorksheets.join("");return this.tpl.apply(this)},addWorksheet:function(a,b){var c=new Ext.ux.exporter.excelFormatter.Worksheet(a,b);this.worksheets.push(c);return c},addStyle:function(a){var b=new Ext.ux.exporter.excelFormatter.Style(a||{});this.styles.push(b);return b},compileStyles:function(){this.compiledStyles=[];Ext.each(this.styles,function(a){this.compiledStyles.push(a.render())},this);return this.compiledStyles},compileWorksheets:function(){this.compiledWorksheets=[];Ext.each(this.worksheets,function(a){this.compiledWorksheets.push(a.render())},this);return this.compiledWorksheets},tpl:new Ext.XTemplate('<?xml version="1.0" encoding="utf-8"?>','<ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office">',"<o:DocumentProperties>","<o:Title>{title}</o:Title>","</o:DocumentProperties>","<ss:ExcelWorkbook>","<ss:WindowHeight>{windowHeight}</ss:WindowHeight>","<ss:WindowWidth>{windowWidth}</ss:WindowWidth>","<ss:ProtectStructure>{protectStructure}</ss:ProtectStructure>","<ss:ProtectWindows>{protectWindows}</ss:ProtectWindows>","</ss:ExcelWorkbook>","<ss:Styles>","{joinedCompiledStyles}","</ss:Styles>","{joinedWorksheets}","</ss:Workbook>"),addDefaultStyle:function(){var a=[{name:"Color",value:this.cellBorderColor},{name:"Weight",value:"1"},{name:"LineStyle",value:"Continuous"}];this.addStyle({id:"Default",attributes:[{name:"Alignment",properties:[{name:"Vertical",value:"Top"},{name:"WrapText",value:"1"}]},{name:"Font",properties:[{name:"FontName",value:"arial"},{name:"Size",value:"10"}]},{name:"Interior"},{name:"NumberFormat"},{name:"Protection"},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Top"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Bottom"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Left"}].concat(a)},{name:"Border",properties:[{name:"Position",value:"Right"}].concat(a)}]}]})},addTitleStyle:function(){this.addStyle({id:"title",attributes:[{name:"Borders"},{name:"Font"},{name:"NumberFormat",properties:[{name:"Format",value:"@"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"},{name:"Vertical",value:"Center"}]}]})},addHeaderStyle:function(){this.addStyle({id:"headercell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"10"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#A3C9F1"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"}]}]})},addStripedStyles:function(){this.addStyle({id:"even",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCFFFF"}]}]});this.addStyle({id:"odd",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCCCFF"}]}]});Ext.each(["even","odd"],function(a){this.addChildNumberFormatStyle(a,a+"date","[ENG][$-409]dd-mmm-yyyy;@");this.addChildNumberFormatStyle(a,a+"int","0");this.addChildNumberFormatStyle(a,a+"float","0.00")},this)},addChildNumberFormatStyle:function(a,c,b){this.addStyle({id:c,parentStyle:"even",attributes:[{name:"NumberFormat",properties:[{name:"Format",value:b}]}]})}});Ext.define("CS.view.CompoundWindow",{extend:"Ext.window.Window",alias:"widget.cs.compound.window",title:"ChemSpider compound details...",layout:{type:"table",columns:2},defaults:{frame:true,margin:"5 5 5 5"},autoScroll:true,modal:false,resizable:true,autoShow:false,closeAction:"hide",height:550,width:700,initComponent:function(){this.compoundInfo=Ext.create("CS.view.Compound",{title:"Properties",height:270,frame:true,colspan:2});this.synonyms=Ext.create("CS.view.Synonyms",{id:"csWindowSynonyms",title:"Synonyms",height:300,width:385,frame:true});this.datasources=Ext.create("CS.view.DataSources",{id:"csWindowDataSources",title:"Data Sources",height:300,width:385,frame:true});this.compoundStore=Ext.create("CS.store.Compound");this.loadingMask=new Ext.LoadMask(this,{msg:"Loading..."});this.items=[this.compoundInfo,this.synonyms,this.datasources];this.buttons=[{text:"Close",scope:this,handler:this.close}];this.callParent(arguments)},showCompound:function(a){var b=this;this.compoundStore.load({params:{"csids[0]":a,serfilter:"Compound[CSID|Name|MF|Mol|MM|Synonyms|References|Blobs|Identifiers]"},callback:function(d,c,f){if(f){var e=b.compoundStore.first();b.compoundInfo.loadData(e);b.synonyms.loadData(e);b.datasources.loadData(e)}else{Ext.MessageBox.show({title:"Error",msg:"Cannot get compoun details for CSID - "+a+": "+c.error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}b.loadingMask.hide()}});this.show();this.loadingMask.show()}});Ext.define("CS.config.Settings",{singleton:true,baseUrl:chemspiderURL});Ext.define("CS.view.BaseProperties",{extend:"Ext.panel.Panel",alias:"widget.cs.baseproperties",requires:["CS.config.Settings"],autoScroll:true,layout:"fit",border:0,constructor:function(){this.callParent(arguments);this.tpl=new Ext.XTemplate('<tpl for=".">','<div class="base_props">','<div class="name">{Name}</div>','<div class="mf">{MF:this.formatFormula}</div>','<div class="prop"><span class="name">ChemSpider ID:</span> <a href="'+CS.config.Settings.baseUrl+'/{CSID}" target="chemspider">{CSID}</a></div>','<div class="prop"><span class="name">Monoisotopic mass:</span> {MM}</div>','<tpl for="Identifiers">','<tpl if="this.isSMILES(values)">','<div class="prop"><span class="name">SMILES:</span> {Value}</div>',"</tpl>",'<tpl if="this.isStdInChi(values)">','<div class="prop"><span class="name">Std. InChI:</span> {Value}</div>',"</tpl>",'<tpl if="this.isStdInChiKey(values)">','<div class="prop"><span class="name">Std. InChIKey:</span> {Value}</div>',"</tpl>","</tpl>","</div>","</tpl>",{formatFormula:function(a){return a.replace(/_{/g,"<sub>").replace(/}/g,"</sub>")},isSMILES:function(a){return a.IdentifierType==1},isStdInChi:function(a){return a.IdentifierType==0&&a.Version=="v1.02s"},isStdInChiKey:function(a){return a.IdentifierType==2&&a.Version=="v1.02s"}})},loadData:function(a){this.update(a)}});Ext.define("CS.view.Molecule2D",{extend:"Ext.Component",alias:"widget.cs.molecule2D",autoEl:{tag:"img",src:Ext.BLANK_IMAGE_URL},width:200,height:200,csid:0,onRender:function(){this.autoEl=Ext.apply({},this.initialConfig,this.autoEl);this.callParent(arguments)},setSrc:function(a){if(this.rendered){this.el.dom.src=a}else{this.src=a}},getSrc:function(a){return this.el.dom.src||this.src},load:function(a){this.setSrc(CS.config.Settings.baseUrl+"/ImagesHandler.ashx?id="+a+"&w="+this.width+"&h="+this.height)}});Ext.define("CS.view.Molecule3D",{extend:"Ext.Component",alias:"widget.cs.molecule3D",width:200,height:200,mol:"",autoEl:{tag:"applet",code:"JmolApplet",codebase:"lib/third/jmol",archive:"JmolApplet0.jar",mayscript:"true",hspace:0,vspace:0,align:"middle",children:[{tag:"param",name:"progressbar",value:"true"},{tag:"param",name:"bgcolor",value:"white"}]},onRender:function(){this.autoEl=Ext.apply({name:this.id},this.initialConfig,this.autoEl);this.callParent(arguments);if(this.mol!=""){Ext.defer(function(a){this.setMol(a)},200,this,[this.mol])}},setMol:function(a){this.getEl().dom.loadInlineString(a,"",false)}});Ext.define("CS.view.Compound",{extend:"Ext.panel.Panel",alias:"widget.cs.compound",requires:["CS.view.BaseProperties","CS.view.Molecule2D","CS.view.Molecule3D"],autoScroll:true,border:0,layout:"hbox",bodyStyle:"background-color: #fff;",constructor:function(){this.callParent(arguments);this.add({items:{xtype:"cs.molecule2D",id:this.getMol2DId(),height:223}});this.add({flex:1,items:{xtype:"cs.baseproperties",id:this.getBasePropsId(),height:223}})},is3DTabActive:function(){return this.molTabs.getActiveTab().id=="tab-mol-3D"},getMol2DId:function(){return this.id+"_Mol2D"},getMol3DId:function(){return this.id+"_Mol3D"},getBasePropsId:function(){return this.id+"_BaseProps"},loadData:function(a){Ext.getCmp(this.getMol2DId()).load(a.data.CSID);Ext.getCmp(this.getBasePropsId()).loadData(a.data);this.mol=a.data.Mol}});Ext.define("CS.view.Synonyms",{extend:"Ext.tab.Panel",alias:"widget.cs.synonyms",height:250,cls:"text-class",frame:false,border:"0 0 0 0",autoScroll:false,collapsible:false,closable:false,bodyStyle:"background-color: #fff; padding-left: .5em;",tpl:new Ext.XTemplate('<tpl if="this.hasSynonyms(values)">',"<ul>",'<tpl for="Synonyms">',"<li>{Name}</li>","</tpl>","</ul>","</tpl>",'<tpl if="!this.hasSynonyms(values)">',"<i>No synonyms</i>","</tpl>",{hasSynonyms:function(a){return a.Synonyms.length>0}}),loadData:function(a){this.update("<i>Loading...</i>");this.removeAll();if(a.hasApprovedSynonyms()){this.addTab("Approved",a.getApprovedSynonyms())}if(a.hasConfirmedSynonyms()){this.addTab("Confirmed",a.getConfirmedSynonyms())}if(a.hasDeletedSynonyms()){this.addTab("Deleted",a.getDeletedSynonyms())}if(a.hasRejectedSynonyms()){this.addTab("Rejected",a.getRejectedSynonyms())}if(a.hasUncertaintSynonyms()){this.addTab("Uncertain",a.getUncertaintSynonyms())}this.update("")},addTab:function(a,b){this.add({title:a,items:{xtype:"panel",id:this.id+"_panel"+this.items.getCount(),border:0,padding:0,tpl:new Ext.XTemplate('<ul class="zebra" style="overflow:auto; height:100%;">','<tpl for=".">',"<li>{Name}</li>","</tpl>","</ul>"),data:b}})}});Ext.define("CS.view.DataSources",{extend:"Ext.tab.Panel",alias:"widget.cs.datasources",height:250,border:"0 0 0 0",loadData:function(d){var c=this;this.removeAll();var b=new Ext.util.HashMap();for(var a=0;a<d.data.References.length;a++){var e=d.data.References[a];if(e.Text!=null&&e.Text!=""){if(!b.containsKey(e.Source)){b.add(e.Source,new Array())}b.get(e.Source).push(e)}}b.each(function(f,h,g){c.add({title:f,items:{xtype:"panel",id:c.id+"_panel"+c.items.getCount(),border:0,tpl:new Ext.XTemplate('<ul class="zebra" style="overflow:auto; height:100%;">','<tpl for=".">',"<li>",'<tpl if="this.hasLink(values)">','<a href="{Link}" target="datasources">{Text}</a>',"</tpl>",'<tpl if="!this.hasLink(values)">',"{Text}","</tpl>","</li>","</tpl>","</ul>",{hasLink:function(j){return j.Link!=null&&j.Link.length>0}}),data:h}})})}});Ext.define("CS.model.Compound",{extend:"Ext.data.Model",id:"CSID",spectra:null,cifs:null,images:null,uncertaintSyns:null,rejectedSyns:null,deletedSyns:null,confirmedSyns:null,approvedSyns:null,fields:[{name:"CSID",mapping:"CSID"},{name:"Name",mapping:"Name"},{name:"MF",mapping:"MF"},{name:"AM",mapping:"AM"},{name:"MW",mapping:"MW"},{name:"MM",mapping:"MM"},{name:"Mol",mapping:"Mol"},{name:"Identifiers",mapping:"Identifiers"},{name:"Synonyms",mapping:"Synonyms"},{name:"References",mapping:"References"},{name:"Blobs",mapping:"Blobs"}],hasSynonyms:function(){return this.data!=null&&this.data.Synonyms.length>0},hasReferences:function(){return this.data!=null&&this.data.References.length>0},hasSpectra:function(){if(this.spectra==null){this.parseBlobs()}return this.spectra.length>0},hasImages:function(){if(this.images==null){this.parseBlobs()}return this.images.length>0},hasCIFs:function(){if(this.cifs==null){this.parseBlobs()}return this.cifs.length>0},getSpectra:function(){if(this.spectra==null){this.parseBlobs()}return this.spectra},getImages:function(){if(this.images==null){this.parseBlobs()}return this.images},getCIFs:function(){if(this.cifs==null){this.parseBlobs()}return this.cifs},parseBlobs:function(){this.spectra=new Array();this.cifs=new Array();this.images=new Array();for(var b=0;b<this.data.Blobs.length;b++){var a=this.data.Blobs[b];if(a.BlobType==0){this.spectra.push(a)}else{if(a.BlobType==1){this.images.push(a)}else{if(a.BlobType==2){this.cifs.push(a)}}}}},hasUncertaintSynonyms:function(){if(this.uncertaintSyns==null){this.parseSynonyms()}return this.uncertaintSyns.length>0},hasRejectedSynonyms:function(){if(this.rejectedSyns==null){this.parseSynonyms()}return this.rejectedSyns.length>0},hasDeletedSynonyms:function(){if(this.deletedSyns==null){this.parseSynonyms()}return this.deletedSyns.length>0},hasConfirmedSynonyms:function(){if(this.confirmedSyns==null){this.parseSynonyms()}return this.confirmedSyns.length>0},hasApprovedSynonyms:function(){if(this.approvedSyns==null){this.parseSynonyms()}return this.approvedSyns.length>0},getUncertaintSynonyms:function(){if(this.uncertaintSyns==null){this.parseSynonyms()}return this.uncertaintSyns},getRejectedSynonyms:function(){if(this.rejectedSyns==null){this.parseSynonyms()}return this.rejectedSyns},getDeletedSynonyms:function(){if(this.deletedSyns==null){this.parseSynonyms()}return this.deletedSyns},getConfirmedSynonyms:function(){if(this.confirmedSyns==null){this.parseSynonyms()}return this.confirmedSyns},getApprovedSynonyms:function(){if(this.approvedSyns==null){this.parseSynonyms()}return this.approvedSyns},parseSynonyms:function(){this.uncertaintSyns=new Array();this.rejectedSyns=new Array();this.deletedSyns=new Array();this.confirmedSyns=new Array();this.approvedSyns=new Array();for(var b=0;b<this.data.Synonyms.length;b++){var a=this.data.Synonyms[b];if(a.Reliability==0){this.uncertaintSyns.push(a)}else{if(a.Reliability==1){this.rejectedSyns.push(a)}else{if(a.Reliability==2){this.deletedSyns.push(a)}else{if(a.Reliability==3){this.confirmedSyns.push(a)}else{if(a.Reliability==4){this.approvedSyns.push(a)}}}}}}}});Ext.define("CS.store.Compound",{extend:"Ext.data.Store",requires:["CS.model.Compound","CS.config.Settings"],model:"CS.model.Compound",constructor:function(){this.callParent(arguments);this.setProxy({type:"jsonp",timeout:60000,url:CS.config.Settings.baseUrl+"/JSON.ashx?op=GetRecordsAsCompounds"})}});Ext.define("LSP.view.usergrid.UserGrid",{extend:"Ext.form.Panel",alias:"widget.usergrid",initComponent:function(){this.items=[grid=Ext.widget("dynamicgrid")];grid.buttonRender(["new","edit","filter","delete","load","exporter"]);this.callParent(arguments)}});Ext.define("LSP.view.sparqlform.Queryform",{extend:"Ext.form.Panel",alias:"widget.queryform",closable:true,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[{xtype:"form",padding:"5 5 0 5",border:false,style:"background-color: #fff;",items:[{xtype:"textarea",name:"query",id:"query_id",fieldLabel:"SPARQL query",height:120,labelWidth:110,width:700,value:"SELECT *  WHERE { ?s ?p ?o}"},{xtype:"fieldcontainer",height:31,width:700,layout:{type:"column"},items:[{xtype:"numberfield",name:"limit",margin:"0 10 0 110",padding:"",width:190,fieldLabel:"Limit",labelWidth:110,autoStripChars:true,maxValue:100,minValue:1,value:10,allowDecimals:false},{xtype:"numberfield",name:"offset",margin:"0 10 0 0",width:190,fieldLabel:"Offset",labelWidth:110,maxValue:10000,minValue:0,value:0,allowDecimals:false}]},{xtype:"button",action:"query",text:"Submit query"}]},{xtype:"dynamicgrid3",title:"SPARQL query results",name:"sparql_query_results",flex:1}];this.callParent(arguments)}});Ext.define("LSP.view.dropdowns.conceptWikiCompoundLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiCompoundLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"concept_label"},{type:"string",name:"concept_url"},{type:"string",name:"define_url"},{type:"string",name:"concept_uuid"},{type:"string",name:"concept_alt_labels"},{type:"string",name:"tag_label"},{type:"string",name:"tag_uuid"},{type:"string",name:"match"}],proxy:{type:"ajax",api:{read:"/concept_wiki_api_calls/compound_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"concept_url",displayField:"concept_label",name:"compound_uri",minChars:4,hideTrigger:true,forceSelection:true,allowBlank:false,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,fieldLabel:"Compound name",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching compounds found.",getInnerTpl:function(){return'<p><span style="font-family: verdana; color: grey; "><small>Match: {match}</small></span><br/><b>{concept_label}</b> <a href="{define_url}" target="_blank">(definition)</a></p>'}}});Ext.define("LSP.view.cmpd_by_name.CmpdByNameForm",{extend:"Ext.form.Panel",alias:"widget.CmpdByNameForm",closable:true,header:false,requires:["LSP.view.dropdowns.conceptWikiCompoundLookup","LSP.view.dynamicgrid.DynamicGrid","LSP.view.cmpd_by_name.CmpdByNameSingleDisplayForm"],layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"label",html:'<span style="font-family: verdana; color: grey; ">Hint: Type in compound name. E.g. "Aspirin"</span>',labelWidth:400,padding:"5 0 0 140"},{xtype:"container",margin:"0 5 5 5",name:"form_fields",layout:{type:"column"},style:"background-color: #fff;",items:[Ext.create("CW.view.ConceptWikiLookup",{xtype:"conceptWikiLookup",fieldLabel:"Compound name",itemId:"compoundByNameLookup",store:Ext.create("CW.store.ConceptWikiLookup",{proxy:{type:"jsonp",timeout:5000,url:CW.config.Settings.searchByTagUrl,reader:Ext.create("CW.helper.ConceptWikiJSONReader"),noCache:false,limitParam:undefined,startParam:undefined,pageParam:undefined,callbackKey:"_callback",extraParams:{branch:4,_format:"json",app_id:app_id,app_key:app_key}}}),name:"compound_uri",cwTagUuid:"07a84994-e464-4bbf-812a-a4b96fa3d197"}),{xtype:"button",padding:"5 5 5 5",text:"Search",itemId:"CmpdByNameSubmit_id",disabled:true,action:"query_cmpd_by_name"},{xtype:"radiogroup",width:160,labelWidth:65,fieldLabel:"Provenance",itemId:"provId",margin:"5 0 0 90",items:[{boxLabel:"On",name:"prov",inputValue:true},{boxLabel:"Off",name:"prov",inputValue:false,checked:true}]}]},{xtype:"CmpdByNameSingleDisplayForm",flex:1}]});this.callParent(arguments)}});Ext.define("LSP.view.dropdowns.conceptWikiLookup",{extend:"Ext.form.ComboBox",alias:"widget.conceptWikiLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"concept_label"},{type:"string",name:"concept_url"},{type:"string",name:"concept_uuid"},{type:"string",name:"concept_alt_labels"},{type:"string",name:"tag_label"},{type:"string",name:"tag_uuid"}],proxy:{type:"ajax",api:{read:"/concept_wiki_api_calls/concept_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"concept_url",displayField:"concept_label",name:"concept_uri",minChars:4,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:70,typeAheadDelay:150,queryDelay:700,fieldLabel:"Concept name",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching concepts found.",getInnerTpl:function(){return'<p><b>{concept_label}</b> <a href="{concept_url}" target="_blank">(definition)</a> <i>({tag_label})</i><br/ ><small><i>{concept_alt_labels}</i></small></p>'}}});Ext.define("LSP.view.concept.SummeryForm",{extend:"Ext.form.Panel",alias:"widget.SummeryForm",closable:true,requires:["LSP.view.dropdowns.conceptWikiLookup"],initComponent:function(){var a=this;a.items=[{xtype:"container",height:"6%",margin:"5 5 5 5",name:"form_fields",layout:{type:"column"},items:[{xtype:"conceptWikiLookup"},{xtype:"button",padding:"5 5 5 5",text:"Look up",action:"look_up_concept"},{name:"utf8",xtype:"hidden",value:"&#x2713;"},{name:"authenticity_token",xtype:"hidden",value:$$("meta[name=csrf-token]")[0].readAttribute("content")}]},object_grid=Ext.widget("dynamicgrid2"),subject_grid=Ext.widget("dynamicgrid2")];object_grid.setTitle("Concept Properties");object_grid.setHeight("47%");subject_grid.setTitle("Concept Relations");subject_grid.setHeight("47%");a.callParent(arguments)}});Ext.define("LSP.view.placeholder.temp",{extend:"Ext.form.Panel",alias:"widget.temp",closable:true,title:"OpenPhacts Exemplars",initComponent:function(){var a=this;Ext.applyIf(a,{xtype:"panel",bodyPadding:10,title:"OpenPhacts Exemplars",layout:"anchor",autoScroll:true,items:[{xtype:"label",text:"This page contains links to the OpenPhacts exemplars",labelWidth:600},{xtype:"displayfield",value:"<a target='_blank' href='http://ws.bioinfo.cnio.es/OpenPHACTS/'>Target Dossier</a>",labelWidth:600},{xtype:"displayfield",value:"<a target='_blank' href='http://cbn.zbh.uni-hamburg.de'>ChemBioNavigator</a> - username/password: cbn/cbn4ops",labelWidth:600},{xtype:"displayfield",value:"Polypharmacology Browser - no link yet",labelWidth:600}]});this.callParent(arguments)}});Ext.define("LSP.view.dropdowns.pmidLookup",{extend:"Ext.form.ComboBox",alias:"widget.pmidLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"pmid"},{type:"string",name:"pmid_uri"}],proxy:{type:"ajax",api:{read:"core_api_calls/pmid_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"pmid_uri",displayField:"pmid",name:"pmid_uri",minChars:2,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing Pubmed id...",margin:"5 5 5 5",width:600,queryDelay:700,fieldLabel:"Pubmed id",labelWidth:120,listConfig:{loadingText:"Searching...",emptyText:"No matching pubmed ids found."}});Ext.define("LSP.view.textmining.pmidTextMiningHitsForm",{extend:"Ext.form.Panel",alias:"widget.pmidTextMiningHits",requires:["LSP.view.dropdowns.pmidLookup"],closable:true,height:560,width:606,bodyPadding:10,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",activeItem:0,layout:{type:"column"},items:[{xtype:"pmidLookup",margin:"0 10 0 10",labelWidth:75,width:650},{xtype:"button",text:"Search...",action:"query",disabled:true,width:120}]},{xtype:"fieldset",height:200,layout:"anchor",defaults:{labelWidth:75},title:"Bibliographic information",items:[{xtype:"displayfield",fieldLabel:"Title",name:"title",anchor:"100%"},{xtype:"textarea",height:150,readOnly:true,fieldLabel:"Abstract",name:"abstract",anchor:"100%"}]},{xtype:"dynamicgrid2",title:"Text mined concepts",gridBaseTitle:"Text mined concepts",name:"textmining_hits",flex:1}]});a.callParent(arguments)}});Ext.define("LSP.view.dropdowns.wikiPathwaysCompoundLookup",{extend:"Ext.form.ComboBox",alias:"widget.wikiPathwaysCompoundLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"compound_name"},{type:"string",name:"compound_uri"}],proxy:{type:"ajax",api:{read:"/core_api_calls/wiki_pathway_compound_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"compound_uri",displayField:"compound_name",name:"compound_uri",minChars:4,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,queryDelay:700,fieldLabel:"Compound name",labelWidth:120,listConfig:{loadingText:"Searching..."}});Ext.define("LSP.view.pathways.pathwayByCompoundForm",{extend:"Ext.form.Panel",alias:"widget.pathwayByCompoundForm",requires:["LSP.view.dropdowns.wikiPathwaysCompoundLookup"],closable:true,height:560,width:606,bodyPadding:10,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",activeItem:0,layout:{type:"column"},items:[{xtype:"wikiPathwaysCompoundLookup",margin:"0 10 0 10",labelWidth:100,width:650},{xtype:"button",text:"Search...",disabled:true,action:"query",width:120}]},{xtype:"dynamicgrid2",title:"Pathways including compound",gridBaseTitle:"Pathways including compound",name:"pathway_by_cmpd_grid",flex:1,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"View pathway in WikiPathways applet (Google Chrome only)",action:"wp_view"}]}]}]});a.callParent(arguments)}});Ext.define("LSP.view.dropdowns.wikiPathwaysProteinLookup",{extend:"Ext.form.ComboBox",alias:"widget.wikiPathwaysProteinLookup",store:Ext.create("Ext.data.Store",{fields:[{type:"string",name:"wp_protein_name"},{type:"string",name:"wp_protein_uri"}],proxy:{type:"ajax",api:{read:"/core_api_calls/wiki_pathway_protein_lookup.json"},reader:{type:"json"}}}),queryMode:"remote",valueField:"wp_protein_uri",displayField:"wp_protein_name",name:"wp_protein_uri",minChars:4,hideTrigger:true,forceSelection:true,typeAhead:true,emptyText:"Start typing...",margin:"5 5 5 5",width:700,queryDelay:700,fieldLabel:"Protein name",labelWidth:120,listConfig:{loadingText:"Searching..."}});Ext.define("LSP.view.pathways.pathwayByProteinForm",{extend:"Ext.form.Panel",alias:"widget.pathwayByProteinForm",requires:["LSP.view.dropdowns.wikiPathwaysProteinLookup"],closable:true,height:560,width:606,bodyPadding:10,layout:{type:"vbox",align:"stretch"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"container",activeItem:0,layout:{type:"column"},items:[{xtype:"wikiPathwaysProteinLookup",margin:"0 10 0 10",labelWidth:100,width:650},{xtype:"button",text:"Search...",action:"query",disabled:true,width:120}]},{xtype:"dynamicgrid2",title:"Pathways including protein",gridBaseTitle:"Pathways including protein",name:"pathway_by_protein_grid",flex:1,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"View pathway in WikiPathways applet (Google Chrome only)",action:"wp_view"}]}]}]});a.callParent(arguments)}});Ext.define("LSP.view.Viewer",{extend:"Ext.tab.Panel",alias:"widget.viewer",xtype:"plain-tabs",plain:true,requires:["LSP.view.dynamicgrid.DynamicGrid","LSP.view.usergrid.UserGrid","LSP.view.sparqlform.Queryform","LSP.view.larkc_sim_search.SimSearchForm","LSP.view.cmpd_by_name.CmpdByNameForm","LSP.view.target_by_name.TargetByNameForm","LSP.view.pharm_by_cmpd_name2.PharmByCmpdNameForm","LSP.view.pharm_by_target_name2.PharmByTargetNameForm","LSP.view.concept.SummeryForm","LSP.view.placeholder.temp","LSP.view.pharm_by_enzyme_family.PharmEnzymeForm","LSP.view.textmining.pmidTextMiningHitsForm","LSP.view.pathways.pathwayByCompoundForm","LSP.view.pathways.pathwayByProteinForm","LSP.view.api_status.Status","LSP.view.background_tasks.BackgroundTasksForm"],activeItem:0,margins:"0 4 4 4",items:[{title:"Home",bodyPadding:60,padding:"0 0 0 100",html:'<div class="welcome-text-heading">Welcome to the Open PHACTS Explorer</div><br><br><p><div class="welcome-text">We are pleased to present the first public release of the beta Open PHACTS Explorer.</div></p><br><p><div class="welcome-text">The Open PHACTS Explorer allows multiple sources of publicly-available pharmacological and physicochemical data to be intuitively queried, and makes data provenance accessible at every step. The Open PHACTS Explorer was built to answer critical pharmacological questions as defined by academic and pharmaceutical industry scientists.</div></p><br><p><div class="welcome-text">For more information visit the Open PHACTS Explorer <a href="http://www.openphacts.org/explorer">homepage</a></div></p><br><br><iframe  width="640" height="360" src="http://www.youtube.com/embed/BK3fkEFkOy0?feature=player_embedded" frameborder="0" allowfullscreen></iframe><br><br><p><div class="welcome-text">This is the first public release of the Open PHACTS Explorer, and we look forward to and value your feedback and comments.</div></p><br><br><p><div class="welcome-text-linkout"><a href="http://www.openphacts.org/the-project">About us & Acknowledgments</a></div></p>'}],initComponent:function(){console.log("Viewer: initComponent()");this.callParent(arguments);this.on("tabchange",function(c,a,b){Ext.History.add("!p="+a.xtype)})}});Ext.define("LSP.view.feedback.FeedbackPanel",{extend:"Ext.panel.Panel",alias:"widget.FeedbackPanel",layout:"anchor",bodyCls:"fb-panel",border:false,items:[{xtype:"displayfield",value:"<br>",itemId:"spacer1"},{xtype:"displayfield",anchor:"100%",value:'Open PHACTS Explorer <a href="http://www.openphacts.org/explorer" target="_blank">homepage</a>',fieldCls:"fb-message",itemId:"homepage"},{xtype:"displayfield",value:"<br>",itemId:"spacer2"},{xtype:"displayfield",fieldCls:"fb-message",value:'Watch <a href="http://www.openphacts.org/tutorials" target="_blank">tutorials</a>',itemId:"tutorial"},{xtype:"displayfield",value:"<br>",itemId:"spacer3"},{xtype:"displayfield",anchor:"100%",itemId:"fpUserMessage1",fieldCls:"fb-message",value:'Give us <a href="http://www.openphacts.org/explorer/160" target="_blank">feedback</a>.'},{xtype:"displayfield",fieldCls:"fb-message",value:"Please note that we read everything, but can't always respond.",itemId:"feedbackText"},{xtype:"displayfield",value:"<br>",itemId:"spacer4"},{xtype:"displayfield",fieldCls:"fb-message",value:'See <a href="http://www.openphacts.org/known-issues-with-beta-open-phacts-explorer-" target="_blank">known issues</a>',itemId:"issues"},{xtype:"displayfield",value:"<br>",itemId:"spacer5"},{xtype:"displayfield",anchor:"100%",itemId:"fbVersionId",fieldCls:"fb-message",value:"version: "+explorer_version},{xtype:"displayfield",value:"<br>",itemId:"spacer6"}]});Ext.define("LSP.view.Navigator",{extend:"Ext.Panel",alias:"widget.navigator",requires:["LSP.view.Appmoduletree","Ext.layout.container.Accordion","LSP.view.feedback.FeedbackPanel","LSP.view.api_status.Status"],collapsible:true,margins:"0 0 4 4",layout:"accordion",layoutConfig:{animate:true},initComponent:function(){this.items=[{title:"Navigation",autoScroll:true,layout:"fit",border:false,iconCls:"nav",items:[{xtype:"appmoduletree",id:"appModuleTree"}]},{title:"Help and Feedback",border:false,autoScroll:true,iconCls:"fb-accordion",bodyBorder:false,items:[{xtype:"FeedbackPanel"}]},{title:"API Status",border:false,autoScroll:true,iconCls:"fb-accordion",bodyBorder:false,items:[{xtype:"Status"}]},{title:"TSV Downloads",border:false,itemId:"background_tasks_form",autoScroll:true,iconCls:"fb-accordion",bodyBorder:false,items:[{xtype:"BackgroundTasksForm"}]}];this.callParent(arguments)}});Ext.define("LSP.view.user.Loginbutton",{extend:"Ext.Button",alias:"widget.loginbutton",size:"small",text:"Log in",initComponent:function(){this.callParent(arguments)}});Ext.define("LSP.view.user.Logoutbutton",{extend:"Ext.Button",alias:"widget.logoutbutton",size:"small",text:"Log out",initComponent:function(){this.callParent(arguments)}});Ext.define("LSP.view.user.Newbutton",{extend:"Ext.Button",alias:"widget.usernewbutton",size:"small",text:"Create account",initComponent:function(){this.callParent(arguments)}});iconSize="small";Ext.define("LSP.view.Viewport",{extend:"Ext.container.Viewport",alias:"widget.lspviewport",requires:["LSP.view.Viewer","LSP.view.Navigator","LSP.view.Settings","LSP.view.user.Loginbutton","LSP.view.user.Logoutbutton","LSP.view.user.Newbutton","Ext.layout.container.Border","Ext.toolbar.Spacer","LSP.store.GuiComponents"],listeners:{afterrender:{fn:function(){console.log("Viewport: afterrender()");var a=Ext.History.getToken();if(a){if(a.length>0){this.handleHistoryToken(a)}}}}},layout:"border",getFormByXtype:function(a){return Ext.data.StoreManager.lookup("GuiComponents").findRecord("xtype",a)},handleHistoryToken:function(b){console.log("Viewport: handleHistoryToken()");if(b){if(b.indexOf("!")==0){var a=this.parseHistoryToken(unescape(b).substring(1));if(a.p){var c=this.getFormByXtype(a.p);if(c){this.changeView(c,a)}}}}},parseHistoryToken:function(c){console.log("Viewport: parseHistoryToken()");var b={};var a=c.split("&");Ext.each(a,function(g){var f=g.indexOf("=");if(f!=-1){var d=g.substring(0,f);var e=g.substring(f+1,g.length);b[d]=e}});return b},changeView:function(b,c){console.log("Viewport: changeView()");var a;Ext.getCmp("centerView").items.each(function(e){if(e.gridId==b.data.id){a=e;return}});if(!a){a=Ext.widget(b.data.xtype);a.setTitle(b.data.home);a.url=b.data.url;a.gridId=b.data.id;Ext.getCmp("centerView").add(a)}var d=Ext.getCmp("centerView");d.suspendEvents(false);d.setActiveTab(a);d.resumeEvents();if(c){if(a.setFormData){a.setFormData(c)}else{a.fireEvent("historyToken",c)}}},initComponent:function(){console.log("Viewport: initComponent()");LDAProvenanceMode=LDA.helper.LDAConstants.LDA_PROVENANCE_COLOUR;Ext.History.init();Ext.History.on("change",function(b){if(b){this.handleHistoryToken(b)}},this);var a=Ext.create("Ext.Img",{src:"./assets/ops_logo.png",bodyStyle:{background:"transparent"},width:77,height:50});this.items=[{region:"north",id:"northView",height:60,border:false,bodyStyle:{background:"transparent"},layout:{type:"hbox",padding:"5",align:"middle"},items:[a,{id:"lsp-header",xtype:"box",html:"<h1>Open PHACTS Explorer</h1>"},{xtype:"tbspacer",flex:1},{xtype:"displayfield",value:"Testing connection to OPS API...",width:400,name:"ops_api_staus",id:"ops_api_staus_id",hidden:true},{xtype:"tbspacer",flex:1},{xtype:"loginbutton",id:"loginButton",hidden:true},{xtype:"usernewbutton",id:"userNewButton",hidden:true},{xtype:"logoutbutton",id:"logoutButton",hidden:true}]},{region:"center",id:"centerView",xtype:"viewer"},{region:"west",id:"westView",width:225,xtype:"navigator"}];this.callParent(arguments)}});Ext.create("Ext.app.Application",{name:"LSP",appFolder:"app",requires:["LDA.helper.LDAConstants","CW.config.Settings"],controllers:["grids.DynamicGrid","NavigationTree","SimSearchForm","CmpdByNameForm","TargetByNameForm","PharmByTargetNameForm","PharmByCmpdNameForm","PharmByEnzymeFamily","Settings","CW.controller.ConceptWikiLookup","Status","BackgroundTasks"],launch:function(){console.log("Application: launch()");Ext.create("LSP.view.Viewport")}});
>>>>>>> ian_use_dev_ops_api
